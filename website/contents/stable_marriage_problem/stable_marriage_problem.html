<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel=stylesheet href="/pygments.css" type="text/css">
    <link rel=stylesheet href="/styles/style.css" type="text/css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <title id="ttl"></title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [['$','$']]}
        });
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        var bjs = {"gitbook": "3.x.x", "plugins": ["fontsettings", "mathjax@https://github.com/algorithm-archivists/plugin-mathjax", "bibtex-cite", "wordcount", "api-language-selector@https://github.com/algorithm-archivists/gitbook-plugin-api-language-selector.git", "include-codeblock", "ga", "bulk-redirect", "prism", "-highlight"], "lunr": {"maxIndexSize": 1000000000}, "pluginsConfig": {"mathjax": {"version": "2.6.1"}, "include-codeblock": {"fixlang": true, "unindent": true}, "bulk-redirect": {"basepath": "/", "redirectsFile": "redirects.json"}, "ga": {"token": "UA-118252470-1"}, "prism": {"lang": {"asm-x64": "nasm"}, "ignore": ["emojicode", "text"], "css": ["prismjs/themes/prism-tomorrow.css"]}, "api-language-selector": {"languages": [{"lang": "jl", "name": "Julia", "default": true}, {"lang": "bash", "name": "Bash"}, {"lang": "cs", "name": "C#"}, {"lang": "cpp", "name": "C++"}, {"lang": "c", "name": "C"}, {"lang": "c8", "name": "chip-8"}, {"lang": "py", "name": "Python"}, {"lang": "js", "name": "JavaScript"}, {"lang": "scratch", "name": "Scratch"}, {"lang": "hs", "name": "Haskell"}, {"lang": "rs", "name": "Rust"}, {"lang": "ml", "name": "OCaml"}, {"lang": "java", "name": "Java"}, {"lang": "clj", "name": "Clojure"}, {"lang": "elm", "name": "Elm"}, {"lang": "LabVIEW", "name": "LabVIEW"}, {"lang": "d", "name": "D"}, {"lang": "go", "name": "Go"}, {"lang": "swift", "name": "Swift"}, {"lang": "racket", "name": "Racket"}, {"lang": "m", "name": "Matlab"}, {"lang": "r", "name": "R"}, {"lang": "ti83b", "name": "TI-83 Basic"}, {"lang": "lua", "name": "Lua"}, {"lang": "crystal", "name": "Crystal"}, {"lang": "php", "name": "PHP"}, {"lang": "lisp", "name": "Common Lisp"}, {"lang": "nim", "name": "Nim"}, {"lang": "asm-x64", "name": "X86-64 Assembly"}, {"lang": "f90", "name": "Fortran90"}, {"lang": "factor", "name": "Factor"}, {"lang": "ws", "name": "Whitespace"}, {"lang": "scala", "name": "Scala"}, {"lang": "emojic", "name": "Emojicode"}, {"lang": "lolcode", "name": "LOLCODE"}, {"lang": "piet", "name": "Piet"}, {"lang": "ss", "name": "Scheme"}]}}};		    
        var lang = "jl";
        var langs = {};
        var langNames = bjs.pluginsConfig["api-language-selector"].languages;
        var translations = {
            "python": "Python",
            "bf": "Brainfuck",
            "st": "Smalltalk",
            "ruby": "Ruby",
            "kotlin": "Kotlin",
            "bash": "Bash",
            "haskell": "Haskell",
            "matlab": "Matlab",
            "javascript": "JavaScript"
        };
	
        function initLangs () {
            var samples = document.getElementsByClassName("code-section");
            for (var a = 0; a < samples.length; a++) {
                var sample = samples[a];
                var children = sample.children;
                for (var b = 0; b < children.length; b++)  {
                    var element = children[b];
                    langs[element.className] = true;
                };
            };
	    langs = Object.keys(langs);
	    if (langs.length == 1) {
		lang = langs[0];
	    }
            langNames.forEach(function(element) { translations[element.lang] = element.name });
        }
        function reload() {
            var samples = document.getElementsByClassName("code-section");
            for (var a = 0; a < samples.length; a++) {
                var sample = samples[a];
                var children = sample.children;
                for (var b = 0; b < children.length; b++)  {
                    var element = children[b];
                    if (element.className == lang) {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                };
            };
        };
        window.onload = () => {
            initLangs();
            reload();
            document.getElementById("name").innerText = pages[index];
            document.getElementById("ttl").innerText = pages[index];
            initLs();
        };
        var index = 24;
        var pages = [];
	var lsed = false;
				
        function flipLs () {
            var ls = document.getElementById("ls");
            var ls2 = document.getElementById("ls2");
            if (lsed) {
                ls.style.display = 'none';
                ls2.style.display = 'none';
            } else {
                ls.style.display = 'block';
                ls2.style.display = 'block';
            }
            lsed = !lsed
        }

	var funcs = {};
        function initLs () {
            if (langs.length === 0) {
                document.getElementById("flipper").remove();
            } else {
                var h1 = 0;
                var h2 = 0;
                for (var i = 0; i < langs.length; i++) {
                    let language = langs[i];
		    console.log(language);
		    var elem = document.createElement("p");
                    funcs[language] = {}
                    funcs[language] = () => {
                        lang = language;
                        reload();
                    };
                    elem.innerHTML = "<a onclick='funcs[\"" + language + "\"]()' href='#' class=ls-link>" + translations[language] + "</a>";
                    if (i % 2) {
                        h2 += 1
                        document.getElementById("ls2").appendChild(elem);
                    } else {
                        h1 += 1
                        document.getElementById("ls").appendChild(elem);
                    }
                }
                if (h1 > h2) {
                    var elem = document.createElement("p");
                    elem.innerHTML = "&nbsp;";
                    document.getElementById("ls2").appendChild(elem);
                } else if (h2 > h1) {
                    var elem = document.createElement("p");
                    elem.innerHTML = "&nbsp;";
                    document.getElementById("ls").appendChild(elem);
                }
                document.getElementById("ls").style.display = "none";
                document.getElementById("ls2").style.display = "none";
            }
        }
        function toggleSidenav () {
            $("#sidebar").toggleClass("hide");
            $("#content").toggleClass("on-sidebar");
            $("#navbar").toggleClass("no-sidebar");
        }
    </script>
    <div class="sidebar-wrapper" id="sidebar">
        
            <p>
                
                <a name="Algorithm Archive"></a>
                <a href="/index.html#Algorithm Archive">Algorithm Archive</a>
                <script>pages[0] = "Algorithm Archive"</script>
            </p>
        
            <p>
                
                <a name="Introduction"></a>
                <a href="/contents/introduction/introduction.html#Introduction">Introduction</a>
                <script>pages[1] = "Introduction"</script>
            </p>
        
            <p>
                
                <a name="How To Contribute"></a>
                <a href="/contents/how_to_contribute/how_to_contribute.html#How To Contribute">How To Contribute</a>
                <script>pages[2] = "How To Contribute"</script>
            </p>
        
            <p>
                
                <a name="Data Structures"></a>
                <a href="/contents/data_structures/data_structures.html#Data Structures">Data Structures</a>
                <script>pages[3] = "Data Structures"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Stacks and Queues"></a>
                <a href="/contents/stacks_and_queues/stacks_and_queues.html#Stacks and Queues">Stacks and Queues</a>
                <script>pages[4] = "Stacks and Queues"</script>
            </p>
        
            <p>
                
                <a name="Mathematical Background"></a>
                <a href="/contents/mathematical_background/mathematical_background.html#Mathematical Background">Mathematical Background</a>
                <script>pages[5] = "Mathematical Background"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Complexity Notation"></a>
                <a href="/contents/notation/notation.html#Complexity Notation">Complexity Notation</a>
                <script>pages[6] = "Complexity Notation"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bit Logic"></a>
                <a href="/contents/bitlogic/bitlogic.html#Bit Logic">Bit Logic</a>
                <script>pages[7] = "Bit Logic"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Taylor Series"></a>
                <a href="/contents/taylor_series_expansion/taylor_series_expansion.html#Taylor Series">Taylor Series</a>
                <script>pages[8] = "Taylor Series"</script>
            </p>
        
            <p>
                
                <a name="Sorting and Searching"></a>
                <a href="/contents/sorting_and_searching/sorting_and_searching.html#Sorting and Searching">Sorting and Searching</a>
                <script>pages[9] = "Sorting and Searching"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bubble Sort"></a>
                <a href="/contents/bubble_sort/bubble_sort.html#Bubble Sort">Bubble Sort</a>
                <script>pages[10] = "Bubble Sort"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bogo Sort"></a>
                <a href="/contents/bogo_sort/bogo_sort.html#Bogo Sort">Bogo Sort</a>
                <script>pages[11] = "Bogo Sort"</script>
            </p>
        
            <p>
                
                <a name="Tree Traversal"></a>
                <a href="/contents/tree_traversal/tree_traversal.html#Tree Traversal">Tree Traversal</a>
                <script>pages[12] = "Tree Traversal"</script>
            </p>
        
            <p>
                
                <a name="Euclidean Algorithm"></a>
                <a href="/contents/euclidean_algorithm/euclidean_algorithm.html#Euclidean Algorithm">Euclidean Algorithm</a>
                <script>pages[13] = "Euclidean Algorithm"</script>
            </p>
        
            <p>
                
                <a name="Monte Carlo"></a>
                <a href="/contents/monte_carlo_integration/monte_carlo_integration.html#Monte Carlo">Monte Carlo</a>
                <script>pages[14] = "Monte Carlo"</script>
            </p>
        
            <p>
                
                <a name="Matrix Methods"></a>
                <a href="/contents/matrix_methods/matrix_methods.html#Matrix Methods">Matrix Methods</a>
                <script>pages[15] = "Matrix Methods"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Gaussian Elimination"></a>
                <a href="/contents/gaussian_elimination/gaussian_elimination.html#Gaussian Elimination">Gaussian Elimination</a>
                <script>pages[16] = "Gaussian Elimination"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Thomas Algorithm"></a>
                <a href="/contents/thomas_algorithm/thomas_algorithm.html#Thomas Algorithm">Thomas Algorithm</a>
                <script>pages[17] = "Thomas Algorithm"</script>
            </p>
        
            <p>
                
                <a name="Computational Geometry"></a>
                <a href="/contents/computational_geometry/computational_geometry.html#Computational Geometry">Computational Geometry</a>
                <script>pages[18] = "Computational Geometry"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Gift Wrapping"></a>
                <a href="/contents/gift_wrapping/gift_wrapping.html#Gift Wrapping">Gift Wrapping</a>
                <script>pages[19] = "Gift Wrapping"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Jarvis March"></a>
                <a href="/contents/jarvis_march/jarvis_march.html#Jarvis March">Jarvis March</a>
                <script>pages[20] = "Jarvis March"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Graham Scan"></a>
                <a href="/contents/graham_scan/graham_scan.html#Graham Scan">Graham Scan</a>
                <script>pages[21] = "Graham Scan"</script>
            </p>
        
            <p>
                
                <a name="FFT"></a>
                <a href="/contents/cooley_tukey/cooley_tukey.html#FFT">FFT</a>
                <script>pages[22] = "FFT"</script>
            </p>
        
            <p>
                
                <a name="Decision Problems"></a>
                <a href="/contents/decision_problems/decision_problems.html#Decision Problems">Decision Problems</a>
                <script>pages[23] = "Decision Problems"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Stable Marriage Problem"></a>
                <a href="/contents/stable_marriage_problem/stable_marriage_problem.html#Stable Marriage Problem">Stable Marriage Problem</a>
                <script>pages[24] = "Stable Marriage Problem"</script>
            </p>
        
            <p>
                
                <a name="Differential Equation Solvers"></a>
                <a href="/contents/differential_equations/differential_equations.html#Differential Equation Solvers">Differential Equation Solvers</a>
                <script>pages[25] = "Differential Equation Solvers"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Forward Euler Method"></a>
                <a href="/contents/forward_euler_method/forward_euler_method.html#Forward Euler Method">Forward Euler Method</a>
                <script>pages[26] = "Forward Euler Method"</script>
            </p>
        
            <p>
                
                <a name="Physics Solvers"></a>
                <a href="/contents/physics_solvers/physics_solvers.html#Physics Solvers">Physics Solvers</a>
                <script>pages[27] = "Physics Solvers"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Verlet Integration"></a>
                <a href="/contents/verlet_integration/verlet_integration.html#Verlet Integration">Verlet Integration</a>
                <script>pages[28] = "Verlet Integration"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Quantum Systems"></a>
                <a href="/contents/quantum_systems/quantum_systems.html#Quantum Systems">Quantum Systems</a>
                <script>pages[29] = "Quantum Systems"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Split-Operator Method"></a>
                <a href="/contents/split-operator_method/split-operator_method.html#Split-Operator Method">Split-Operator Method</a>
                <script>pages[30] = "Split-Operator Method"</script>
            </p>
        
            <p>
                
                <a name="Data Compression"></a>
                <a href="/contents/data_compression/data_compression.html#Data Compression">Data Compression</a>
                <script>pages[31] = "Data Compression"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Huffman Encoding"></a>
                <a href="/contents/huffman_encoding/huffman_encoding.html#Huffman Encoding">Huffman Encoding</a>
                <script>pages[32] = "Huffman Encoding"</script>
            </p>
        
            <p>
                
                <a name="Quantum Information"></a>
                <a href="/contents/quantum_information/quantum_information.html#Quantum Information">Quantum Information</a>
                <script>pages[33] = "Quantum Information"</script>
            </p>
        
        <hr>
    </div>
    <nav class="navbarrio" id=navbar>
        <ul class="navbarro">
            <li>
                <span onclick="toggleSidenav()">
                    <i class="fas fa-align-left"></i>
                </button>
            </li>
            <li>
                <span onclick="flipLs()" id=flipper>
                    <i class="fas fa-code"></i>
                    <div class=ls id=ls></div>
                    <div class=ls2 id=ls2></div>
                </span>
            </li>
            <li>
                <span id=name></span>
            </li>
        </ul>
    </nav>
    <div class="container-fluid on-sidebar" id="content">
        <h1>The Stable Marriage Problem</h1>
<p>Imagine you have two groups, each of size <script type='math/tex'>n</script>.
Each individual within a group has an internal ranking associated with all members of the opposing group.
The <em>Stable Matching Problem</em> attempts to unite both groups into stable pairs.
In this case, a set of pairs is considered stable if there are no pairs that like each other more than their current partners.
This doesn't mean that everyone gets their top choices, but if an individual prefers someone else who also prefers them back, the set of pairs is not stable.</p>
<p>Now, this is often told as a story.
One group is male, the other is female, and everyone gets married, hence the name the <em>Stable Marriage Problem</em>.
This problem is solved by the Gale-Shapley algorithm, which can be simply described as follows:</p>
<ol>
<li>All the men propose to their top choice of women.</li>
<li>The women become tentatively engaged to their top choice of the men who have proposed to them.</li>
<li>All rejected men propose to their next choice, and the women again select whichever man they prefer, possibly rejecting the one they were already engaged to.</li>
</ol>
<p>This process continues until all individuals are paired, which means that this algorithm guarantees stable matching and also has a <script type='math/tex'>\mathcal{O}(n^2)</script> runtime.
To be clear, even though this algorithm seems conceptually simple, it is rather tricky to implement correctly.
I do not at all claim that the code provided here is efficient and we will definitely be coming back to this problem in the future when we have more tools under our belt.
I am incredibly interested to see what you guys do and how you implement the algorithm.</p>
<h2>Video Explanation</h2>
<p>Here is a video describing the stable marriage problem:</p>
<div style="text-align:center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/A7xRZQAQU8s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<h2>Example Code</h2>
<div class=code-section>
<div class="ruby">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">prefs</span><span class="p">)</span>
        <span class="nd">@id</span>      <span class="o">=</span> <span class="nb">id</span>
        <span class="nd">@name</span>    <span class="o">=</span> <span class="n">name</span>
        <span class="nd">@prefs</span>   <span class="o">=</span> <span class="n">prefs</span>
        <span class="nd">@partner</span> <span class="o">=</span> <span class="n">nil</span>
        <span class="nd">@choices</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">end</span>

    <span class="k">def</span> <span class="nf">lonely</span><span class="err">?</span>
        <span class="nd">@partner</span><span class="o">.</span><span class="n">nil</span><span class="err">?</span>
    <span class="n">end</span>

    <span class="k">def</span> <span class="nf">propose</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>
        <span class="n">unless</span> <span class="bp">self</span><span class="o">.</span><span class="n">lonely</span><span class="err">?</span>
            <span class="k">raise</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not lonely!&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">end</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="nd">@prefs</span><span class="p">[</span><span class="nd">@choices</span><span class="p">]</span>
        <span class="n">partners</span><span class="p">[</span><span class="n">choice</span><span class="p">]</span><span class="o">.</span><span class="n">onPropose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nd">@choices</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">end</span>

    <span class="k">def</span> <span class="nf">to_s</span>
      <span class="s2">&quot;#{@name.rjust(20)}: #{self.lonely? &amp;&amp; &quot;</span><span class="n">Lonely</span><span class="s2">&quot; || @partner.name}&quot;</span>
    <span class="n">end</span>

    <span class="k">def</span> <span class="nf">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">size</span><span class="p">){</span><span class="o">|</span><span class="n">i</span><span class="o">|</span>
            <span class="n">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;#</span><span class="si">{prefix}</span><span class="s2"> #</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">0</span> <span class="o">...</span> <span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">random</span><span class="p">:</span> <span class="n">r</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="n">end</span>

    <span class="n">protected</span>
    <span class="n">attr_reader</span> <span class="p">:</span><span class="nb">id</span><span class="p">,</span> <span class="p">:</span><span class="n">name</span>
    <span class="n">attr_writer</span> <span class="p">:</span><span class="n">partner</span>

    <span class="c1"># Acts upon a given Proposal</span>
    <span class="k">def</span> <span class="nf">onPropose</span><span class="p">(</span><span class="n">partner</span><span class="p">)</span>
        <span class="n">unless</span> <span class="bp">self</span><span class="o">.</span><span class="n">lonely</span><span class="err">?</span>
            <span class="n">offer</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">partner</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="nd">@partner</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">unless</span> <span class="n">offer</span> <span class="o">&gt;</span> <span class="n">current</span> 
            <span class="nd">@partner</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="n">nil</span>
        <span class="n">end</span>
        <span class="nd">@partner</span> <span class="o">=</span> <span class="n">partner</span>
        <span class="n">partner</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="n">end</span>

    <span class="n">private</span>
    <span class="c1"># Determines the preference of a given partner</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">partner</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">partner</span><span class="o">.</span><span class="n">nil</span><span class="err">?</span>
        <span class="nd">@prefs</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="nd">@prefs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">partner</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">end</span>
<span class="n">end</span>

<span class="c1"># Deterministic Output, feel free to change seed</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">Random</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Determines Output Columns</span>
<span class="n">men</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Man&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="n">women</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Woman&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="c1"># Assume no Name is longer than 20 characters</span>
<span class="n">spacer</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Solve the Problem</span>
<span class="mf">1.</span><span class="n">step</span> <span class="n">do</span> <span class="o">|</span><span class="nb">round</span><span class="o">|</span>
    <span class="n">singles</span> <span class="o">=</span> <span class="n">men</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">&amp;</span><span class="p">:</span><span class="n">lonely</span><span class="err">?</span><span class="p">)</span>
    <span class="n">singles</span><span class="o">.</span><span class="n">each</span> <span class="n">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
        <span class="n">m</span><span class="o">.</span><span class="n">propose</span><span class="p">(</span><span class="n">women</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="k">break</span> <span class="k">if</span> <span class="n">singles</span><span class="o">.</span><span class="n">empty</span><span class="err">?</span>

    <span class="n">puts</span> <span class="s2">&quot;Round #</span><span class="si">{round}</span><span class="s2">&quot;</span>
    <span class="n">puts</span> <span class="n">spacer</span>
    <span class="n">puts</span> <span class="n">men</span><span class="p">,</span> <span class="n">women</span>
    <span class="n">puts</span> <span class="n">spacer</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">Random</span>

<span class="n">const</span> <span class="n">mnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]</span>
<span class="n">const</span> <span class="n">wnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]</span>

<span class="n">const</span> <span class="n">Preferences</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">{</span><span class="n">String</span><span class="p">,</span><span class="n">Vector</span><span class="p">{</span><span class="n">String</span><span class="p">}}</span>
<span class="n">const</span> <span class="n">Pairs</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">{</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="p">}</span>

<span class="c1"># Returns a name =&gt; preference list dictionary, in decreasing order of preference</span>
<span class="n">function</span> <span class="n">genpreferences</span><span class="p">(</span><span class="n">mannames</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">String</span><span class="p">},</span> <span class="n">womannames</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">String</span><span class="p">})</span>
    <span class="n">men</span>   <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">womannames</span><span class="p">)),</span> <span class="n">mannames</span><span class="p">))</span>
    <span class="n">women</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">w</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">mannames</span><span class="p">)),</span> <span class="n">womannames</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">men</span><span class="p">,</span> <span class="n">women</span>
<span class="n">end</span>

<span class="c1"># Returns if `person` prefers the `first` candidate over the `second` one.</span>
<span class="c1"># This translates to `first` appearing *sooner* in the preference list</span>
<span class="n">prefers</span><span class="p">(</span><span class="n">prefs</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">findfirst</span><span class="p">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="n">m</span> <span class="o">==</span> <span class="n">first</span><span class="p">,</span> <span class="n">prefs</span><span class="p">[</span><span class="n">person</span><span class="p">])</span> <span class="o">&lt;</span>
    <span class="n">findfirst</span><span class="p">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="n">m</span> <span class="o">==</span> <span class="n">second</span><span class="p">,</span> <span class="n">prefs</span><span class="p">[</span><span class="n">person</span><span class="p">])</span>

<span class="n">isfree</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">pairs</span><span class="p">)</span> <span class="o">=</span> <span class="err">!</span><span class="n">haskey</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">person</span><span class="p">)</span>

<span class="n">function</span> <span class="n">galeshapley</span><span class="p">(</span><span class="n">men</span><span class="p">::</span><span class="n">Preferences</span><span class="p">,</span> <span class="n">women</span><span class="p">::</span><span class="n">Preferences</span><span class="p">)</span>
    <span class="n">mentowomen</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">{</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="p">}()</span>
    <span class="n">womentomen</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">{</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="p">}()</span>
    <span class="k">while</span> <span class="n">true</span>
        <span class="n">bachelors</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">(</span><span class="n">men</span><span class="p">)</span> <span class="k">if</span> <span class="n">isfree</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mentowomen</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">length</span><span class="p">(</span><span class="n">bachelors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">mentowomen</span><span class="p">,</span> <span class="n">womentomen</span>
        <span class="n">end</span>

        <span class="k">for</span> <span class="n">bachelor</span> <span class="ow">in</span> <span class="n">bachelors</span>
            <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">men</span><span class="p">[</span><span class="n">bachelor</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">isfree</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">womentomen</span><span class="p">)</span>
                    <span class="n">mentowomen</span><span class="p">[</span><span class="n">bachelor</span><span class="p">]</span> <span class="o">=</span> <span class="n">candidate</span>
                    <span class="n">womentomen</span><span class="p">[</span><span class="n">candidate</span><span class="p">]</span> <span class="o">=</span> <span class="n">bachelor</span>
                    <span class="k">break</span>
                <span class="n">elseif</span> <span class="n">prefers</span><span class="p">(</span><span class="n">women</span><span class="p">,</span> <span class="n">candidate</span><span class="p">,</span> <span class="n">bachelor</span><span class="p">,</span> <span class="n">womentomen</span><span class="p">[</span><span class="n">candidate</span><span class="p">])</span>
                    <span class="n">delete</span><span class="err">!</span><span class="p">(</span><span class="n">mentowomen</span><span class="p">,</span> <span class="n">womentomen</span><span class="p">[</span><span class="n">candidate</span><span class="p">])</span>
                    <span class="n">mentowomen</span><span class="p">[</span><span class="n">bachelor</span><span class="p">]</span> <span class="o">=</span> <span class="n">candidate</span>
                    <span class="n">womentomen</span><span class="p">[</span><span class="n">candidate</span><span class="p">]</span> <span class="o">=</span> <span class="n">bachelor</span>
                    <span class="k">break</span>
                <span class="n">end</span>
            <span class="n">end</span>
        <span class="n">end</span>
    <span class="n">end</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">isstable</span><span class="p">(</span><span class="n">men</span><span class="p">::</span><span class="n">Preferences</span><span class="p">,</span> <span class="n">women</span><span class="p">::</span><span class="n">Preferences</span><span class="p">,</span> <span class="n">mentowomen</span><span class="p">::</span><span class="n">Pairs</span><span class="p">,</span> <span class="n">womentoman</span><span class="p">::</span><span class="n">Pairs</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">husband</span><span class="p">,</span> <span class="n">wife</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mentowomen</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">men</span><span class="p">[</span><span class="n">husband</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">candidate</span> <span class="o">!=</span> <span class="n">wife</span> <span class="o">&amp;&amp;</span>
               <span class="n">prefers</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="n">husband</span><span class="p">,</span> <span class="n">candidate</span><span class="p">,</span> <span class="n">wife</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
               <span class="n">prefers</span><span class="p">(</span><span class="n">women</span><span class="p">,</span> <span class="n">candidate</span><span class="p">,</span> <span class="n">husband</span><span class="p">,</span> <span class="n">womentoman</span><span class="p">[</span><span class="n">candidate</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">false</span>
            <span class="n">end</span>
        <span class="n">end</span>
    <span class="n">end</span>
    <span class="k">return</span> <span class="n">true</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">main</span><span class="p">()</span>
    <span class="n">men</span><span class="p">,</span> <span class="n">women</span> <span class="o">=</span> <span class="n">genpreferences</span><span class="p">(</span><span class="n">mnames</span><span class="p">,</span> <span class="n">wnames</span><span class="p">)</span>
    <span class="n">mentowomen</span><span class="p">,</span> <span class="n">womentomen</span> <span class="o">=</span> <span class="n">galeshapley</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="n">women</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="n">mentowomen</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="n">isstable</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="n">women</span><span class="p">,</span> <span class="n">mentowomen</span><span class="p">,</span> <span class="n">womentomen</span><span class="p">)</span> <span class="err">?</span> <span class="s2">&quot;Stable&quot;</span> <span class="p">:</span> <span class="s2">&quot;Unstable&quot;</span><span class="p">)</span>
<span class="n">end</span>

<span class="n">main</span><span class="p">()</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1"># Submitted by Marius Becker</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">ascii_uppercase</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Set this to however many men and women you want</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">num_pairs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_pairs</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="c1"># There are only 26 possible names</span>
    <span class="k">if</span> <span class="n">num_pairs</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You can</span><span class="se">\&#39;</span><span class="s1"> have more than 13 pairs.&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Create all Person objects</span>
    <span class="n">men</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ascii_uppercase</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_pairs</span><span class="p">]</span> <span class="p">]</span>
    <span class="n">women</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ascii_uppercase</span><span class="p">[</span><span class="n">num_pairs</span><span class="p">:</span><span class="n">num_pairs</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="p">]</span>

    <span class="c1"># Set everyone&#39;s preferences</span>
    <span class="k">for</span> <span class="n">man</span> <span class="ow">in</span> <span class="n">men</span><span class="p">:</span>
        <span class="n">man</span><span class="o">.</span><span class="n">preference</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">women</span><span class="p">)</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">man</span><span class="o">.</span><span class="n">preference</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">woman</span> <span class="ow">in</span> <span class="n">women</span><span class="p">:</span>
        <span class="n">woman</span><span class="o">.</span><span class="n">preference</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">men</span><span class="p">)</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">woman</span><span class="o">.</span><span class="n">preference</span><span class="p">)</span>

    <span class="c1"># Run the algorithm</span>
    <span class="n">resolve</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="n">women</span><span class="p">)</span>

    <span class="c1"># Print preferences and the result</span>
    <span class="k">for</span> <span class="n">man</span> <span class="ow">in</span> <span class="n">men</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">man</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">man</span><span class="o">.</span><span class="n">preference</span> <span class="p">])))</span>

    <span class="k">for</span> <span class="n">woman</span> <span class="ow">in</span> <span class="n">women</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">woman</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">woman</span><span class="o">.</span><span class="n">preference</span> <span class="p">])))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">man</span> <span class="ow">in</span> <span class="n">men</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> + </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">man</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">man</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="n">women</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Finds pairs with stable marriages&quot;&quot;&quot;</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">cont</span><span class="p">:</span>
        <span class="c1"># Let every man without a partner propose to a woman</span>
        <span class="k">for</span> <span class="n">man</span> <span class="ow">in</span> <span class="n">men</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">man</span><span class="o">.</span><span class="n">has_partner</span><span class="p">():</span>
                <span class="n">man</span><span class="o">.</span><span class="n">propose_to_next</span><span class="p">()</span>

        <span class="c1"># Let the women pick their favorites</span>
        <span class="k">for</span> <span class="n">woman</span> <span class="ow">in</span> <span class="n">women</span><span class="p">:</span>
            <span class="n">woman</span><span class="o">.</span><span class="n">pick_preferred</span><span class="p">()</span>

        <span class="c1"># Continue only when someone is still left without a partner</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">man</span> <span class="ow">in</span> <span class="n">men</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">man</span><span class="o">.</span><span class="n">has_partner</span><span class="p">():</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">preference</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pref_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">partner</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preference</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_next_choice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the next person in the own preference list&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pref_index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preference</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">preference</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pref_index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">propose_to_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propose to the next person in the own preference list&quot;&quot;&quot;</span>
        <span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_choice</span><span class="p">()</span>
        <span class="n">person</span><span class="o">.</span><span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pref_index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">pick_preferred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pick a new partner or stay with the old one if they are preferred&quot;&quot;&quot;</span>
        <span class="c1"># Iterate own preferences in order</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preference</span><span class="p">:</span>
            <span class="c1"># Pick the first person that&#39;s either a new candidate or the</span>
            <span class="c1"># current partner</span>
            <span class="k">if</span> <span class="n">person</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_partner</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="c1"># Rejected candidates don&#39;t get a second chance. :(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current partner&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span>

    <span class="k">def</span> <span class="nf">set_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a person as the new partner and run set_partner() on that person</span>
<span class="sd">           as well&quot;&quot;&quot;</span>
        <span class="c1"># Do nothing if nothing would change</span>
        <span class="k">if</span> <span class="n">person</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="p">:</span>
            <span class="c1"># Remove self from current partner</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Set own and the other person&#39;s partner</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="n">person</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">has_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether this person currently has a partner or not&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span> <span class="o">!=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="kn">import</span>           <span class="nn">Data.Map</span> <span class="k">as</span> <span class="nn">M</span> <span class="p">(</span><span class="n">Map</span><span class="p">,</span> <span class="p">(</span><span class="err">!</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">qualified</span> <span class="n">Data</span><span class="o">.</span><span class="n">Map</span> <span class="k">as</span> <span class="n">M</span>
<span class="kn">import</span>           <span class="nn">Data.List</span> <span class="p">(</span><span class="n">elemIndex</span><span class="p">)</span>
<span class="kn">import</span>           <span class="nn">Control.Monad.State</span>

<span class="n">stableMatching</span> <span class="p">::</span> <span class="p">(</span><span class="n">Ord</span> <span class="n">a</span><span class="p">,</span> <span class="n">Ord</span> <span class="n">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">])]</span> <span class="o">-&gt;</span> <span class="p">[(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">])]</span> <span class="o">-&gt;</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span>
<span class="n">stableMatching</span> <span class="n">men</span> <span class="n">women</span> <span class="o">=</span> <span class="n">evalState</span> <span class="p">(</span><span class="n">propose</span> <span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">fromList</span> <span class="n">women</span><span class="p">)</span> <span class="n">men</span><span class="p">)</span> <span class="n">M</span><span class="o">.</span><span class="n">empty</span>

<span class="n">propose</span> <span class="p">::</span> <span class="p">(</span><span class="n">Ord</span> <span class="n">a</span><span class="p">,</span> <span class="n">Ord</span> <span class="n">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Map</span> <span class="n">b</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-&gt;</span>
                            <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">])]</span> <span class="o">-&gt;</span>
                            <span class="n">State</span> <span class="p">(</span><span class="n">Map</span> <span class="n">b</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">]))</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span>
<span class="n">propose</span> <span class="n">_</span> <span class="p">[]</span> <span class="o">=</span> <span class="n">get</span> <span class="o">&gt;&gt;=</span>  <span class="k">return</span> <span class="o">.</span> <span class="nb">map</span> <span class="p">(</span>\<span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">_</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span> <span class="o">.</span> <span class="n">M</span><span class="o">.</span><span class="n">assocs</span>
<span class="n">propose</span> <span class="n">women</span> <span class="p">((</span><span class="n">man</span><span class="p">,</span> <span class="n">pref</span><span class="p">):</span><span class="n">bachelors</span><span class="p">)</span> <span class="o">=</span> <span class="n">do</span>
  <span class="n">let</span> <span class="n">theOne</span> <span class="o">=</span> <span class="n">head</span> <span class="n">pref</span>
  <span class="n">couples</span> <span class="o">&lt;-</span> <span class="n">get</span>
  <span class="n">case</span> <span class="n">M</span><span class="o">.</span><span class="n">lookup</span> <span class="n">theOne</span> <span class="n">couples</span> <span class="n">of</span>
    <span class="n">Nothing</span> <span class="o">-&gt;</span> <span class="n">do</span>
      <span class="n">modify</span> <span class="err">$</span> <span class="n">M</span><span class="o">.</span><span class="n">insert</span> <span class="n">theOne</span> <span class="p">(</span><span class="n">man</span><span class="p">,</span> <span class="p">(</span><span class="n">tail</span> <span class="n">pref</span><span class="p">))</span>
      <span class="n">propose</span> <span class="n">women</span> <span class="n">bachelors</span>
    <span class="n">Just</span> <span class="p">(</span><span class="n">boyfriend</span><span class="p">,</span> <span class="n">planB</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">do</span>
      <span class="n">let</span> <span class="n">rank</span> <span class="n">x</span> <span class="o">=</span> <span class="n">elemIndex</span> <span class="n">x</span> <span class="p">(</span><span class="n">women</span><span class="err">!</span><span class="n">theOne</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">rank</span> <span class="n">boyfriend</span> <span class="o">&lt;</span> <span class="n">rank</span> <span class="n">man</span>
        <span class="n">then</span> <span class="n">propose</span> <span class="n">women</span> <span class="err">$</span> <span class="p">(</span><span class="n">man</span><span class="p">,</span> <span class="n">tail</span> <span class="n">pref</span><span class="p">):</span> <span class="n">bachelors</span>
        <span class="k">else</span> <span class="n">do</span>
          <span class="n">modify</span> <span class="err">$</span> <span class="n">M</span><span class="o">.</span><span class="n">insert</span> <span class="n">theOne</span> <span class="p">(</span><span class="n">man</span><span class="p">,</span> <span class="p">(</span><span class="n">tail</span> <span class="n">pref</span><span class="p">))</span> <span class="o">.</span> <span class="n">M</span><span class="o">.</span><span class="n">delete</span> <span class="n">theOne</span>
          <span class="n">propose</span> <span class="n">women</span> <span class="err">$</span> <span class="p">(</span><span class="n">boyfriend</span><span class="p">,</span> <span class="n">planB</span><span class="p">):</span> <span class="n">bachelors</span>

<span class="n">main</span> <span class="o">=</span> <span class="n">do</span>
  <span class="n">let</span> <span class="n">aPref</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s2">&quot;YXZ&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s2">&quot;ZYX&quot;</span><span class="p">),(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s2">&quot;XZY&quot;</span><span class="p">)]</span>
      <span class="n">bPref</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s2">&quot;BAC&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s2">&quot;CBA&quot;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s2">&quot;ACB&quot;</span><span class="p">)]</span>
  <span class="nb">print</span> <span class="err">$</span> <span class="n">stableMatching</span> <span class="n">aPref</span> <span class="n">bPref</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1">#include &lt;stdbool.h&gt;</span>
<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;string.h&gt;</span>
<span class="c1">#include &lt;time.h&gt;</span>

<span class="n">struct</span> <span class="n">person</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="nb">id</span><span class="p">;</span>
    <span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">partner</span><span class="p">;</span>
    <span class="n">size_t</span> <span class="o">*</span><span class="n">prefers</span><span class="p">;</span>
    <span class="n">size_t</span> <span class="n">index</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">void</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">size_t</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">size_t</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">create_group</span><span class="p">(</span><span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">group</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">are_men</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
        <span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">prefers</span> <span class="o">=</span> <span class="p">(</span><span class="n">size_t</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">size_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span><span class="p">);</span>
        <span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">prefers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">shuffle</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">prefers</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">bool</span> <span class="n">prefers_partner</span><span class="p">(</span><span class="n">size_t</span> <span class="o">*</span><span class="n">prefers</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">partner</span><span class="p">,</span> <span class="n">size_t</span> <span class="nb">id</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prefers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">partner</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">prefers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">stable_marriage</span><span class="p">(</span><span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">men</span><span class="p">,</span> <span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">women</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">bachelors</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
    <span class="n">size_t</span> <span class="n">bachelors_size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">bachelors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">men</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">bachelors_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">man</span> <span class="o">=</span> <span class="n">bachelors</span><span class="p">[</span><span class="n">bachelors_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">woman</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">women</span><span class="p">[</span><span class="n">man</span><span class="o">-&gt;</span><span class="n">prefers</span><span class="p">[</span><span class="n">man</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">]];</span>

        <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">partner</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">woman</span><span class="o">-&gt;</span><span class="n">partner</span> <span class="o">=</span> <span class="n">man</span><span class="p">;</span>
            <span class="n">man</span><span class="o">-&gt;</span><span class="n">partner</span> <span class="o">=</span> <span class="n">woman</span><span class="p">;</span>
            <span class="n">bachelors</span><span class="p">[</span><span class="o">--</span><span class="n">bachelors_size</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">prefers_partner</span><span class="p">(</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">prefers</span><span class="p">,</span> <span class="n">woman</span><span class="o">-&gt;</span><span class="n">partner</span><span class="o">-&gt;</span><span class="nb">id</span><span class="p">,</span> <span class="n">man</span><span class="o">-&gt;</span><span class="nb">id</span><span class="p">,</span>
                                   <span class="n">size</span><span class="p">))</span> <span class="p">{</span>

            <span class="n">woman</span><span class="o">-&gt;</span><span class="n">partner</span><span class="o">-&gt;</span><span class="n">index</span><span class="o">++</span><span class="p">;</span>
            <span class="n">bachelors</span><span class="p">[</span><span class="n">bachelors_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">woman</span><span class="o">-&gt;</span><span class="n">partner</span><span class="p">;</span>
            <span class="n">woman</span><span class="o">-&gt;</span><span class="n">partner</span> <span class="o">=</span> <span class="n">man</span><span class="p">;</span>
            <span class="n">man</span><span class="o">-&gt;</span><span class="n">partner</span> <span class="o">=</span> <span class="n">woman</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">man</span><span class="o">-&gt;</span><span class="n">index</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">free_group</span><span class="p">(</span><span class="n">struct</span> <span class="n">person</span> <span class="o">*</span><span class="n">group</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">free</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">prefers</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="n">NULL</span><span class="p">));</span>

    <span class="n">struct</span> <span class="n">person</span> <span class="n">men</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">women</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

    <span class="n">create_group</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
    <span class="n">create_group</span><span class="p">(</span><span class="n">women</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;preferences of man %zu: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;%zu &quot;</span><span class="p">,</span> <span class="n">men</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">prefers</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;preferences of woman %zu: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;%zu &quot;</span><span class="p">,</span> <span class="n">women</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">prefers</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">stable_marriage</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="n">women</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;the partner of man %zu is woman </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">men</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">partner</span><span class="o">-&gt;</span><span class="nb">id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">free_group</span><span class="p">(</span><span class="n">men</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">free_group</span><span class="p">(</span><span class="n">women</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1">#include &lt;algorithm&gt;</span>
<span class="c1">#include &lt;iostream&gt;</span>
<span class="c1">#include &lt;iterator&gt;</span>
<span class="c1">#include &lt;numeric&gt;</span>
<span class="c1">#include &lt;random&gt;</span>
<span class="c1">#include &lt;vector&gt;</span>

<span class="o">//</span> <span class="n">this</span> <span class="n">header</span> <span class="ow">is</span> <span class="n">so</span> <span class="n">that</span> <span class="n">we</span> <span class="n">can</span> <span class="n">use</span> <span class="err">`</span><span class="ow">not</span><span class="err">`</span> <span class="ow">and</span> <span class="err">`</span><span class="ow">and</span><span class="err">`</span> <span class="n">on</span> <span class="n">MSVC</span>
<span class="c1">#include &lt;ciso646&gt;</span>

<span class="c1">#include &lt;cstddef&gt;</span>

<span class="n">using</span> <span class="n">std</span><span class="p">::</span><span class="n">size_t</span><span class="p">;</span>

<span class="o">/*</span>
  <span class="n">we</span> <span class="n">use</span> <span class="n">these</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">random</span> <span class="n">numbers</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">program</span><span class="o">.</span>
  <span class="n">this</span> <span class="n">makes</span> <span class="n">the</span> <span class="n">program</span> <span class="n">simpler</span><span class="p">,</span>
  <span class="n">by</span> <span class="ow">not</span> <span class="n">having</span> <span class="n">to</span> <span class="k">pass</span> <span class="n">around</span> <span class="n">random</span> <span class="n">number</span> <span class="n">generators</span><span class="o">.</span>
<span class="o">*/</span>
<span class="n">static</span> <span class="n">thread_local</span> <span class="n">std</span><span class="p">::</span><span class="n">random_device</span> <span class="n">global_random_device</span><span class="p">;</span>
<span class="n">static</span> <span class="n">thread_local</span> <span class="n">std</span><span class="p">::</span><span class="n">mt19937</span> <span class="n">global_rng</span><span class="p">(</span><span class="n">global_random_device</span><span class="p">());</span>

<span class="n">struct</span> <span class="n">person</span> <span class="p">{</span>
  <span class="o">/*</span>
    <span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">poor</span> <span class="n">person</span><span class="s1">&#39;s std::optional,</span>
    <span class="n">but</span> <span class="n">since</span> <span class="n">we</span><span class="s1">&#39;re attempting to be compileable on C++14,</span>
    <span class="n">we</span> <span class="n">won</span><span class="s1">&#39;t worry too much about it.</span>
  <span class="o">*/</span>
  <span class="nb">bool</span> <span class="n">finished</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="n">preference</span><span class="p">;</span>

  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">size_t</span><span class="o">&gt;</span> <span class="n">preference_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">/*</span>
  <span class="n">this</span> <span class="n">function</span> <span class="n">generates</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">people</span> <span class="k">with</span> <span class="n">size</span> <span class="err">`</span><span class="n">number_of_partners</span><span class="err">`</span><span class="o">.</span>

  <span class="n">each</span> <span class="n">person</span><span class="s1">&#39;s `preference_list` will be a randomly sorted list of</span>
  <span class="n">the</span> <span class="n">numbers</span> <span class="ow">in</span> <span class="n">the</span> <span class="nb">range</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_partners</span><span class="p">),</span>
  <span class="k">with</span> <span class="n">no</span> <span class="n">duplicates</span><span class="o">.</span>
<span class="o">*/</span>
<span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">person</span><span class="o">&gt;</span> <span class="n">make_person_list</span><span class="p">(</span><span class="n">size_t</span> <span class="n">number_of_partners</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">auto</span> <span class="n">random_pref_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span> <span class="p">{</span>
    <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">size_t</span><span class="o">&gt;</span> <span class="n">ret</span><span class="p">(</span><span class="n">number_of_partners</span><span class="p">);</span>
    <span class="n">std</span><span class="p">::</span><span class="n">iota</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="n">size_t</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="n">std</span><span class="p">::</span><span class="n">shuffle</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="n">global_rng</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">person</span><span class="o">&gt;</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">generate_n</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">back_inserter</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="n">number_of_partners</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">person</span><span class="p">{</span><span class="n">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">random_pref_list</span><span class="p">()};</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">template</span> <span class="o">&lt;</span><span class="n">typename</span> <span class="n">LeadIter</span><span class="p">,</span> <span class="n">typename</span> <span class="n">FollowIter</span><span class="o">&gt;</span>
<span class="n">void</span> <span class="n">stable_match</span><span class="p">(</span><span class="n">LeadIter</span> <span class="n">leads</span><span class="p">,</span> <span class="n">LeadIter</span> <span class="n">leads_end</span><span class="p">,</span> <span class="n">FollowIter</span> <span class="n">follows</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="k">for</span> <span class="n">each</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">leads</span><span class="s1">&#39; preference list, we&#39;</span><span class="n">ll</span> <span class="n">go</span> <span class="n">through</span> <span class="n">this</span>
  <span class="n">size_t</span> <span class="n">const</span> <span class="n">number_of_partners</span> <span class="o">=</span> <span class="n">leads_end</span> <span class="o">-</span> <span class="n">leads</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">proposal_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">proposal_index</span> <span class="o">&lt;</span> <span class="n">number_of_partners</span><span class="p">;</span>
       <span class="o">++</span><span class="n">proposal_index</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">/*</span>
      <span class="n">each</span> <span class="n">follow</span> <span class="n">will</span> <span class="n">get</span> <span class="n">their</span> <span class="n">own</span> <span class="n">vector</span> <span class="n">of</span> <span class="n">proposals</span> <span class="n">to</span> <span class="n">them</span>
      <span class="k">for</span> <span class="n">each</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">leads</span><span class="s1">&#39; proposal list</span>

      <span class="k">if</span> <span class="n">this</span> <span class="n">weren</span><span class="s1">&#39;t example code, this would likely go outside the loop</span>
      <span class="n">to</span> <span class="n">cut</span> <span class="n">down</span> <span class="n">on</span> <span class="n">allocations</span>
    <span class="o">*/</span>
    <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">size_t</span><span class="o">&gt;&gt;</span> <span class="n">proposals</span><span class="p">(</span><span class="n">number_of_partners</span><span class="p">);</span>

    <span class="o">//</span> <span class="k">for</span> <span class="n">each</span> <span class="n">lead</span><span class="p">,</span> <span class="n">we</span><span class="s1">&#39;ll make a proposal to their favorite follow</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">number_of_partners</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">leads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">auto</span> <span class="n">pref</span> <span class="o">=</span> <span class="n">leads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">preference_list</span><span class="p">[</span><span class="n">proposal_index</span><span class="p">];</span>
        <span class="n">proposals</span><span class="p">[</span><span class="n">pref</span><span class="p">]</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="k">for</span> <span class="n">each</span> <span class="n">follow</span><span class="p">,</span> <span class="n">we</span><span class="s1">&#39;ll look at their preference list</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">number_of_partners</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">pref</span> <span class="p">:</span> <span class="n">follows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">preference_list</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">proposal</span> <span class="p">:</span> <span class="n">proposals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
          <span class="o">//</span> <span class="ow">and</span><span class="p">,</span> <span class="k">if</span> <span class="n">they</span> <span class="n">were</span> <span class="n">given</span> <span class="n">a</span> <span class="n">proposal</span><span class="p">,</span> <span class="n">then</span> <span class="n">they</span><span class="s1">&#39;ll choose their</span>
          <span class="o">//</span> <span class="n">favorite</span> <span class="n">here</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">pref</span> <span class="o">==</span> <span class="n">proposal</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">follows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">follows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">preference</span> <span class="o">=</span> <span class="n">pref</span><span class="p">;</span>
            <span class="n">follows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>

            <span class="n">leads</span><span class="p">[</span><span class="n">pref</span><span class="p">]</span><span class="o">.</span><span class="n">preference</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="n">leads</span><span class="p">[</span><span class="n">pref</span><span class="p">]</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">these</span> <span class="n">are</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">partners</span> <span class="ow">in</span> <span class="n">each</span> <span class="n">group</span>
  <span class="n">size_t</span> <span class="n">const</span> <span class="n">number_of_partners</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

  <span class="o">//</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">case</span><span class="p">,</span> <span class="n">the</span> <span class="n">leads</span> <span class="n">shall</span> <span class="n">propose</span> <span class="n">to</span> <span class="n">the</span> <span class="n">follows</span>
  <span class="n">auto</span> <span class="n">leads</span> <span class="o">=</span> <span class="n">make_person_list</span><span class="p">(</span><span class="n">number_of_partners</span><span class="p">);</span>
  <span class="n">auto</span> <span class="n">follows</span> <span class="o">=</span> <span class="n">make_person_list</span><span class="p">(</span><span class="n">number_of_partners</span><span class="p">);</span>

  <span class="n">stable_match</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">leads</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">leads</span><span class="p">),</span> <span class="n">begin</span><span class="p">(</span><span class="n">follows</span><span class="p">));</span>

  <span class="o">//</span> <span class="n">the</span> <span class="n">happy</span> <span class="n">marriages</span> <span class="n">are</span> <span class="n">announced</span> <span class="n">to</span> <span class="n">the</span> <span class="n">console</span> <span class="n">here</span> <span class="p">:)</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">number_of_partners</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;the partnership of lead &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; and follow &quot;</span>
              <span class="o">&lt;&lt;</span> <span class="n">leads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">preference</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; shall commence forthwith!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="js">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="n">constructor</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">get</span> <span class="n">hasFiance</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="err">!!</span><span class="n">this</span><span class="o">.</span><span class="n">fiance</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">prefers</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">this</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">fiance</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">engageTo</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">hasFiance</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">other</span><span class="o">.</span><span class="n">fiance</span><span class="o">.</span><span class="n">fiance</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">this</span><span class="o">.</span><span class="n">fiance</span> <span class="o">=</span> <span class="n">other</span><span class="p">;</span>
    <span class="n">other</span><span class="o">.</span><span class="n">fiance</span> <span class="o">=</span> <span class="n">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">stableMarriage</span><span class="p">(</span><span class="n">guys</span><span class="p">,</span> <span class="n">girls</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">bachelors</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="n">guys</span><span class="p">];</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">bachelors</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">guy</span> <span class="o">=</span> <span class="n">bachelors</span><span class="o">.</span><span class="n">shift</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">girl</span> <span class="n">of</span> <span class="n">guy</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">girl</span><span class="o">.</span><span class="n">hasFiance</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">guy</span><span class="o">.</span><span class="n">engageTo</span><span class="p">(</span><span class="n">girl</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">girl</span><span class="o">.</span><span class="n">prefers</span><span class="p">(</span><span class="n">guy</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">bachelors</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">girl</span><span class="o">.</span><span class="n">fiance</span><span class="p">);</span>
        <span class="n">guy</span><span class="o">.</span><span class="n">engageTo</span><span class="p">(</span><span class="n">girl</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="n">iterable</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">i</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">[</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">array</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">guys</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="s2">&quot;ABCDE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">name</span> <span class="o">=&gt;</span> <span class="n">new</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="p">));</span>
<span class="n">const</span> <span class="n">girls</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="s2">&quot;FGHIJ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">name</span> <span class="o">=&gt;</span> <span class="n">new</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="p">));</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Guys&quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">guy</span> <span class="n">of</span> <span class="n">guys</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">guy</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">girls</span><span class="p">);</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`$</span><span class="p">{</span><span class="n">guy</span><span class="o">.</span><span class="n">name</span><span class="p">}:</span> <span class="err">$</span><span class="p">{</span><span class="n">guy</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">()}</span><span class="err">`</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Girls&quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">girl</span> <span class="n">of</span> <span class="n">girls</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">girl</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">guys</span><span class="p">);</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`$</span><span class="p">{</span><span class="n">girl</span><span class="o">.</span><span class="n">name</span><span class="p">}:</span> <span class="err">$</span><span class="p">{</span><span class="n">girl</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">()}</span><span class="err">`</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">stableMarriage</span><span class="p">(</span><span class="n">guys</span><span class="p">,</span> <span class="n">girls</span><span class="p">);</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pairings&quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">guy</span> <span class="n">of</span> <span class="n">guys</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`$</span><span class="p">{</span><span class="n">guy</span><span class="o">.</span><span class="n">name</span><span class="p">}:</span> <span class="err">$</span><span class="p">{</span><span class="n">guy</span><span class="o">.</span><span class="n">fiance</span><span class="o">.</span><span class="n">name</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="cs">
<h5>GaleShapleyAlgorithm.cs</h5>
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">submitted</span> <span class="n">by</span> <span class="n">Julian</span> <span class="n">Schacher</span> <span class="p">(</span><span class="n">jspp</span><span class="p">)</span> <span class="k">with</span> <span class="n">great</span> <span class="n">help</span> <span class="n">by</span> <span class="n">gustorn</span> <span class="ow">and</span> <span class="n">Marius</span> <span class="n">Becker</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Generic</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">StableMarriageProblem</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">GaleShapleyAlgorithm</span><span class="o">&lt;</span><span class="n">TFollow</span><span class="p">,</span> <span class="n">TLead</span><span class="o">&gt;</span>
        <span class="n">where</span> <span class="n">TFollow</span> <span class="p">:</span> <span class="n">Person</span><span class="o">&lt;</span><span class="n">TFollow</span><span class="p">,</span> <span class="n">TLead</span><span class="o">&gt;</span>
        <span class="n">where</span> <span class="n">TLead</span> <span class="p">:</span> <span class="n">Person</span><span class="o">&lt;</span><span class="n">TLead</span><span class="p">,</span> <span class="n">TFollow</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">RunGaleShapleyAlgorithm</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">TFollow</span><span class="o">&gt;</span> <span class="n">follows</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">TLead</span><span class="o">&gt;</span> <span class="n">leads</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="o">//</span> <span class="n">All</span> <span class="n">follows</span> <span class="n">are</span> <span class="n">lonely</span><span class="o">.</span>
            <span class="n">var</span> <span class="n">lonelyFollows</span> <span class="o">=</span> <span class="n">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">TFollow</span><span class="o">&gt;</span><span class="p">(</span><span class="n">follows</span><span class="p">);</span>

            <span class="o">//</span> <span class="n">Carry</span> <span class="n">on</span> <span class="n">until</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">lonely</span> <span class="n">follows</span> <span class="n">anymore</span><span class="o">.</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">lonelyFollows</span><span class="o">.</span><span class="n">Count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="o">//</span> <span class="n">Let</span> <span class="n">every</span> <span class="n">lonely</span> <span class="n">follow</span> <span class="n">propose</span> <span class="n">to</span> <span class="n">their</span> <span class="n">current</span> <span class="n">top</span> <span class="n">choice</span><span class="o">.</span>
                <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">lonelyFollow</span> <span class="ow">in</span> <span class="n">lonelyFollows</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">lonelyFollow</span><span class="o">.</span><span class="n">ProposeToNext</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="o">//</span> <span class="n">Look</span> <span class="n">which</span> <span class="n">follows</span> <span class="n">have</span> <span class="n">a</span> <span class="n">partner</span> <span class="n">now</span> <span class="ow">and</span> <span class="n">which</span> <span class="n">don</span><span class="s1">&#39;t.</span>
                <span class="n">var</span> <span class="n">newLonelyFollows</span> <span class="o">=</span> <span class="n">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">TFollow</span><span class="o">&gt;</span><span class="p">();</span>
                <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">follow</span> <span class="ow">in</span> <span class="n">follows</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">follow</span><span class="o">.</span><span class="n">Partner</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span>
                        <span class="n">newLonelyFollows</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">follow</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">lonelyFollows</span> <span class="o">=</span> <span class="n">newLonelyFollows</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
<h5>Person.cs</h5>
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">submitted</span> <span class="n">by</span> <span class="n">Julian</span> <span class="n">Schacher</span> <span class="p">(</span><span class="n">jspp</span><span class="p">)</span> <span class="k">with</span> <span class="n">great</span> <span class="n">help</span> <span class="n">by</span> <span class="n">gustorn</span> <span class="ow">and</span> <span class="n">Marius</span> <span class="n">Becker</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Generic</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">StableMarriageProblem</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">&lt;</span><span class="n">TSelf</span><span class="p">,</span> <span class="n">TPref</span><span class="o">&gt;</span>
        <span class="n">where</span> <span class="n">TSelf</span> <span class="p">:</span> <span class="n">Person</span><span class="o">&lt;</span><span class="n">TSelf</span><span class="p">,</span> <span class="n">TPref</span><span class="o">&gt;</span>
        <span class="n">where</span> <span class="n">TPref</span> <span class="p">:</span> <span class="n">Person</span><span class="o">&lt;</span><span class="n">TPref</span><span class="p">,</span> <span class="n">TSelf</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="n">public</span> <span class="n">TPref</span> <span class="n">Partner</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="n">public</span> <span class="n">IList</span><span class="o">&lt;</span><span class="n">TPref</span><span class="o">&gt;</span> <span class="n">Choices</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="o">//</span> <span class="n">CurrentTopChoice</span> <span class="n">equals</span> <span class="n">the</span> <span class="n">Choice</span> <span class="ow">in</span> <span class="n">Choices</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">TopChoice</span><span class="p">,</span>
        <span class="o">//</span> <span class="k">if</span> <span class="n">already</span> <span class="n">tried</span> <span class="n">women</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">counted</span><span class="o">.</span>
        <span class="n">public</span> <span class="nb">int</span> <span class="n">CurrentTopChoiceIndex</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="n">public</span> <span class="n">Person</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>

        <span class="n">public</span> <span class="n">void</span> <span class="n">ProposeToNext</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">interest</span> <span class="o">=</span> <span class="n">GetNextTopChoice</span><span class="p">();</span>

            <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">interest</span> <span class="n">has</span> <span class="n">no</span> <span class="n">partner</span> <span class="ow">or</span> <span class="n">prefers</span> <span class="n">this</span> <span class="n">person</span><span class="p">,</span>
            <span class="o">//</span> <span class="n">change</span> <span class="n">interest</span><span class="s1">&#39;s partner to this person.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">interest</span><span class="o">.</span><span class="n">Partner</span> <span class="o">==</span> <span class="n">null</span> <span class="o">||</span>
                <span class="n">interest</span><span class="o">.</span><span class="n">Choices</span><span class="o">.</span><span class="n">IndexOf</span><span class="p">(</span><span class="n">this</span> <span class="k">as</span> <span class="n">TSelf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">interest</span><span class="o">.</span><span class="n">Choices</span><span class="o">.</span><span class="n">IndexOf</span><span class="p">(</span><span class="n">interest</span><span class="o">.</span><span class="n">Partner</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="o">//</span> <span class="n">Should</span> <span class="n">the</span> <span class="n">interest</span> <span class="n">already</span> <span class="n">have</span> <span class="n">a</span> <span class="n">partner</span><span class="p">,</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">partner</span>
                <span class="o">//</span> <span class="n">of</span> <span class="n">the</span> <span class="n">interest</span><span class="s1">&#39;s partner to null.</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">interest</span><span class="o">.</span><span class="n">Partner</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
                    <span class="n">interest</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">Partner</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
                <span class="n">interest</span><span class="o">.</span><span class="n">Partner</span> <span class="o">=</span> <span class="n">this</span> <span class="k">as</span> <span class="n">TSelf</span><span class="p">;</span>
                <span class="n">Partner</span> <span class="o">=</span> <span class="n">interest</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">private</span> <span class="n">TPref</span> <span class="n">GetNextTopChoice</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="n">Choices</span><span class="p">[</span><span class="n">CurrentTopChoiceIndex</span><span class="o">++</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
<h5>Program.cs</h5>
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">submitted</span> <span class="n">by</span> <span class="n">Julian</span> <span class="n">Schacher</span> <span class="p">(</span><span class="n">jspp</span><span class="p">)</span> <span class="k">with</span> <span class="n">great</span> <span class="n">help</span> <span class="n">by</span> <span class="n">gustorn</span> <span class="ow">and</span> <span class="n">Marius</span> <span class="n">Becker</span>
<span class="n">using</span> <span class="n">System</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Generic</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">StableMarriageProblem</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="n">static</span> <span class="n">void</span> <span class="n">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s2">&quot;GaleShapleyAlgorithm&quot;</span><span class="p">);</span>
            <span class="o">//</span> <span class="n">Using</span> <span class="n">men</span> <span class="ow">and</span> <span class="n">women</span> <span class="k">as</span> <span class="n">an</span> <span class="n">example</span><span class="o">.</span>
            <span class="n">var</span> <span class="n">men</span> <span class="o">=</span> <span class="n">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Man</span><span class="o">&gt;</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">new</span> <span class="n">Man</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Man</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Man</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Man</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Man</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)</span>
            <span class="p">};</span>
            <span class="n">var</span> <span class="n">women</span> <span class="o">=</span> <span class="n">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Woman</span><span class="o">&gt;</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">),</span>
                <span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">),</span>
            <span class="p">};</span>

            <span class="n">var</span> <span class="n">random</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Random</span><span class="p">();</span>

            <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">man</span> <span class="ow">in</span> <span class="n">men</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">man</span><span class="o">.</span><span class="n">Choices</span> <span class="o">=</span> <span class="n">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Woman</span><span class="o">&gt;</span><span class="p">(</span><span class="n">women</span><span class="p">)</span><span class="o">.</span><span class="n">Shuffle</span><span class="p">(</span><span class="n">random</span><span class="p">);</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">man</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">);</span>
                <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">man</span><span class="o">.</span><span class="n">Choices</span><span class="p">)</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">Name</span><span class="p">);</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">woman</span> <span class="ow">in</span> <span class="n">women</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">woman</span><span class="o">.</span><span class="n">Choices</span> <span class="o">=</span> <span class="n">new</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Man</span><span class="o">&gt;</span><span class="p">(</span><span class="n">men</span><span class="p">)</span><span class="o">.</span><span class="n">Shuffle</span><span class="p">(</span><span class="n">random</span><span class="p">);</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">woman</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">);</span>
                <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">woman</span><span class="o">.</span><span class="n">Choices</span><span class="p">)</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">Name</span><span class="p">);</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="n">GaleShapleyAlgorithm</span><span class="o">&lt;</span><span class="n">Woman</span><span class="p">,</span> <span class="n">Man</span><span class="o">&gt;.</span><span class="n">RunGaleShapleyAlgorithm</span><span class="p">(</span><span class="n">women</span><span class="p">,</span> <span class="n">men</span><span class="p">);</span>

            <span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">woman</span> <span class="ow">in</span> <span class="n">women</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">woman</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="n">woman</span><span class="err">?</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">Name</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">class</span> <span class="nc">Man</span> <span class="p">:</span> <span class="n">Person</span><span class="o">&lt;</span><span class="n">Man</span><span class="p">,</span> <span class="n">Woman</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">Man</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">:</span> <span class="n">base</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">class</span> <span class="nc">Woman</span> <span class="p">:</span> <span class="n">Person</span><span class="o">&lt;</span><span class="n">Woman</span><span class="p">,</span> <span class="n">Man</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">Woman</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">:</span> <span class="n">base</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
<h5>ListExtensions.cs</h5>
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">System</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Generic</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">StableMarriageProblem</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">ListExtensions</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">static</span> <span class="n">IList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Shuffle</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">this</span> <span class="n">IList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nb">list</span><span class="p">,</span> <span class="n">Random</span> <span class="n">rng</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">list</span><span class="o">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">var</span> <span class="n">j</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">Next</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="o">.</span><span class="n">Count</span><span class="p">);</span>
                <span class="n">var</span> <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
                <span class="nb">list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="java">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StableMarriage</span> <span class="p">{</span>

    <span class="o">/*</span>
     <span class="o">*</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">stable</span> <span class="n">marriage</span> <span class="n">algorithm</span> <span class="n">to</span> <span class="n">find</span> <span class="n">stable</span> <span class="n">pairs</span> <span class="kn">from</span> <span class="nn">the</span>
     <span class="o">*</span> <span class="n">lists</span> <span class="n">of</span> <span class="n">men</span> <span class="ow">and</span> <span class="n">women</span><span class="o">.</span>
     <span class="o">*/</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">findStableMarriages</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Woman</span><span class="o">&gt;</span> <span class="n">women</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Man</span><span class="o">&gt;</span> <span class="n">men</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">We</span> <span class="n">might</span> <span class="n">have</span> <span class="n">more</span> <span class="n">men</span><span class="o">/</span><span class="n">women</span> <span class="n">than</span> <span class="n">women</span><span class="o">/</span><span class="n">men</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">case</span><span class="p">,</span> <span class="ow">not</span> <span class="n">everybody</span> <span class="n">can</span>
        <span class="o">//</span> <span class="n">get</span> <span class="n">a</span> <span class="n">mate</span><span class="o">.</span> <span class="n">We</span> <span class="n">should</span> <span class="n">aim</span> <span class="n">to</span> <span class="n">give</span> <span class="n">every</span> <span class="n">member</span> <span class="n">of</span> <span class="n">the</span> <span class="n">less</span> <span class="n">numerous</span> <span class="n">gender</span> <span class="n">a</span> <span class="n">mate</span><span class="p">,</span>
        <span class="o">//</span> <span class="k">as</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">always</span> <span class="n">possible</span><span class="o">.</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="err">?</span> <span class="n">extends</span> <span class="n">Person</span><span class="o">&gt;</span> <span class="n">leastCommonGender</span> <span class="o">=</span> <span class="n">women</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">men</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="err">?</span> <span class="n">women</span> <span class="p">:</span> <span class="n">men</span><span class="p">;</span>
        <span class="n">do</span> <span class="p">{</span>
            <span class="o">//</span> <span class="n">Every</span> <span class="n">single</span> <span class="n">man</span> <span class="n">proposes</span> <span class="n">to</span> <span class="n">a</span> <span class="n">woman</span><span class="o">.</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">Man</span> <span class="n">man</span> <span class="p">:</span> <span class="n">men</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">man</span><span class="o">.</span><span class="n">isLonely</span><span class="p">())</span>
                    <span class="n">man</span><span class="o">.</span><span class="n">propose</span><span class="p">();</span>

            <span class="o">//</span> <span class="n">The</span> <span class="n">women</span> <span class="n">pick</span> <span class="n">their</span> <span class="n">favorite</span> <span class="n">suitor</span><span class="o">.</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">Woman</span> <span class="n">woman</span> <span class="p">:</span> <span class="n">women</span><span class="p">)</span>
                <span class="n">woman</span><span class="o">.</span><span class="n">chooseMate</span><span class="p">();</span>

            <span class="o">//</span> <span class="n">End</span> <span class="n">the</span> <span class="n">process</span> <span class="k">if</span> <span class="n">everybody</span> <span class="n">has</span> <span class="n">a</span> <span class="n">mate</span><span class="o">.</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">leastCommonGender</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span><span class="o">.</span><span class="n">anyMatch</span><span class="p">(</span><span class="n">Person</span><span class="p">::</span><span class="n">isLonely</span><span class="p">))</span>
                <span class="k">break</span><span class="p">;</span>

        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">true</span><span class="p">);</span>

        <span class="n">women</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">w</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="s2">&quot; married to &quot;</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="n">getMate</span><span class="p">()));</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">nPairs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Woman</span><span class="o">&gt;</span> <span class="n">women</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Man</span><span class="o">&gt;</span> <span class="n">men</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">char</span> <span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="s1">&#39;A&#39;</span> <span class="o">+</span> <span class="n">nPairs</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">women</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>
            <span class="n">men</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new</span> <span class="n">Man</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="o">//</span> <span class="n">Make</span> <span class="n">the</span> <span class="n">genders</span> <span class="n">unbalanced</span><span class="p">:</span>
        <span class="n">women</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">));</span>

        <span class="n">women</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">w</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="n">w</span><span class="o">.</span><span class="n">receiveOptions</span><span class="p">(</span><span class="n">men</span><span class="p">);</span>
            <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="s2">&quot; prefers &quot;</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="n">getPreferredMates</span><span class="p">());</span>
        <span class="p">});</span>
        <span class="n">men</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="n">m</span><span class="o">.</span><span class="n">receiveOptions</span><span class="p">(</span><span class="n">women</span><span class="p">);</span>
            <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="s2">&quot; prefers &quot;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">getPreferredMates</span><span class="p">());</span>
        <span class="p">});</span>

        <span class="n">findStableMarriages</span><span class="p">(</span><span class="n">women</span><span class="p">,</span> <span class="n">men</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">final</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">protected</span> <span class="n">Person</span> <span class="n">mate</span><span class="p">;</span>
    <span class="n">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">preferredMates</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">Person</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">boolean</span> <span class="n">isLonely</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">mate</span> <span class="o">==</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setMate</span><span class="p">(</span><span class="n">Person</span> <span class="n">mate</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Only</span> <span class="nb">set</span> <span class="n">mates</span> <span class="k">if</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">change</span><span class="o">.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">mate</span> <span class="o">!=</span> <span class="n">mate</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">//</span> <span class="n">Remove</span> <span class="n">old</span> <span class="n">mates</span> <span class="n">mate</span><span class="o">.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">mate</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
                <span class="n">this</span><span class="o">.</span><span class="n">mate</span><span class="o">.</span><span class="n">mate</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>

            <span class="o">//</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">new</span> <span class="n">mate</span><span class="o">.</span>
            <span class="n">this</span><span class="o">.</span><span class="n">mate</span> <span class="o">=</span> <span class="n">mate</span><span class="p">;</span>

            <span class="o">//</span> <span class="n">If</span> <span class="n">new</span> <span class="n">mate</span> <span class="ow">is</span> <span class="n">someone</span><span class="p">,</span> <span class="n">update</span> <span class="n">their</span> <span class="n">mate</span><span class="o">.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mate</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
                <span class="n">mate</span><span class="o">.</span><span class="n">mate</span> <span class="o">=</span> <span class="n">this</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">Person</span> <span class="n">getMate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">mate</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">receiveOptions</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="err">?</span> <span class="n">extends</span> <span class="n">Person</span><span class="o">&gt;</span> <span class="n">mates</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Preferences</span> <span class="n">are</span> <span class="n">subjective</span><span class="o">.</span>
        <span class="n">preferredMates</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">mates</span><span class="p">);</span>
        <span class="n">Collections</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">preferredMates</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">getPreferredMates</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">preferredMates</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Woman</span> <span class="n">extends</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Man</span><span class="o">&gt;</span> <span class="n">suitors</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

    <span class="n">public</span> <span class="n">Woman</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">recieveProposal</span><span class="p">(</span><span class="n">Man</span> <span class="n">suitor</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">suitors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">suitor</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">chooseMate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Person</span> <span class="n">mostDesired</span> <span class="p">:</span> <span class="n">preferredMates</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mostDesired</span> <span class="o">==</span> <span class="n">mate</span> <span class="o">||</span> <span class="n">suitors</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mostDesired</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">setMate</span><span class="p">(</span><span class="n">mostDesired</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Man</span> <span class="n">extends</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">Man</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">propose</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">preferredMates</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">Woman</span> <span class="n">fiance</span> <span class="o">=</span> <span class="p">(</span><span class="n">Woman</span><span class="p">)</span> <span class="n">preferredMates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="n">fiance</span><span class="o">.</span><span class="n">recieveProposal</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="php">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>
<span class="n">declare</span><span class="p">(</span><span class="n">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="n">private</span> <span class="err">$</span><span class="n">name</span><span class="p">;</span>
    <span class="n">private</span> <span class="err">$</span><span class="n">suitors</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="n">private</span> <span class="err">$</span><span class="n">preferences</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="n">private</span> <span class="err">$</span><span class="n">match</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">__construct</span><span class="p">(</span><span class="err">$</span><span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="err">$</span><span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">getName</span><span class="p">():</span> <span class="n">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">setPreferences</span><span class="p">(</span><span class="n">array</span> <span class="err">$</span><span class="n">preferences</span><span class="p">):</span> <span class="n">void</span>
    <span class="p">{</span>
        <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">preferences</span> <span class="o">=</span> <span class="err">$</span><span class="n">preferences</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">getMatch</span><span class="p">():</span> <span class="err">?</span><span class="n">Person</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">getPreferences</span><span class="p">():</span> <span class="n">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">preferences</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">isSingle</span><span class="p">():</span> <span class="nb">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span> <span class="o">===</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">unmatch</span><span class="p">():</span> <span class="n">void</span>
    <span class="p">{</span>
        <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">setMatch</span><span class="p">(</span><span class="n">Person</span> <span class="err">$</span><span class="n">match</span><span class="p">):</span> <span class="n">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span> <span class="o">!==</span> <span class="err">$</span><span class="n">match</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span> <span class="o">!==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span><span class="o">-&gt;</span><span class="n">unmatch</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span> <span class="o">=</span> <span class="err">$</span><span class="n">match</span><span class="p">;</span>
            <span class="err">$</span><span class="n">match</span><span class="o">-&gt;</span><span class="n">setMatch</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">propose</span><span class="p">():</span> <span class="n">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">empty</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">preferences</span><span class="p">))</span> <span class="p">{</span>
            <span class="err">$</span><span class="n">fiance</span> <span class="o">=</span> <span class="n">array_shift</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">preferences</span><span class="p">);</span>
            <span class="err">$</span><span class="n">fiance</span><span class="o">-&gt;</span><span class="n">receiveProposal</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">receiveProposal</span><span class="p">(</span><span class="n">Person</span> <span class="err">$</span><span class="n">man</span><span class="p">):</span> <span class="n">void</span>
    <span class="p">{</span>
        <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">suitors</span><span class="p">[]</span> <span class="o">=</span> <span class="err">$</span><span class="n">man</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">chooseMatch</span><span class="p">():</span> <span class="n">void</span>
    <span class="p">{</span>
        <span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">preferences</span> <span class="k">as</span> <span class="err">$</span><span class="n">preference</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="n">preference</span> <span class="o">===</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">match</span> <span class="o">||</span> <span class="n">in_array</span><span class="p">(</span><span class="err">$</span><span class="n">preference</span><span class="p">,</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">suitors</span><span class="p">))</span> <span class="p">{</span>
                <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">setMatch</span><span class="p">(</span><span class="err">$</span><span class="n">preference</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">suitors</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">function</span> <span class="n">__toString</span><span class="p">():</span> <span class="n">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">stable_marriage</span><span class="p">(</span><span class="n">array</span> <span class="err">$</span><span class="n">men</span><span class="p">,</span> <span class="n">array</span> <span class="err">$</span><span class="n">women</span><span class="p">):</span> <span class="n">void</span>
<span class="p">{</span>
    <span class="n">do</span> <span class="p">{</span>
        <span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">men</span> <span class="k">as</span> <span class="err">$</span><span class="n">man</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="n">man</span><span class="o">-&gt;</span><span class="n">isSingle</span><span class="p">())</span> <span class="p">{</span>
                <span class="err">$</span><span class="n">man</span><span class="o">-&gt;</span><span class="n">propose</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">women</span> <span class="k">as</span> <span class="err">$</span><span class="n">woman</span><span class="p">)</span> <span class="p">{</span>
            <span class="err">$</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">chooseMatch</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="err">$</span><span class="n">unmarried</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
        <span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">women</span> <span class="k">as</span> <span class="err">$</span><span class="n">woman</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="err">$</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">isSingle</span><span class="p">())</span> <span class="p">{</span>
                <span class="err">$</span><span class="n">unmarried</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="err">$</span><span class="n">unmarried</span><span class="p">);</span>
<span class="p">}</span>

<span class="err">$</span><span class="n">groupSize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="err">$</span><span class="n">men</span> <span class="o">=</span> <span class="p">[];</span>
<span class="err">$</span><span class="n">women</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span> <span class="p">(</span><span class="err">$</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="err">$</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="err">$</span><span class="n">groupSize</span><span class="p">;</span> <span class="err">$</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="err">$</span><span class="n">men</span><span class="p">[]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;M$</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="err">$</span><span class="n">women</span><span class="p">[]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;W$</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">men</span> <span class="k">as</span> <span class="err">$</span><span class="n">man</span><span class="p">)</span> <span class="p">{</span>
    <span class="err">$</span><span class="n">preferences</span> <span class="o">=</span> <span class="err">$</span><span class="n">women</span><span class="p">;</span>
    <span class="n">shuffle</span><span class="p">(</span><span class="err">$</span><span class="n">preferences</span><span class="p">);</span>
    <span class="err">$</span><span class="n">man</span><span class="o">-&gt;</span><span class="n">setPreferences</span><span class="p">(</span><span class="err">$</span><span class="n">preferences</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">s choices: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="err">$</span><span class="n">man</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">(),</span> <span class="n">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="err">$</span><span class="n">man</span><span class="o">-&gt;</span><span class="n">getPreferences</span><span class="p">()));</span>
    <span class="n">echo</span> <span class="n">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">echo</span> <span class="n">PHP_EOL</span><span class="p">;</span>
<span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">women</span> <span class="k">as</span> <span class="err">$</span><span class="n">woman</span><span class="p">)</span> <span class="p">{</span>
    <span class="err">$</span><span class="n">preferences</span> <span class="o">=</span> <span class="err">$</span><span class="n">men</span><span class="p">;</span>
    <span class="n">shuffle</span><span class="p">(</span><span class="err">$</span><span class="n">preferences</span><span class="p">);</span>
    <span class="err">$</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">setPreferences</span><span class="p">(</span><span class="err">$</span><span class="n">preferences</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">s choices: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="err">$</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">(),</span> <span class="n">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="err">$</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">getPreferences</span><span class="p">()));</span>
    <span class="n">echo</span> <span class="n">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">echo</span> <span class="n">PHP_EOL</span><span class="p">;</span>

<span class="n">stable_marriage</span><span class="p">(</span><span class="err">$</span><span class="n">men</span><span class="p">,</span> <span class="err">$</span><span class="n">women</span><span class="p">);</span>
<span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">women</span> <span class="k">as</span> <span class="err">$</span><span class="n">woman</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is married to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="err">$</span><span class="n">woman</span><span class="p">,</span> <span class="err">$</span><span class="n">woman</span><span class="o">-&gt;</span><span class="n">getMatch</span><span class="p">());</span>
    <span class="n">echo</span> <span class="n">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="scala">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.collection.mutable._</span>

<span class="nb">object</span> <span class="n">StableMarriage</span> <span class="p">{</span>

  <span class="n">var</span> <span class="n">bachelors</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">[</span><span class="n">Man</span><span class="p">]()</span>

  <span class="n">case</span> <span class="k">class</span> <span class="nc">Man</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">var</span> <span class="n">preferences</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Woman</span><span class="p">]</span> <span class="o">=</span> <span class="n">List</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">def</span> <span class="nf">propose</span><span class="p">():</span> <span class="n">Unit</span> <span class="o">=</span> <span class="n">preferences</span> <span class="n">match</span> <span class="p">{</span>
      <span class="n">case</span> <span class="n">woman</span> <span class="p">::</span> <span class="n">remainingPreferences</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">woman</span><span class="o">.</span><span class="n">prefers</span><span class="p">(</span><span class="n">this</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">bachelors</span> <span class="o">++=</span> <span class="n">woman</span><span class="o">.</span><span class="n">fiance</span>
          <span class="n">woman</span><span class="o">.</span><span class="n">fiance</span> <span class="o">=</span> <span class="n">Some</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">else</span>
          <span class="n">bachelors</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
        <span class="n">preferences</span> <span class="o">=</span> <span class="n">remainingPreferences</span>
      <span class="p">}</span>
      <span class="n">case</span> <span class="n">_</span> <span class="o">=&gt;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">case</span> <span class="k">class</span> <span class="nc">Woman</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">var</span> <span class="n">preferences</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Man</span><span class="p">]</span> <span class="o">=</span> <span class="n">List</span><span class="p">(),</span> <span class="n">var</span> <span class="n">fiance</span><span class="p">:</span> <span class="n">Option</span><span class="p">[</span><span class="n">Man</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">def</span> <span class="nf">prefers</span><span class="p">(</span><span class="n">man</span><span class="p">:</span> <span class="n">Man</span><span class="p">):</span> <span class="n">Boolean</span> <span class="o">=</span>
      <span class="n">fiance</span> <span class="n">match</span> <span class="p">{</span>
        <span class="n">case</span> <span class="n">Some</span><span class="p">(</span><span class="n">otherMan</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">preferences</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">man</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">preferences</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">otherMan</span><span class="p">)</span>
        <span class="n">case</span> <span class="n">_</span> <span class="o">=&gt;</span> <span class="n">true</span> <span class="o">//</span><span class="n">always</span> <span class="n">prefer</span> <span class="nb">any</span> <span class="n">man</span> <span class="n">over</span> <span class="n">nobody</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">findStableMatches</span><span class="p">(</span><span class="n">men</span><span class="p">:</span> <span class="n">Man</span><span class="o">*</span><span class="p">):</span> <span class="n">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">bachelors</span> <span class="o">=</span> <span class="n">men</span><span class="o">.</span><span class="n">to</span><span class="p">[</span><span class="n">Queue</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">bachelors</span><span class="o">.</span><span class="n">nonEmpty</span><span class="p">)</span>
      <span class="n">bachelors</span><span class="o">.</span><span class="n">dequeue</span><span class="o">.</span><span class="n">propose</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nb">object</span> <span class="n">StableMarriageExample</span> <span class="p">{</span>

  <span class="n">val</span> <span class="n">a</span> <span class="o">=</span> <span class="n">StableMarriage</span><span class="o">.</span><span class="n">Man</span><span class="p">(</span><span class="s2">&quot;Adam&quot;</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">b</span> <span class="o">=</span> <span class="n">StableMarriage</span><span class="o">.</span><span class="n">Man</span><span class="p">(</span><span class="s2">&quot;Bart&quot;</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">c</span> <span class="o">=</span> <span class="n">StableMarriage</span><span class="o">.</span><span class="n">Man</span><span class="p">(</span><span class="s2">&quot;Colm&quot;</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">x</span> <span class="o">=</span> <span class="n">StableMarriage</span><span class="o">.</span><span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;Xena&quot;</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">y</span> <span class="o">=</span> <span class="n">StableMarriage</span><span class="o">.</span><span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;Yeva&quot;</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">z</span> <span class="o">=</span> <span class="n">StableMarriage</span><span class="o">.</span><span class="n">Woman</span><span class="p">(</span><span class="s2">&quot;Zara&quot;</span><span class="p">)</span>

  <span class="n">a</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
  <span class="n">b</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="n">c</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="n">x</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
  <span class="n">y</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
  <span class="n">z</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">]):</span> <span class="n">Unit</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">StableMarriage</span><span class="o">.</span><span class="n">findStableMatches</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="n">List</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span>
      <span class="n">w</span> <span class="o">=&gt;</span> <span class="n">Console</span><span class="o">.</span><span class="n">println</span><span class="p">(</span>
        <span class="n">w</span><span class="o">.</span><span class="n">name</span>
          <span class="o">+</span> <span class="s2">&quot; is married to &quot;</span>
          <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="n">fiance</span><span class="o">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="n">StableMarriage</span><span class="o">.</span><span class="n">Man</span><span class="p">(</span><span class="s2">&quot;Nobody&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>

</div></p>
</div>
</div>

<script>
MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
</script>

<h2>License</h2>
<h5>Code Examples</h5>
<p>The code examples are licensed under the MIT license (found in <a href="https://github.com/algorithm-archivists/algorithm-archive/blob/master/LICENSE.md">LICENSE.md</a>).</p>
<h5>Text</h5>
<p>The text of this chapter was written by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><p><img  class="center" src="../cc/CC-BY-SA_icon.svg" /></p></a></p>
<h5>Pull Requests</h5>
<p>After initial licensing (<a href="https://github.com/algorithm-archivists/algorithm-archive/pull/560">#560</a>), the following pull requests have modified the text or graphics of this chapter:
- none</p>
        <hr>
    </div>
</body>
</html>