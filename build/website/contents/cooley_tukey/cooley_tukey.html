<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel=stylesheet href="/pygments.css" type="text/css">
    <link rel=stylesheet href="/styles/style.css" type="text/css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <title id="ttl"></title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [['$','$']]}
        });
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        var bjs = {"gitbook": "3.x.x", "plugins": ["fontsettings", "mathjax@https://github.com/algorithm-archivists/plugin-mathjax", "bibtex-cite", "wordcount", "api-language-selector@https://github.com/algorithm-archivists/gitbook-plugin-api-language-selector.git", "include-codeblock", "ga", "bulk-redirect", "prism", "-highlight"], "lunr": {"maxIndexSize": 1000000000}, "pluginsConfig": {"mathjax": {"version": "2.6.1"}, "include-codeblock": {"fixlang": true, "unindent": true}, "bulk-redirect": {"basepath": "/", "redirectsFile": "redirects.json"}, "ga": {"token": "UA-118252470-1"}, "prism": {"lang": {"asm-x64": "nasm"}, "ignore": ["emojicode", "text"], "css": ["prismjs/themes/prism-tomorrow.css"]}, "api-language-selector": {"languages": [{"lang": "jl", "name": "Julia", "default": true}, {"lang": "bash", "name": "Bash"}, {"lang": "cs", "name": "C#"}, {"lang": "cpp", "name": "C++"}, {"lang": "c", "name": "C"}, {"lang": "c8", "name": "chip-8"}, {"lang": "py", "name": "Python"}, {"lang": "js", "name": "JavaScript"}, {"lang": "scratch", "name": "Scratch"}, {"lang": "hs", "name": "Haskell"}, {"lang": "rs", "name": "Rust"}, {"lang": "ml", "name": "OCaml"}, {"lang": "java", "name": "Java"}, {"lang": "clj", "name": "Clojure"}, {"lang": "elm", "name": "Elm"}, {"lang": "LabVIEW", "name": "LabVIEW"}, {"lang": "d", "name": "D"}, {"lang": "go", "name": "Go"}, {"lang": "swift", "name": "Swift"}, {"lang": "racket", "name": "Racket"}, {"lang": "m", "name": "Matlab"}, {"lang": "r", "name": "R"}, {"lang": "ti83b", "name": "TI-83 Basic"}, {"lang": "lua", "name": "Lua"}, {"lang": "crystal", "name": "Crystal"}, {"lang": "php", "name": "PHP"}, {"lang": "lisp", "name": "Common Lisp"}, {"lang": "nim", "name": "Nim"}, {"lang": "asm-x64", "name": "X86-64 Assembly"}, {"lang": "f90", "name": "Fortran90"}, {"lang": "factor", "name": "Factor"}, {"lang": "ws", "name": "Whitespace"}, {"lang": "scala", "name": "Scala"}, {"lang": "emojic", "name": "Emojicode"}, {"lang": "lolcode", "name": "LOLCODE"}, {"lang": "piet", "name": "Piet"}, {"lang": "ss", "name": "Scheme"}, {"lang": "ps1", "name": "PowerShell"}, {"lang": "v", "name": "Vlang"}, {"lang": "coffee", "name": "CoffeeScript"}, {"lang": "kotlin", "name": "Kotlin"}]}}};		    
        var lang = "jl";
        var langs = {};
        var langNames = bjs.pluginsConfig["api-language-selector"].languages;
        var translations = {
            "python": "Python",
            "bf": "Brainfuck",
            "st": "Smalltalk",
            "ruby": "Ruby",
            "kotlin": "Kotlin",
            "bash": "Bash",
            "haskell": "Haskell",
            "matlab": "Matlab",
            "javascript": "JavaScript"
        };
	
        function initLangs () {
            var samples = document.getElementsByClassName("code-section");
            for (var a = 0; a < samples.length; a++) {
                var sample = samples[a];
                var children = sample.children;
                for (var b = 0; b < children.length; b++)  {
                    var element = children[b];
                    langs[element.className] = true;
                };
            };
	    langs = Object.keys(langs);
	    if (langs.length == 1) {
		lang = langs[0];
	    }
            langNames.forEach(function(element) { translations[element.lang] = element.name });
        }
        function reload() {
            var samples = document.getElementsByClassName("code-section");
            for (var a = 0; a < samples.length; a++) {
                var sample = samples[a];
                var children = sample.children;
                for (var b = 0; b < children.length; b++)  {
                    var element = children[b];
                    if (element.className == lang) {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                };
            };
        };
        window.onload = () => {
            initLangs();
            reload();
            document.getElementById("name").innerText = pages[index];
            document.getElementById("ttl").innerText = pages[index];
            initLs();
        };
        var index = 23;
        var pages = [];
	var lsed = false;
				
        function flipLs () {
            var ls = document.getElementById("ls");
            var ls2 = document.getElementById("ls2");
            if (lsed) {
                ls.style.display = 'none';
                ls2.style.display = 'none';
            } else {
                ls.style.display = 'block';
                ls2.style.display = 'block';
            }
            lsed = !lsed
        }

	var funcs = {};
        function initLs () {
            if (langs.length === 0) {
                document.getElementById("flipper").remove();
            } else {
                var h1 = 0;
                var h2 = 0;
                for (var i = 0; i < langs.length; i++) {
                    let language = langs[i];
		    console.log(language);
		    var elem = document.createElement("p");
                    funcs[language] = {}
                    funcs[language] = () => {
                        lang = language;
                        reload();
                    };
                    elem.innerHTML = "<a onclick='funcs[\"" + language + "\"]()' href='#' class=ls-link>" + translations[language] + "</a>";
                    if (i % 2) {
                        h2 += 1
                        document.getElementById("ls2").appendChild(elem);
                    } else {
                        h1 += 1
                        document.getElementById("ls").appendChild(elem);
                    }
                }
                if (h1 > h2) {
                    var elem = document.createElement("p");
                    elem.innerHTML = "&nbsp;";
                    document.getElementById("ls2").appendChild(elem);
                } else if (h2 > h1) {
                    var elem = document.createElement("p");
                    elem.innerHTML = "&nbsp;";
                    document.getElementById("ls").appendChild(elem);
                }
                document.getElementById("ls").style.display = "none";
                document.getElementById("ls2").style.display = "none";
            }
        }
        function toggleSidenav () {
            $("#sidebar").toggleClass("hide");
            $("#content").toggleClass("on-sidebar");
            $("#navbar").toggleClass("no-sidebar");
        }
    </script>
    <div class="sidebar-wrapper" id="sidebar">
        
            <p>
                
                <a name="Algorithm Archive"></a>
                <a href="/index.html#Algorithm Archive">Algorithm Archive</a>
                <script>pages[0] = "Algorithm Archive"</script>
            </p>
        
            <p>
                
                <a name="Introduction"></a>
                <a href="/contents/introduction/introduction.html#Introduction">Introduction</a>
                <script>pages[1] = "Introduction"</script>
            </p>
        
            <p>
                
                <a name="How To Contribute"></a>
                <a href="/contents/how_to_contribute/how_to_contribute.html#How To Contribute">How To Contribute</a>
                <script>pages[2] = "How To Contribute"</script>
            </p>
        
            <p>
                
                <a name="Plotting"></a>
                <a href="/contents/plotting/plotting.html#Plotting">Plotting</a>
                <script>pages[3] = "Plotting"</script>
            </p>
        
            <p>
                
                <a name="Data Structures"></a>
                <a href="/contents/data_structures/data_structures.html#Data Structures">Data Structures</a>
                <script>pages[4] = "Data Structures"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Stacks and Queues"></a>
                <a href="/contents/stacks_and_queues/stacks_and_queues.html#Stacks and Queues">Stacks and Queues</a>
                <script>pages[5] = "Stacks and Queues"</script>
            </p>
        
            <p>
                
                <a name="Mathematical Background"></a>
                <a href="/contents/mathematical_background/mathematical_background.html#Mathematical Background">Mathematical Background</a>
                <script>pages[6] = "Mathematical Background"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Complexity Notation"></a>
                <a href="/contents/notation/notation.html#Complexity Notation">Complexity Notation</a>
                <script>pages[7] = "Complexity Notation"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bit Logic"></a>
                <a href="/contents/bitlogic/bitlogic.html#Bit Logic">Bit Logic</a>
                <script>pages[8] = "Bit Logic"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Taylor Series"></a>
                <a href="/contents/taylor_series_expansion/taylor_series_expansion.html#Taylor Series">Taylor Series</a>
                <script>pages[9] = "Taylor Series"</script>
            </p>
        
            <p>
                
                <a name="Sorting and Searching"></a>
                <a href="/contents/sorting_and_searching/sorting_and_searching.html#Sorting and Searching">Sorting and Searching</a>
                <script>pages[10] = "Sorting and Searching"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bubble Sort"></a>
                <a href="/contents/bubble_sort/bubble_sort.html#Bubble Sort">Bubble Sort</a>
                <script>pages[11] = "Bubble Sort"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bogo Sort"></a>
                <a href="/contents/bogo_sort/bogo_sort.html#Bogo Sort">Bogo Sort</a>
                <script>pages[12] = "Bogo Sort"</script>
            </p>
        
            <p>
                
                <a name="Tree Traversal"></a>
                <a href="/contents/tree_traversal/tree_traversal.html#Tree Traversal">Tree Traversal</a>
                <script>pages[13] = "Tree Traversal"</script>
            </p>
        
            <p>
                
                <a name="Euclidean Algorithm"></a>
                <a href="/contents/euclidean_algorithm/euclidean_algorithm.html#Euclidean Algorithm">Euclidean Algorithm</a>
                <script>pages[14] = "Euclidean Algorithm"</script>
            </p>
        
            <p>
                
                <a name="Monte Carlo"></a>
                <a href="/contents/monte_carlo_integration/monte_carlo_integration.html#Monte Carlo">Monte Carlo</a>
                <script>pages[15] = "Monte Carlo"</script>
            </p>
        
            <p>
                
                <a name="Matrix Methods"></a>
                <a href="/contents/matrix_methods/matrix_methods.html#Matrix Methods">Matrix Methods</a>
                <script>pages[16] = "Matrix Methods"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Gaussian Elimination"></a>
                <a href="/contents/gaussian_elimination/gaussian_elimination.html#Gaussian Elimination">Gaussian Elimination</a>
                <script>pages[17] = "Gaussian Elimination"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Thomas Algorithm"></a>
                <a href="/contents/thomas_algorithm/thomas_algorithm.html#Thomas Algorithm">Thomas Algorithm</a>
                <script>pages[18] = "Thomas Algorithm"</script>
            </p>
        
            <p>
                
                <a name="Computational Geometry"></a>
                <a href="/contents/computational_geometry/computational_geometry.html#Computational Geometry">Computational Geometry</a>
                <script>pages[19] = "Computational Geometry"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Gift Wrapping"></a>
                <a href="/contents/gift_wrapping/gift_wrapping.html#Gift Wrapping">Gift Wrapping</a>
                <script>pages[20] = "Gift Wrapping"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Jarvis March"></a>
                <a href="/contents/jarvis_march/jarvis_march.html#Jarvis March">Jarvis March</a>
                <script>pages[21] = "Jarvis March"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Graham Scan"></a>
                <a href="/contents/graham_scan/graham_scan.html#Graham Scan">Graham Scan</a>
                <script>pages[22] = "Graham Scan"</script>
            </p>
        
            <p>
                
                <a name="FFT"></a>
                <a href="/contents/cooley_tukey/cooley_tukey.html#FFT">FFT</a>
                <script>pages[23] = "FFT"</script>
            </p>
        
            <p>
                
                <a name="Decision Problems"></a>
                <a href="/contents/decision_problems/decision_problems.html#Decision Problems">Decision Problems</a>
                <script>pages[24] = "Decision Problems"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Stable Marriage Problem"></a>
                <a href="/contents/stable_marriage_problem/stable_marriage_problem.html#Stable Marriage Problem">Stable Marriage Problem</a>
                <script>pages[25] = "Stable Marriage Problem"</script>
            </p>
        
            <p>
                
                <a name="Differential Equation Solvers"></a>
                <a href="/contents/differential_equations/differential_equations.html#Differential Equation Solvers">Differential Equation Solvers</a>
                <script>pages[26] = "Differential Equation Solvers"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Forward Euler Method"></a>
                <a href="/contents/forward_euler_method/forward_euler_method.html#Forward Euler Method">Forward Euler Method</a>
                <script>pages[27] = "Forward Euler Method"</script>
            </p>
        
            <p>
                
                <a name="Physics Solvers"></a>
                <a href="/contents/physics_solvers/physics_solvers.html#Physics Solvers">Physics Solvers</a>
                <script>pages[28] = "Physics Solvers"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Verlet Integration"></a>
                <a href="/contents/verlet_integration/verlet_integration.html#Verlet Integration">Verlet Integration</a>
                <script>pages[29] = "Verlet Integration"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Quantum Systems"></a>
                <a href="/contents/quantum_systems/quantum_systems.html#Quantum Systems">Quantum Systems</a>
                <script>pages[30] = "Quantum Systems"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Split-Operator Method"></a>
                <a href="/contents/split-operator_method/split-operator_method.html#Split-Operator Method">Split-Operator Method</a>
                <script>pages[31] = "Split-Operator Method"</script>
            </p>
        
            <p>
                
                <a name="Data Compression"></a>
                <a href="/contents/data_compression/data_compression.html#Data Compression">Data Compression</a>
                <script>pages[32] = "Data Compression"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Huffman Encoding"></a>
                <a href="/contents/huffman_encoding/huffman_encoding.html#Huffman Encoding">Huffman Encoding</a>
                <script>pages[33] = "Huffman Encoding"</script>
            </p>
        
            <p>
                
                <a name="Quantum Information"></a>
                <a href="/contents/quantum_information/quantum_information.html#Quantum Information">Quantum Information</a>
                <script>pages[34] = "Quantum Information"</script>
            </p>
        
        <hr>
    </div>
    <nav class="navbarrio" id=navbar>
        <ul class="navbarro">
            <li>
                <span onclick="toggleSidenav()">
                    <i class="fas fa-align-left"></i>
                </button>
            </li>
            <li>
                <span onclick="flipLs()" id=flipper>
                    <i class="fas fa-code"></i>
                    <div class=ls id=ls></div>
                    <div class=ls2 id=ls2></div>
                </span>
            </li>
            <li>
                <span id=name></span>
            </li>
        </ul>
    </nav>
    <div class="container-fluid on-sidebar" id="content">
        <h2>What Makes a Fourier Transform Fast?</h2>
<p>If there were ever an algorithm to radically change the landscape of computer science and engineering by making seemingly impossible problems possible, it would be the Fast Fourier Transform (FFT).
On the surface, the algorithm seems like a simple application of recursion, and in principle, that is exactly what it is; however, the Fourier Transform is no ordinary transform -- it allows researchers and engineers to easily bounce back and forth between real space and frequency space and is the heart of many physics and engineering applications.
From calculating superfluid vortex positions to super-resolution imaging, Fourier Transforms lay at the heart of many scientific disciplines and are essential to many algorithms we will cover later in this book.</p>
<p>Simply put, the Fourier Transform is a beautiful application of complex number systems; however, it would rarely be used today if not for the ability to quickly perform the operation with Fast Fourier Transform, first introduced by the great Frederick Gauss in 1805 and later independently discovered by James Cooley and John Tukey in 1965 <a href="#ref-1">[1]</a>.
Gauss (of course) already had too many things named after him and Cooley and Tukey both had cooler names, so the most common algorithm for FFT's today is known as the Cooley-Tukey algorithm.</p>
<h3>What is a Fourier Transform?</h3>
<p>To an outsider, the Fourier Transform looks like a mathematical mess -- certainly a far cry from the heroic portal between two domains I have depicted it to be; however, like most things, it's not as bad as it initially appears to be.
So, here it is in all it's glory!</p>
<p><script type='math/tex'>F(\xi) = \int_{-\infty} ^\infty f(x) e^{-2 \pi i x \xi} dx</script></p>
<p>and</p>
<p><script type='math/tex'>f(x) = \int_{-\infty} ^\infty F(\xi) e^{2 \pi i \xi x} d\xi</script></p>
<p>Where <script type='math/tex'>F(\xi)</script> represents a function in frequency space, <script type='math/tex'>\xi</script> represents a value in frequency space, <script type='math/tex'>f(x)</script> represents a function in real space, and <script type='math/tex'>x</script> represents a value in the real space.
Note here that the only difference between the two exponential terms is a minus sign in the transformation to frequency space.
As I mentioned, this is not intuitive syntax, so please allow me to explain a bit.</p>
<p>Firstly, <strong>what does the Fourier Transform do?</strong></p>
<p>If we take a sum sinusoidal functions (like <script type='math/tex'>\sin(\omega t)</script> or <script type='math/tex'>\cos(\omega t)</script>), we might find a complicated mess of waves between <script type='math/tex'>\pm 1</script>.
Each constituent wave can be described by only one value: <script type='math/tex'>\omega</script>.
So, instead of representing these curves as seen above, we could instead describe them as peaks in frequency space, as shown below.</p>
<p>
    <img  class="center" src="res/FT_example.png" width="500" />
</p>

<p>This is what the Fourier Transform does!
After performing the transform, it is now much, much easier to understand precisely which frequencies are in our waveform, which is essential to most areas of signal processing.</p>
<p>Now, how does this relate to the transformations above?
Well, the easiest way is to substitute in the Euler's formula:</p>
<p><script type='math/tex'>e^{2 \pi i \theta} = \cos(2 \pi \theta) + i \sin(2 \pi \theta)</script></p>
<p>This clearly turns our function in frequency space into:</p>
<p><script type='math/tex'>F(\xi) = \int_{-\infty} ^\infty f(x) (\cos(-2 \pi x \xi) + i \sin(-2 \pi x \xi))dx</script></p>
<p>and our function in real space into:</p>
<p><script type='math/tex'>f(x) = \int_{-\infty} ^\infty F(\xi) (\cos(2 \pi \xi x) + i \sin(2 \pi \xi x)) d\xi</script></p>
<p>Here, the <script type='math/tex'>\sin</script> and <script type='math/tex'>\cos</script> functions are clearly written in the formulas, so it looks much friendlier, right?
This means that a point in real space is defined by the integral over all space of it's corresponding frequency function multiplied by sinusoidal oscillations.</p>
<p>Truth be told, even after seeing this math, I still didn't understand Fourier Transforms.
Truth be told, I didn't understand it fully until I discretized real and frequency space to create the Discrete Fourier Transform (DFT), which is the only way to implement Fourier Transforms in code.</p>
<h3>What is a Discrete Fourier Transform?</h3>
<p>In principle, the Discrete Fourier Transform (DFT) is simply the Fourier transform with summations instead of integrals:</p>
<p><script type='math/tex'>X_k = \sum_{n=0}^{N-1} x_n \cdot e^{-2 \pi i k n / N}</script></p>
<p>and</p>
<p><script type='math/tex'>x_n = \frac{1}{N} \sum_{k=0}^{N-1} X_k \cdot e^{2 \pi i k n / N}</script></p>
<p>Where <script type='math/tex'>X_n</script> and <script type='math/tex'>x_n</script> are sequences of <script type='math/tex'>N</script> numbers in frequency and real space, respectively.
In principle, this is no easier to understand than the previous case!
For some reason, though, putting code to this transformation really helped me figure out what was actually going on.</p>
<div class=code-section>
<div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">DFT</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># We want two vectors here for real space (n) and frequency space (k)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">n</span><span class="s1">&#39;</span>
    <span class="n">transform_matrix</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">im</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transform_matrix</span><span class="o">*</span><span class="n">x</span>

<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">dft</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">const</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="nb">complex</span> <span class="n">tmp</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">cexp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">N</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">N</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="clj">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defn</span> <span class="n">dft</span>
  <span class="s2">&quot;take a vector of real numbers and return a vector of frequency</span>
  <span class="n">space</span><span class="s2">&quot;</span>
  <span class="p">[</span><span class="n">vx</span><span class="p">]</span>
  <span class="p">(</span><span class="n">let</span> <span class="p">[</span><span class="nb">len</span> <span class="p">(</span><span class="n">count</span> <span class="n">vx</span><span class="p">)]</span>
     <span class="p">(</span><span class="n">matrix</span><span class="o">-</span><span class="n">mult</span>
      <span class="p">(</span><span class="n">partition</span> <span class="nb">len</span>
                 <span class="p">(</span><span class="k">for</span> <span class="p">[</span><span class="n">n</span> <span class="p">(</span><span class="nb">range</span> <span class="nb">len</span><span class="p">)</span>
                       <span class="n">k</span> <span class="p">(</span><span class="nb">range</span> <span class="nb">len</span><span class="p">)]</span>
                   <span class="p">;;</span> <span class="n">expresion</span> <span class="n">below</span> <span class="ow">is</span>
                   <span class="p">;;</span> <span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">))</span>
                   <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">exp</span> <span class="p">(</span><span class="n">c</span><span class="o">/*</span> <span class="n">n</span> <span class="n">k</span>
                               <span class="mi">2</span> <span class="n">Math</span><span class="o">/</span><span class="n">PI</span>
                               <span class="p">(</span><span class="o">/</span> <span class="nb">len</span><span class="p">)</span>
                               <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="nb">complex</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))))</span>
      <span class="n">vx</span><span class="p">)))</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">template</span> <span class="o">&lt;</span><span class="n">typename</span> <span class="n">Iter</span><span class="o">&gt;</span>
<span class="n">void</span> <span class="n">dft</span><span class="p">(</span><span class="n">Iter</span> <span class="n">X</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">auto</span> <span class="n">N</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">X</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">complex</span><span class="o">&gt;</span> <span class="n">tmp</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span> <span class="o">/</span> <span class="n">N</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="p">::</span><span class="n">copy</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">begin</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="n">std</span><span class="p">::</span><span class="n">end</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="n">X</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">dft</span> <span class="p">::</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span>
<span class="n">dft</span> <span class="n">x</span> <span class="o">=</span> <span class="n">matMult</span> <span class="n">dftMat</span> <span class="n">x</span>
  <span class="n">where</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span> <span class="n">x</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">exp</span> <span class="err">$</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span> <span class="p">:</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">fromIntegral</span> <span class="n">n</span>
    <span class="n">dftMat</span> <span class="o">=</span> <span class="p">[[</span><span class="n">w</span> <span class="o">^</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="o">|</span> <span class="n">j</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">|</span> <span class="n">k</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">matMult</span> <span class="n">m</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">(</span><span class="nb">sum</span> <span class="o">.</span> <span class="n">zipWith</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">x</span><span class="p">)</span> <span class="n">m</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dft</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">N</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temp</span>
</pre></div>

</div></p>
</div><div class="scratch">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">DFT</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># We want two vectors here for real space (n) and frequency space (k)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">n</span><span class="s1">&#39;</span>
    <span class="n">transform_matrix</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">im</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transform_matrix</span><span class="o">*</span><span class="n">x</span>

<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="asm-x64">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1"># rdi - array ptr</span>
<span class="c1"># rsi - array size</span>
<span class="n">dft</span><span class="p">:</span>
  <span class="n">push</span>   <span class="n">rbx</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">push</span>   <span class="n">r13</span>
  <span class="n">push</span>   <span class="n">r14</span>
  <span class="n">push</span>   <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rdi</span>                    <span class="c1"># Save parameters</span>
  <span class="n">mov</span>    <span class="n">r13</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r13</span>                    <span class="c1"># Make a double complex array</span>
  <span class="n">xor</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">r14</span>                    <span class="c1"># Set index to 0</span>
<span class="n">dft_loop_i</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">r13</span>                    <span class="c1"># Check if index is equal to array size</span>
  <span class="n">je</span>     <span class="n">dft_end_i</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>            <span class="c1"># Set tmp array to zero at r14</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">],</span> <span class="mi">0</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="mi">0</span>
  <span class="n">xor</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r15</span>                    <span class="c1"># Set second index to 0</span>
<span class="n">dft_loop_j</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r13</span>                    <span class="c1"># Check if the index is equal to array size</span>
  <span class="n">je</span>     <span class="n">dft_end_j</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">two_pi</span>                <span class="c1"># Calculate xmm1 = -2pi * i * j / N</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">imul</span>   <span class="n">rax</span><span class="p">,</span> <span class="n">r15</span>
  <span class="n">shr</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">4</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm2</span><span class="p">,</span> <span class="n">rax</span>
  <span class="n">mulsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm2</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">divsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">pxor</span>   <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Set xmm0 to 0</span>
  <span class="n">call</span>   <span class="n">cexp</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r15</span><span class="p">]</span>            <span class="c1"># Calculate X[i] * cexp(-2pi * i * j / N)</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">__muldc3</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>       <span class="c1"># Sum to tmp array</span>
  <span class="n">movsd</span>  <span class="n">xmm7</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">addsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">addsd</span>  <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">],</span> <span class="n">xmm6</span>       <span class="c1"># Save to tmp array</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm7</span>
  <span class="n">add</span>    <span class="n">r15</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">dft_loop_j</span>
<span class="n">dft_end_j</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">dft_loop_i</span>
<span class="n">dft_end_i</span><span class="p">:</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">r12</span>                    <span class="c1"># Move tmp array to array ptr</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="n">rsp</span>
  <span class="n">mov</span>    <span class="n">rdx</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">call</span>   <span class="n">memcpy</span>
  <span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r15</span>
  <span class="n">pop</span>    <span class="n">r14</span>
  <span class="n">pop</span>    <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">pop</span>    <span class="n">rbx</span>
  <span class="n">ret</span>
</pre></div>

</div></p>
</div><div class="js">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">dft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>

  <span class="o">//</span> <span class="n">Initialize</span> <span class="n">an</span> <span class="n">array</span> <span class="k">with</span> <span class="n">N</span> <span class="n">elements</span><span class="p">,</span> <span class="n">filled</span> <span class="k">with</span> <span class="mi">0</span><span class="n">s</span>
  <span class="k">return</span> <span class="n">Array</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="o">.</span><span class="n">map</span><span class="p">((</span><span class="n">temp</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="o">//</span> <span class="n">Reduce</span> <span class="n">x</span> <span class="n">into</span> <span class="n">the</span> <span class="nb">sum</span> <span class="n">of</span> <span class="n">x_k</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()));</span>
      <span class="p">},</span> <span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="o">//</span> <span class="n">Start</span> <span class="n">accumulating</span> <span class="kn">from</span> <span class="mi">0</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div>
</div>

<p>In this function, we define <code>n</code> to be a set of integers from <script type='math/tex'>0 \rightarrow N-1</script> and arrange them to be a column.
We then set <code>k</code> to be the same thing, but in a row.
This means that when we multiply them together, we get a matrix, but not just any matrix!
This matrix is the heart to the transformation itself!</p>
<div class="codehilite"><pre><span></span><code><span class="err">M = [1.0+0.0im  1.0+0.0im           1.0+0.0im          1.0+0.0im;</span>
<span class="err">     1.0+0.0im  6.12323e-17-1.0im  -1.0-1.22465e-16im -1.83697e-16+1.0im;</span>
<span class="err">     1.0+0.0im -1.0-1.22465e-16im   1.0+2.44929e-16im -1.0-3.67394e-16im;</span>
<span class="err">     1.0+0.0im -1.83697e-16+1.0im  -1.0-3.67394e-16im  5.51091e-16-1.0im]</span>
</code></pre></div>


<p>It was amazing to me when I saw the transform for what it truly was: an actual transformation matrix!
That said, the Discrete Fourier Transform is slow -- primarily because matrix multiplication is slow, and as mentioned before, slow code is not particularly useful.
So what was the trick that everyone used to go from a Discrete Fourier Transform to a <em>Fast</em> Fourier Transform?</p>
<p>Recursion!</p>
<h3>The Cooley-Tukey Algorithm</h3>
<p>The problem with using a standard DFT is that it requires a large matrix multiplications and sums over all elements, which are prohibitively complex operations.
The Cooley-Tukey algorithm calculates the DFT directly with fewer summations and without matrix multiplications.
If necessary, DFT's can still be calculated directly at the early stages of the FFT calculation.
The trick to the Cooley-Tukey algorithm is recursion.
In particular, we split the matrix we wish to perform the FFT on into two parts: one for all elements with even indices and another for all odd indices.
We then proceed to split the array again and again until we have a manageable array size to perform a DFT (or similar FFT) on.
We can also perform a similar re-ordering by using a bit reversal scheme, where we output each array index's integer value in binary and flip it to find the new location of that element.
With recursion, we can reduce the complexity to <script type='math/tex'>\sim \mathcal{O}(n \log n)</script>, which is a feasible operation.</p>
<p>In the end, the code looks like:</p>
<div class=code-section>
<div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_odd</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
        <span class="n">x_even</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
    <span class="k">else</span>
        <span class="n">x_odd</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_even</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">end</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">im</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vcat</span><span class="p">(</span><span class="n">x_odd</span> <span class="o">.+</span> <span class="n">x_even</span> <span class="o">.*</span> <span class="n">factor</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">half</span><span class="p">],</span>
                <span class="n">x_odd</span> <span class="o">.-</span> <span class="n">x_even</span> <span class="o">.*</span> <span class="n">factor</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">half</span><span class="p">])</span>

<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">const</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">double</span> <span class="nb">complex</span> <span class="n">tmp</span> <span class="p">[</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cexp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="clj">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defn</span> <span class="n">fft</span> <span class="p">[</span><span class="n">vx</span><span class="p">]</span>
  <span class="p">(</span><span class="n">let</span> <span class="p">[</span><span class="nb">len</span> <span class="p">(</span><span class="n">count</span> <span class="n">vx</span><span class="p">)]</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="o">=</span> <span class="nb">len</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">vx</span>
      <span class="p">;;</span><span class="k">else</span>
      <span class="p">(</span><span class="n">let</span> <span class="p">[;;</span> <span class="n">take</span> <span class="n">values</span> <span class="n">of</span> <span class="n">vx</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">even</span> <span class="n">indices</span>
            <span class="n">even</span><span class="o">-</span><span class="n">indices</span> <span class="p">(</span><span class="n">keep</span><span class="o">-</span><span class="n">indexed</span> <span class="c1">#(if (even? %1) %2) vx)</span>
            <span class="p">;;</span> <span class="n">take</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">odd</span> <span class="n">indices</span>
            <span class="n">odd</span><span class="o">-</span><span class="n">indices</span> <span class="p">(</span><span class="n">keep</span><span class="o">-</span><span class="n">indexed</span> <span class="c1">#(if (odd? %1) %2) vx)</span>
            <span class="p">;;</span> <span class="n">recursion</span>
            <span class="n">even</span><span class="o">-</span><span class="n">fft</span> <span class="p">(</span><span class="n">fft</span> <span class="n">even</span><span class="o">-</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">odd</span><span class="o">-</span><span class="n">fft</span> <span class="p">(</span><span class="n">fft</span> <span class="n">odd</span><span class="o">-</span><span class="n">indices</span><span class="p">)</span>
            <span class="p">;;</span> <span class="n">make</span> <span class="n">a</span> <span class="n">sequence</span> <span class="n">of</span> <span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="n">where</span> <span class="n">N</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">length</span>
            <span class="p">;;</span> <span class="n">vx</span> <span class="ow">and</span> <span class="n">k</span> <span class="nb">range</span> <span class="kn">from</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">N</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">omegas</span><span class="o">-</span><span class="n">half</span> <span class="p">(</span><span class="nb">map</span>
                         <span class="p">(</span><span class="n">comp</span> <span class="n">c</span><span class="o">/</span><span class="n">exp</span>
                               <span class="p">(</span><span class="n">partial</span> <span class="n">c</span><span class="o">/*</span>
                                        <span class="p">(</span><span class="o">/</span> <span class="nb">len</span><span class="p">)</span>
                                        <span class="mi">2</span> <span class="n">Math</span><span class="o">/</span><span class="n">PI</span>
                                        <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="nb">complex</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
                         <span class="p">(</span><span class="nb">range</span> <span class="mi">0</span> <span class="p">(</span><span class="n">quot</span> <span class="nb">len</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="p">;;</span> <span class="n">take</span> <span class="n">the</span> <span class="n">negative</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="n">sequence</span> <span class="n">because</span>
            <span class="p">;;</span> <span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="o">=-</span><span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="n">where</span> <span class="n">k</span> <span class="n">ranges</span> <span class="kn">from</span>
            <span class="p">;;</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">N</span><span class="o">/</span><span class="mi">2</span> 
            <span class="n">omegas</span><span class="o">-</span><span class="mi">2</span><span class="n">half</span> <span class="p">(</span><span class="nb">map</span> <span class="n">c</span><span class="o">/-</span> <span class="n">omegas</span><span class="o">-</span><span class="n">half</span><span class="p">)</span>
            <span class="n">mult</span><span class="o">-</span><span class="n">add</span> <span class="p">(</span><span class="n">partial</span> <span class="nb">map</span> <span class="c1">#(c/+ %3 (c/* %1 %2)))]</span>
        <span class="p">(</span><span class="n">concat</span> <span class="p">(</span><span class="n">mult</span><span class="o">-</span><span class="n">add</span> <span class="n">omegas</span><span class="o">-</span><span class="n">half</span> <span class="n">odd</span><span class="o">-</span><span class="n">fft</span> <span class="n">even</span><span class="o">-</span><span class="n">fft</span><span class="p">)</span>
                <span class="p">(</span><span class="n">mult</span><span class="o">-</span><span class="n">add</span> <span class="n">omegas</span><span class="o">-</span><span class="mi">2</span><span class="n">half</span> <span class="n">odd</span><span class="o">-</span><span class="n">fft</span> <span class="n">even</span><span class="o">-</span><span class="n">fft</span><span class="p">))))))</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">template</span> <span class="o">&lt;</span><span class="n">typename</span> <span class="n">Iter</span><span class="o">&gt;</span>
<span class="n">void</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">Iter</span> <span class="n">first</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">split</span> <span class="n">the</span> <span class="nb">range</span><span class="p">,</span> <span class="k">with</span> <span class="n">even</span> <span class="n">indices</span> <span class="n">going</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">first</span> <span class="n">half</span><span class="p">,</span>
    <span class="o">//</span> <span class="ow">and</span> <span class="n">odd</span> <span class="n">indices</span> <span class="n">going</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">last</span> <span class="n">half</span><span class="o">.</span>
    <span class="n">auto</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">complex</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
      <span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">first</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">recurse</span> <span class="n">the</span> <span class="n">splits</span> <span class="ow">and</span> <span class="n">butterflies</span> <span class="ow">in</span> <span class="n">each</span> <span class="n">half</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">range</span>
    <span class="n">auto</span> <span class="n">split</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">split</span><span class="p">);</span>
    <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">last</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">now</span> <span class="n">combine</span> <span class="n">each</span> <span class="n">of</span> <span class="n">those</span> <span class="n">halves</span> <span class="k">with</span> <span class="n">the</span> <span class="n">butterflies</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">auto</span> <span class="n">w</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">size</span><span class="p">));</span>

      <span class="n">auto</span><span class="o">&amp;</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
      <span class="n">auto</span><span class="o">&amp;</span> <span class="n">top</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
      <span class="n">top</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">w</span> <span class="o">*</span> <span class="n">top</span><span class="p">;</span>
      <span class="n">bottom</span> <span class="o">-=</span> <span class="n">top</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fft</span> <span class="p">::</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span>
<span class="n">fft</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fft</span><span class="s1">&#39; x</span>
  <span class="n">where</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span> <span class="n">x</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="n">exp</span> <span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span> <span class="p">:</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">fromIntegral</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[(</span><span class="n">k</span> <span class="o">%</span> <span class="n">n</span><span class="p">,</span> <span class="n">w0</span> <span class="o">^</span> <span class="n">k</span><span class="p">)</span> <span class="o">|</span> <span class="n">k</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">fft</span><span class="s1">&#39; [x] = [x]</span>
    <span class="n">fft</span><span class="s1">&#39; x =</span>
      <span class="n">let</span> <span class="p">(</span><span class="n">evens</span><span class="p">,</span> <span class="n">odds</span><span class="p">)</span> <span class="o">=</span> <span class="n">partition</span> <span class="p">(</span><span class="n">even</span> <span class="o">.</span> <span class="n">fst</span><span class="p">)</span> <span class="err">$</span> <span class="nb">zip</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span><span class="p">]</span> <span class="n">x</span>
          <span class="n">e</span> <span class="o">=</span> <span class="n">fft</span><span class="s1">&#39; $ map snd evens</span>
          <span class="n">o</span> <span class="o">=</span> <span class="n">fft</span><span class="s1">&#39; $ map snd odds</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">zipWith3</span> <span class="p">(</span>\<span class="n">e</span> <span class="n">o</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="n">e</span> <span class="o">+</span> <span class="n">o</span> <span class="o">*</span> <span class="n">w</span> <span class="err">!</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span><span class="n">n</span><span class="p">))</span> <span class="n">e</span> <span class="n">o</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span><span class="p">]</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">zipWith3</span> <span class="p">(</span>\<span class="n">e</span> <span class="n">o</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="n">e</span> <span class="o">-</span> <span class="n">o</span> <span class="o">*</span> <span class="n">w</span> <span class="err">!</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span><span class="n">n</span><span class="p">))</span> <span class="n">e</span> <span class="n">o</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span><span class="p">]</span>
       <span class="ow">in</span> <span class="n">x1</span> <span class="o">++</span> <span class="n">x2</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
	<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">X</span>
	<span class="n">even</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
	<span class="n">odd</span> <span class="o">=</span>  <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
		<span class="n">temp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">even</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">odd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
		<span class="n">temp</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">even</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">odd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">temp</span>
</pre></div>

</div></p>
</div><div class="scratch">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_odd</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
        <span class="n">x_even</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
    <span class="k">else</span>
        <span class="n">x_odd</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_even</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">end</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">im</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vcat</span><span class="p">(</span><span class="n">x_odd</span> <span class="o">.+</span> <span class="n">x_even</span> <span class="o">.*</span> <span class="n">factor</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">half</span><span class="p">],</span>
                <span class="n">x_odd</span> <span class="o">.-</span> <span class="n">x_even</span> <span class="o">.*</span> <span class="n">factor</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">half</span><span class="p">])</span>

<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="asm-x64">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1"># rdi - array ptr</span>
<span class="c1"># rsi - array size</span>
<span class="n">cooley_tukey</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">rsi</span><span class="p">,</span> <span class="mi">16</span>                     <span class="c1"># Check if size if greater then 1</span>
  <span class="n">jle</span>    <span class="n">cooley_tukey_return</span>
  <span class="n">push</span>   <span class="n">rbx</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">push</span>   <span class="n">r13</span>
  <span class="n">push</span>   <span class="n">r14</span>
  <span class="n">push</span>   <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rdi</span>                    <span class="c1"># Save parameters</span>
  <span class="n">mov</span>    <span class="n">r13</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">mov</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">rsi</span>                    <span class="c1"># Save N / 2</span>
  <span class="n">shr</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r14</span>                    <span class="c1"># Make a tmp array</span>
  <span class="n">xor</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">rbx</span><span class="p">,</span> <span class="n">r12</span>
<span class="n">cooley_tukey_spliting</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">je</span>     <span class="n">cooley_tukey_split</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r15</span><span class="p">]</span>        <span class="c1"># Moving all odd entries to the front of the array</span>
  <span class="n">movaps</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">xmm1</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="n">r15</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rbx</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">add</span>    <span class="n">rbx</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">add</span>    <span class="n">r15</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">cooley_tukey_spliting</span>
<span class="n">cooley_tukey_split</span><span class="p">:</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">rsp</span>
  <span class="n">lea</span>    <span class="n">rdi</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r13</span><span class="p">]</span>
<span class="n">cooley_tukey_mov_data</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">rbx</span><span class="p">,</span> <span class="n">rdi</span>
  <span class="n">je</span>     <span class="n">cooley_tukey_moved</span>
  <span class="n">movaps</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rbx</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">add</span>    <span class="n">rbx</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">add</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">cooley_tukey_mov_data</span>
<span class="n">cooley_tukey_moved</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">r12</span>                   <span class="c1"># Makking a recursive call</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">call</span>   <span class="n">cooley_tukey</span>
  <span class="n">lea</span>    <span class="n">rdi</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>           <span class="c1"># Makking a recursive call</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">call</span>   <span class="n">cooley_tukey</span>
  <span class="n">lea</span>    <span class="n">rbx</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>
  <span class="n">mov</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">mov</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r12</span>
<span class="n">cooley_tukey_loop</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">je</span>     <span class="n">cooley_tukey_end</span>
  <span class="n">pxor</span>   <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                 <span class="c1"># Calculate cexp(-2.0 * I * M_PI * i / N)</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">two_pi</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">sub</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm2</span><span class="p">,</span> <span class="n">rax</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm3</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">divsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">mulsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">call</span>   <span class="n">cexp</span>
  <span class="n">movq</span>   <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span><span class="p">]</span>      <span class="c1"># Calculating X[i] - cexp() * X[i + N / 2]</span>
  <span class="n">movq</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">__muldc3</span>
  <span class="n">movq</span>   <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span><span class="p">]</span>
  <span class="n">movq</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">subsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">subsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span><span class="p">],</span> <span class="n">xmm2</span>      <span class="c1"># Save value in X[i + N / 2]</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm3</span>
  <span class="n">movq</span>   <span class="n">xmm0</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span><span class="p">]</span>      <span class="c1"># Calculating X[i] -= X[i + N / 2] - X[i]</span>
  <span class="n">movq</span>   <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">subsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">subsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">subsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">add</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">add</span>    <span class="n">r15</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">cooley_tukey_loop</span>
<span class="n">cooley_tukey_end</span><span class="p">:</span>
  <span class="n">pop</span>    <span class="n">r15</span>
  <span class="n">pop</span>    <span class="n">r14</span>
  <span class="n">pop</span>    <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">pop</span>    <span class="n">rbx</span>
<span class="n">cooley_tukey_return</span><span class="p">:</span>
  <span class="n">ret</span>
</pre></div>

</div></p>
</div><div class="js">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">cooley_tukey</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">N</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">half</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Extract even and odd indexed elements with remainder mod 2</span>
  <span class="kr">const</span> <span class="nx">evens</span> <span class="o">=</span> <span class="nx">cooley_tukey</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">!</span><span class="p">(</span><span class="nx">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)));</span>
  <span class="kr">const</span> <span class="nx">odds</span> <span class="o">=</span> <span class="nx">cooley_tukey</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">));</span>

  <span class="c1">// Fill an array with null values</span>
  <span class="kd">let</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">N</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">half</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">arg</span> <span class="o">=</span> <span class="nx">odds</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">mul</span><span class="p">(</span><span class="k">new</span> <span class="nx">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)</span> <span class="o">/</span> <span class="nx">N</span><span class="p">).</span><span class="nx">exp</span><span class="p">());</span>

    <span class="nx">temp</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">evens</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="nx">temp</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">half</span><span class="p">]</span> <span class="o">=</span> <span class="nx">evens</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">sub</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">temp</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div>
</div>

<p>As a side note, we are enforcing that the array must be a power of 2 for the operation to work.
This is a limitation of the fact that we are using recursion and dividing the array in 2 every time; however, if your array is not a power of 2, you can simply pad the leftover space with 0's until your array is a power of 2.</p>
<p>The above method is a perfectly valid FFT; however, it is missing the pictorial heart and soul of the Cooley-Tukey algorithm: Butterfly Diagrams.</p>
<h3>Butterfly Diagrams</h3>
<p>Butterfly Diagrams show where each element in the array goes before, during, and after the FFT.
As mentioned, the FFT must perform a DFT.
This means that even though we need to be careful about how we add elements together, we are still ultimately performing the following operation:</p>
<p><script type='math/tex'>X_k = \sum_{n=0}^{N-1} x_n \cdot e^{-2 \pi i k n / N}</script></p>
<p>However, after shuffling the initial array (by bit reversing or recursive subdivision), we perform the matrix multiplication of the <script type='math/tex'>e^{-2 \pi k n / N}</script> terms in pieces.
Basically, we split the array into a series of omega values:</p>
<p><script type='math/tex'>\omega_N^k = e^{-2 \pi i k / N}</script></p>
<p>And at each step, we use the appropriate term.
For example, imagine we need to perform an FFT of an array of only 2 elements.
We can represent this addition with the following (radix-2) butterfly:</p>
<p>
    <img  class="center" src="res/radix-2screen_positive.jpg" width="400" />
</p>

<p>Here, the diagram means the following:</p>
<p><script type='math/tex'>
b_0 = a_0 + \omega_2^0 a_1 \</p>
<p>b_1 = a_0 + \omega_2^1 a_1
</script></p>
<p>However, it turns out that the second half of our array of <script type='math/tex'>\omega</script> values is always the negative of the first half, so <script type='math/tex'>\omega_2^0 = -\omega_2^1</script>, so we can use the following butterfly diagram:</p>
<p>
    <img  class="center" src="res/radix-2screen.jpg" width="400" />
</p>

<p>With the following equations:</p>
<p><script type='math/tex'>
b_0 = a_0 + \omega_2^0 a_1 \</p>
<p>b_1 = a_0 - \omega_2^0 a_1
</script></p>
<p>By swapping out the second <script type='math/tex'>\omega</script> value in this way, we can save a good amount of space.
Now imagine we need to combine more elements.
In this case, we start with simple butterflies, as shown above, and then sum butterflies of butterflies.
For example, if we have 8 elements, this might look like this:</p>
<p>
    <img  class="center" src="res/radix-8screen.jpg" width="500" />
</p>

<p>Note that we can perform a DFT directly before using any butterflies, if we so desire, but we need to be careful with how we shuffle our array if that's the case.
In the code snippet provided in the previous section, the subdivision was performed in the same function as the concatenation, so the ordering was always correct; however, if we were to re-order with bit-reversal, this might not be the case.</p>
<p>For example, take a look at the ordering of FFT (<a href="https://en.wikipedia.org/wiki/Butterfly_diagram">found on wikipedia</a>) that performs the DFT shortcut:</p>
<p>
    <img  class="center" src="res/butterfly_diagram.png" width="600" />
</p>

<p>Here, the ordering of the array was simply divided into even and odd elements once, but they did not recursively divide the arrays of even and odd elements again because they knew they would perform a DFT soon thereafter.</p>
<p>Ultimately, that's all I want to say about Fourier Transforms for now, but this chapter still needs a good amount of work!
I'll definitely come back to this at some point, so let me know what you liked and didn't like and we can go from there!</p>
<h3>Bibliography</h3>
<p><a name="ref-1" class=bib-link></a>[Person('Cooley, James W'), Person('Tukey, John W')]: An algorithm for the machine calculation of complex Fourier series, <i>JSTOR</i>, 1965</p>
<h2>Example Code</h2>
<p>To be clear, the example code this time will be complicated and requires the following functions:</p>
<ul>
<li>An FFT library (either in-built or something like FFTW)</li>
<li>An approximation function to tell if two arrays are similar</li>
</ul>
<p>As mentioned in the text, the Cooley-Tukey algorithm may be implemented either recursively or non-recursively, with the recursive method being much easier to implement.
I would ask that you implement either the recursive or non-recursive methods (or both, if you feel so inclined).
If the language you want to write your implementation in is already used, please append your code to the already existing codebase.
As before, pull requests are favoured.</p>
<p>Note: I implemented this in Julia because the code seems more straightforward in Julia; however, if you wish to write better Julia code or better code in your own language, please feel free to do so!
<strong>I do not claim that this is the most efficient way to implement the Cooley-Tukey method, so if you have a better way to do it, feel free to implement it that way!</strong></p>
<div class=code-section>
<div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">FFTW</span>

<span class="c1">#simple DFT function</span>
<span class="n">function</span> <span class="n">DFT</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># We want two vectors here for real space (n) and frequency space (k)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">n</span><span class="s1">&#39;</span>
    <span class="n">transform_matrix</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">im</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transform_matrix</span><span class="o">*</span><span class="n">x</span>

<span class="n">end</span>

<span class="c1"># Implementing the Cooley-Tukey Algorithm</span>
<span class="n">function</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_odd</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
        <span class="n">x_even</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
    <span class="k">else</span>
        <span class="n">x_odd</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_even</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">end</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">im</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vcat</span><span class="p">(</span><span class="n">x_odd</span> <span class="o">.+</span> <span class="n">x_even</span> <span class="o">.*</span> <span class="n">factor</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">half</span><span class="p">],</span>
                <span class="n">x_odd</span> <span class="o">.-</span> <span class="n">x_even</span> <span class="o">.*</span> <span class="n">factor</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">half</span><span class="p">])</span>

<span class="n">end</span>

<span class="n">function</span> <span class="n">bitreverse</span><span class="p">(</span><span class="n">a</span><span class="p">::</span><span class="n">Array</span><span class="p">)</span>
    <span class="c1"># First, we need to find the necessary number of bits</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span><span class="n">ceil</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">a</span><span class="p">))))</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">bit_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">push</span><span class="err">!</span><span class="p">(</span><span class="n">bit_indices</span><span class="p">,</span> <span class="n">bitstring</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">end</span>

    <span class="c1"># Now stripping the unnecessary numbers</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">bit_indices</span><span class="p">)</span>
        <span class="n">bit_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit_indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">end</span><span class="o">-</span><span class="n">digits</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">end</span>

    <span class="c1"># Flipping the bits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">bit_indices</span><span class="p">)</span>
        <span class="n">bit_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">bit_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">end</span>

    <span class="c1"># Replacing indices</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">digits</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">parse</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">string</span><span class="p">(</span><span class="n">bit_indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">end</span><span class="o">-</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">end</span>
       <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">end</span>

    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">b</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">logN</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span><span class="n">ceil</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
    <span class="n">bnum</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">bitreverse</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">Complex</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">logN</span>
       <span class="n">stride</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">bnum</span><span class="p">)</span>
       <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">bnum</span><span class="o">-</span><span class="mi">1</span>
           <span class="n">start_index</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="n">stride</span> <span class="o">+</span> <span class="mi">1</span>
           <span class="n">y</span> <span class="o">=</span> <span class="n">butterfly</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">stride</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
           <span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
               <span class="n">z</span><span class="p">[</span><span class="n">start_index</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
           <span class="n">end</span>
       <span class="n">end</span>
       <span class="n">bnum</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">bnum</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">z</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">butterfly</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">im</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="mf">0.0</span><span class="n">im</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">half</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">half</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">factor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y</span><span class="p">[</span><span class="n">half</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">half</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">factor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">y</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">main</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">isapprox</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Recursive Cooley Tukey matches fft() from FFTW package.&quot;</span><span class="p">)</span>
    <span class="n">end</span>
    <span class="k">if</span><span class="p">(</span><span class="n">isapprox</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Iterative Cooley Tukey matches fft() from FFTW package.&quot;</span><span class="p">)</span>
    <span class="n">end</span>
<span class="n">end</span>

<span class="n">main</span><span class="p">()</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1">#include &lt;complex.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>
<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;string.h&gt;</span>
<span class="c1">#include &lt;time.h&gt;</span>
<span class="c1">#include &lt;fftw3.h&gt;</span>

<span class="n">void</span> <span class="n">fft</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="nb">complex</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">y</span><span class="p">));</span>
    <span class="n">fftw_plan</span> <span class="n">p</span><span class="p">;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">fftw_plan_dft_1d</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">fftw_complex</span><span class="o">*</span><span class="p">)</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">fftw_complex</span><span class="o">*</span><span class="p">)</span><span class="n">y</span><span class="p">,</span>
                         <span class="n">FFTW_FORWARD</span><span class="p">,</span> <span class="n">FFTW_ESTIMATE</span><span class="p">);</span>

    <span class="n">fftw_execute</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">fftw_destroy_plan</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">double</span><span class="p">)</span><span class="n">n</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">dft</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">const</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="nb">complex</span> <span class="n">tmp</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">cexp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">N</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">N</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">const</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">double</span> <span class="nb">complex</span> <span class="n">tmp</span> <span class="p">[</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cexp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">bit_reverse</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="nb">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="nb">int</span> <span class="n">count</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="n">log2</span><span class="p">((</span><span class="n">double</span><span class="p">)</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

        <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">count</span><span class="o">--</span><span class="p">;</span>
            <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">count</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="n">log2</span><span class="p">((</span><span class="n">double</span><span class="p">)</span><span class="n">N</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">double</span> <span class="nb">complex</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
            <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">bit_reverse</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">log2</span><span class="p">((</span><span class="n">double</span><span class="p">)</span><span class="n">N</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">stride</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">double</span> <span class="nb">complex</span> <span class="n">w</span> <span class="o">=</span> <span class="n">cexp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="n">stride</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="n">stride</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">double</span> <span class="nb">complex</span> <span class="n">v</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
                <span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
                <span class="n">v</span> <span class="o">*=</span> <span class="n">w</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">approx</span><span class="p">(</span><span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">double</span> <span class="nb">complex</span> <span class="o">*</span><span class="n">Y</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cabs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">cabs</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1E-5</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;This is not approximate.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;This is approximate.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="n">NULL</span><span class="p">));</span>
    <span class="n">double</span> <span class="nb">complex</span> <span class="n">x</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">RAND_MAX</span><span class="p">;</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">fft</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
    <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
    <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>

    <span class="n">approx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
    <span class="n">approx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="clj">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ns</span> <span class="n">fft</span><span class="o">.</span><span class="n">core</span>
  <span class="p">(:</span><span class="n">require</span> <span class="p">[</span><span class="nb">complex</span><span class="o">.</span><span class="n">core</span> <span class="p">:</span><span class="k">as</span> <span class="n">c</span><span class="p">]))</span>
<span class="p">;;</span> <span class="nb">complex</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">jar</span> <span class="k">for</span> <span class="nb">complex</span> <span class="n">numbers</span>
<span class="p">;;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">alanforr</span><span class="o">/</span><span class="nb">complex</span>
<span class="p">;;</span> <span class="n">add</span> <span class="p">[</span><span class="nb">complex</span> <span class="s2">&quot;0.1.11&quot;</span><span class="p">]</span> <span class="n">to</span> <span class="p">:</span><span class="n">dependencies</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">project</span><span class="o">.</span><span class="n">clj</span>
<span class="p">;;</span> <span class="ow">and</span> <span class="n">run</span> <span class="n">lein</span> <span class="n">repl</span> <span class="ow">or</span> <span class="n">lein</span> <span class="n">deps</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">terminal</span>
<span class="p">(</span><span class="n">defn</span> <span class="n">matrix</span><span class="o">-</span><span class="n">mult</span>
  <span class="s2">&quot;take a matrix m and a vector v which length is number of columns</span>
  <span class="p">,</span><span class="k">return</span> <span class="n">a</span> <span class="n">vector</span> <span class="n">of</span> <span class="n">applying</span> <span class="n">dot</span><span class="o">-</span><span class="n">product</span> <span class="n">between</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">each</span> <span class="n">row</span> <span class="n">of</span>
  <span class="n">m</span><span class="o">.</span> <span class="n">the</span> <span class="n">returned</span> <span class="n">vector</span><span class="s1">&#39;s length is the number of rows of m&quot;</span>
  <span class="p">[</span><span class="n">m</span> <span class="n">v</span><span class="p">]</span>
  <span class="p">(</span><span class="n">mapv</span> <span class="p">(</span><span class="n">comp</span> <span class="p">(</span><span class="n">partial</span> <span class="n">apply</span> <span class="n">c</span><span class="o">/+</span><span class="p">)</span>
              <span class="p">(</span><span class="n">partial</span> <span class="nb">map</span> <span class="n">c</span><span class="o">/*</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">m</span><span class="p">))</span>
<span class="p">(</span><span class="n">defn</span> <span class="n">dft</span>
  <span class="s2">&quot;take a vector of real numbers and return a vector of frequency</span>
  <span class="n">space</span><span class="s2">&quot;</span>
  <span class="p">[</span><span class="n">vx</span><span class="p">]</span>
  <span class="p">(</span><span class="n">let</span> <span class="p">[</span><span class="nb">len</span> <span class="p">(</span><span class="n">count</span> <span class="n">vx</span><span class="p">)]</span>
     <span class="p">(</span><span class="n">matrix</span><span class="o">-</span><span class="n">mult</span>
      <span class="p">(</span><span class="n">partition</span> <span class="nb">len</span>
                 <span class="p">(</span><span class="k">for</span> <span class="p">[</span><span class="n">n</span> <span class="p">(</span><span class="nb">range</span> <span class="nb">len</span><span class="p">)</span>
                       <span class="n">k</span> <span class="p">(</span><span class="nb">range</span> <span class="nb">len</span><span class="p">)]</span>
                   <span class="p">;;</span> <span class="n">expresion</span> <span class="n">below</span> <span class="ow">is</span>
                   <span class="p">;;</span> <span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">))</span>
                   <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">exp</span> <span class="p">(</span><span class="n">c</span><span class="o">/*</span> <span class="n">n</span> <span class="n">k</span>
                               <span class="mi">2</span> <span class="n">Math</span><span class="o">/</span><span class="n">PI</span>
                               <span class="p">(</span><span class="o">/</span> <span class="nb">len</span><span class="p">)</span>
                               <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="nb">complex</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))))</span>
      <span class="n">vx</span><span class="p">)))</span>
<span class="p">(</span><span class="n">defn</span> <span class="n">fft</span> <span class="p">[</span><span class="n">vx</span><span class="p">]</span>
  <span class="p">(</span><span class="n">let</span> <span class="p">[</span><span class="nb">len</span> <span class="p">(</span><span class="n">count</span> <span class="n">vx</span><span class="p">)]</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="o">=</span> <span class="nb">len</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">vx</span>
      <span class="p">;;</span><span class="k">else</span>
      <span class="p">(</span><span class="n">let</span> <span class="p">[;;</span> <span class="n">take</span> <span class="n">values</span> <span class="n">of</span> <span class="n">vx</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">even</span> <span class="n">indices</span>
            <span class="n">even</span><span class="o">-</span><span class="n">indices</span> <span class="p">(</span><span class="n">keep</span><span class="o">-</span><span class="n">indexed</span> <span class="c1">#(if (even? %1) %2) vx)</span>
            <span class="p">;;</span> <span class="n">take</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">odd</span> <span class="n">indices</span>
            <span class="n">odd</span><span class="o">-</span><span class="n">indices</span> <span class="p">(</span><span class="n">keep</span><span class="o">-</span><span class="n">indexed</span> <span class="c1">#(if (odd? %1) %2) vx)</span>
            <span class="p">;;</span> <span class="n">recursion</span>
            <span class="n">even</span><span class="o">-</span><span class="n">fft</span> <span class="p">(</span><span class="n">fft</span> <span class="n">even</span><span class="o">-</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">odd</span><span class="o">-</span><span class="n">fft</span> <span class="p">(</span><span class="n">fft</span> <span class="n">odd</span><span class="o">-</span><span class="n">indices</span><span class="p">)</span>
            <span class="p">;;</span> <span class="n">make</span> <span class="n">a</span> <span class="n">sequence</span> <span class="n">of</span> <span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="n">where</span> <span class="n">N</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">length</span>
            <span class="p">;;</span> <span class="n">vx</span> <span class="ow">and</span> <span class="n">k</span> <span class="nb">range</span> <span class="kn">from</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">N</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">omegas</span><span class="o">-</span><span class="n">half</span> <span class="p">(</span><span class="nb">map</span>
                         <span class="p">(</span><span class="n">comp</span> <span class="n">c</span><span class="o">/</span><span class="n">exp</span>
                               <span class="p">(</span><span class="n">partial</span> <span class="n">c</span><span class="o">/*</span>
                                        <span class="p">(</span><span class="o">/</span> <span class="nb">len</span><span class="p">)</span>
                                        <span class="mi">2</span> <span class="n">Math</span><span class="o">/</span><span class="n">PI</span>
                                        <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="nb">complex</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
                         <span class="p">(</span><span class="nb">range</span> <span class="mi">0</span> <span class="p">(</span><span class="n">quot</span> <span class="nb">len</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="p">;;</span> <span class="n">take</span> <span class="n">the</span> <span class="n">negative</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="n">sequence</span> <span class="n">because</span>
            <span class="p">;;</span> <span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="o">=-</span><span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="n">where</span> <span class="n">k</span> <span class="n">ranges</span> <span class="kn">from</span>
            <span class="p">;;</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">N</span><span class="o">/</span><span class="mi">2</span> 
            <span class="n">omegas</span><span class="o">-</span><span class="mi">2</span><span class="n">half</span> <span class="p">(</span><span class="nb">map</span> <span class="n">c</span><span class="o">/-</span> <span class="n">omegas</span><span class="o">-</span><span class="n">half</span><span class="p">)</span>
            <span class="n">mult</span><span class="o">-</span><span class="n">add</span> <span class="p">(</span><span class="n">partial</span> <span class="nb">map</span> <span class="c1">#(c/+ %3 (c/* %1 %2)))]</span>
        <span class="p">(</span><span class="n">concat</span> <span class="p">(</span><span class="n">mult</span><span class="o">-</span><span class="n">add</span> <span class="n">omegas</span><span class="o">-</span><span class="n">half</span> <span class="n">odd</span><span class="o">-</span><span class="n">fft</span> <span class="n">even</span><span class="o">-</span><span class="n">fft</span><span class="p">)</span>
                <span class="p">(</span><span class="n">mult</span><span class="o">-</span><span class="n">add</span> <span class="n">omegas</span><span class="o">-</span><span class="mi">2</span><span class="n">half</span> <span class="n">odd</span><span class="o">-</span><span class="n">fft</span> <span class="n">even</span><span class="o">-</span><span class="n">fft</span><span class="p">))))))</span>
<span class="p">(</span><span class="n">defn</span> <span class="o">-</span><span class="n">main</span> <span class="p">[</span><span class="o">&amp;</span> <span class="n">args</span><span class="p">]</span>
    <span class="p">(</span><span class="n">let</span> <span class="p">[</span><span class="n">vx</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span>
          <span class="nb">len</span> <span class="p">(</span><span class="n">count</span> <span class="n">vx</span><span class="p">)</span>
          <span class="p">;;</span> <span class="n">calculate</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">power</span> <span class="n">of</span> <span class="mi">2</span> <span class="n">after</span> <span class="nb">len</span>
          <span class="p">;;</span> <span class="n">the</span> <span class="n">reason</span> <span class="n">behind</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">fill</span> <span class="n">them</span> <span class="k">with</span> <span class="n">zeros</span> <span class="k">for</span> <span class="n">fft</span>
          <span class="nb">next</span><span class="o">-</span><span class="nb">len</span> <span class="p">(</span><span class="o">-&gt;&gt;</span>
                    <span class="p">[</span><span class="nb">len</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="p">(</span><span class="nb">map</span> <span class="c1">#(Math/log %))</span>
                    <span class="p">(</span><span class="n">apply</span> <span class="o">/</span><span class="p">)</span>
                    <span class="n">Math</span><span class="o">/</span><span class="n">ceil</span>
                    <span class="p">(</span><span class="n">Math</span><span class="o">/</span><span class="nb">pow</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="nb">int</span><span class="p">)</span>
          <span class="p">;;</span> <span class="n">add</span> <span class="n">zeros</span> <span class="n">at</span> <span class="n">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">vx</span>
          <span class="n">complete</span><span class="o">-</span><span class="n">vx</span> <span class="p">(</span><span class="n">into</span> <span class="n">vx</span> <span class="p">(</span><span class="n">repeat</span> <span class="p">(</span><span class="o">-</span> <span class="nb">next</span><span class="o">-</span><span class="nb">len</span> <span class="nb">len</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
          <span class="n">fft</span><span class="o">-</span><span class="n">cvx</span> <span class="p">(</span><span class="n">fft</span> <span class="n">complete</span><span class="o">-</span><span class="n">vx</span><span class="p">)</span>
          <span class="n">dft</span><span class="o">-</span><span class="n">cvx</span> <span class="p">(</span><span class="n">dft</span> <span class="n">complete</span><span class="o">-</span><span class="n">vx</span><span class="p">)</span>
          <span class="n">diffv</span> <span class="p">(</span><span class="n">mapv</span> <span class="n">c</span><span class="o">/-</span> <span class="n">fft</span><span class="o">-</span><span class="n">cvx</span> <span class="n">dft</span><span class="o">-</span><span class="n">cvx</span><span class="p">)]</span>
    <span class="p">(</span><span class="n">println</span> <span class="s2">&quot;vx:&quot;</span> <span class="n">vx</span><span class="p">)</span>
    <span class="p">(</span><span class="n">println</span> <span class="s2">&quot;complete-vx:&quot;</span> <span class="n">complete</span><span class="o">-</span><span class="n">vx</span><span class="p">)</span>
    <span class="p">(</span><span class="n">println</span> <span class="s2">&quot;result from fft:&quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="n">c</span><span class="o">/</span><span class="n">stringify</span> <span class="n">fft</span><span class="o">-</span><span class="n">cvx</span><span class="p">))</span>
    <span class="p">(</span><span class="n">println</span> <span class="s2">&quot;result from dft:&quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="n">c</span><span class="o">/</span><span class="n">stringify</span> <span class="n">dft</span><span class="o">-</span><span class="n">cvx</span><span class="p">))</span>
    <span class="p">(</span><span class="n">println</span> <span class="s2">&quot;difference: &quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="n">c</span><span class="o">/</span><span class="n">stringify</span> <span class="n">diffv</span><span class="p">))))</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">written</span> <span class="n">by</span> <span class="n">Gathros</span><span class="p">,</span> <span class="n">modernized</span> <span class="n">by</span> <span class="n">Nicole</span> <span class="n">Mazzuca</span><span class="o">.</span>

<span class="c1">#include &lt;algorithm&gt;</span>
<span class="c1">#include &lt;array&gt;</span>
<span class="c1">#include &lt;complex&gt;</span>
<span class="c1">#include &lt;cstdint&gt;</span>
<span class="c1">#include &lt;vector&gt;</span>

<span class="o">//</span> <span class="n">These</span> <span class="n">headers</span> <span class="n">are</span> <span class="k">for</span> <span class="n">presentation</span> <span class="ow">not</span> <span class="k">for</span> <span class="n">the</span> <span class="n">algorithm</span><span class="o">.</span>
<span class="c1">#include &lt;iomanip&gt;</span>
<span class="c1">#include &lt;iostream&gt;</span>
<span class="c1">#include &lt;random&gt;</span>

<span class="n">using</span> <span class="n">std</span><span class="p">::</span><span class="n">begin</span><span class="p">;</span>
<span class="n">using</span> <span class="n">std</span><span class="p">::</span><span class="n">end</span><span class="p">;</span>
<span class="n">using</span> <span class="n">std</span><span class="p">::</span><span class="n">swap</span><span class="p">;</span>

<span class="n">using</span> <span class="n">std</span><span class="p">::</span><span class="n">size_t</span><span class="p">;</span>

<span class="n">using</span> <span class="nb">complex</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="nb">complex</span><span class="o">&lt;</span><span class="n">double</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">double</span> <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14159265358979323846264338327950288419716</span><span class="p">;</span>

<span class="n">template</span> <span class="o">&lt;</span><span class="n">typename</span> <span class="n">Iter</span><span class="o">&gt;</span>
<span class="n">void</span> <span class="n">dft</span><span class="p">(</span><span class="n">Iter</span> <span class="n">X</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">auto</span> <span class="n">N</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">X</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">complex</span><span class="o">&gt;</span> <span class="n">tmp</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span> <span class="o">/</span> <span class="n">N</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="p">::</span><span class="n">copy</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">begin</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="n">std</span><span class="p">::</span><span class="n">end</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="n">X</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">//</span> <span class="err">`</span><span class="n">cooley_tukey</span><span class="err">`</span> <span class="n">does</span> <span class="n">the</span> <span class="n">cooley</span><span class="o">-</span><span class="n">tukey</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">recursively</span>
<span class="n">template</span> <span class="o">&lt;</span><span class="n">typename</span> <span class="n">Iter</span><span class="o">&gt;</span>
<span class="n">void</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">Iter</span> <span class="n">first</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">split</span> <span class="n">the</span> <span class="nb">range</span><span class="p">,</span> <span class="k">with</span> <span class="n">even</span> <span class="n">indices</span> <span class="n">going</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">first</span> <span class="n">half</span><span class="p">,</span>
    <span class="o">//</span> <span class="ow">and</span> <span class="n">odd</span> <span class="n">indices</span> <span class="n">going</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">last</span> <span class="n">half</span><span class="o">.</span>
    <span class="n">auto</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">complex</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
      <span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">first</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">recurse</span> <span class="n">the</span> <span class="n">splits</span> <span class="ow">and</span> <span class="n">butterflies</span> <span class="ow">in</span> <span class="n">each</span> <span class="n">half</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">range</span>
    <span class="n">auto</span> <span class="n">split</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">split</span><span class="p">);</span>
    <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">last</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">now</span> <span class="n">combine</span> <span class="n">each</span> <span class="n">of</span> <span class="n">those</span> <span class="n">halves</span> <span class="k">with</span> <span class="n">the</span> <span class="n">butterflies</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">auto</span> <span class="n">w</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">size</span><span class="p">));</span>

      <span class="n">auto</span><span class="o">&amp;</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
      <span class="n">auto</span><span class="o">&amp;</span> <span class="n">top</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
      <span class="n">top</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">w</span> <span class="o">*</span> <span class="n">top</span><span class="p">;</span>
      <span class="n">bottom</span> <span class="o">-=</span> <span class="n">top</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">note</span><span class="p">:</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span> <span class="n">must</span> <span class="n">be</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">template</span> <span class="o">&lt;</span><span class="n">typename</span> <span class="n">Iter</span><span class="o">&gt;</span>
<span class="n">void</span> <span class="n">sort_by_bit_reverse</span><span class="p">(</span><span class="n">Iter</span> <span class="n">first</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">sorts</span> <span class="n">the</span> <span class="nb">range</span> <span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="ow">in</span> <span class="n">bit</span><span class="o">-</span><span class="nb">reversed</span> <span class="n">order</span><span class="p">,</span>
  <span class="o">//</span> <span class="n">by</span> <span class="n">the</span> <span class="n">method</span> <span class="n">suggested</span> <span class="n">by</span> <span class="n">the</span> <span class="n">FFT</span>
  <span class="n">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0xaaaaaaaa</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x55555555</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0xcccccccc</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x33333333</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0xf0f0f0f0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x0f0f0f0f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0xff00ff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x00ff00ff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">));</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">((</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">std</span><span class="p">::</span><span class="n">uint32_t</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">size</span><span class="p">)));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">swap</span><span class="p">(</span><span class="n">first</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="err">`</span><span class="n">iterative_cooley_tukey</span><span class="err">`</span> <span class="n">does</span> <span class="n">the</span> <span class="n">cooley</span><span class="o">-</span><span class="n">tukey</span> <span class="n">algorithm</span> <span class="n">iteratively</span>
<span class="n">template</span> <span class="o">&lt;</span><span class="n">typename</span> <span class="n">Iter</span><span class="o">&gt;</span>
<span class="n">void</span> <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">Iter</span> <span class="n">first</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">sort_by_bit_reverse</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">);</span>

  <span class="o">//</span> <span class="n">perform</span> <span class="n">the</span> <span class="n">butterfly</span> <span class="n">on</span> <span class="n">the</span> <span class="nb">range</span>
  <span class="n">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">stride</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">;</span> <span class="n">stride</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">auto</span> <span class="n">w</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">stride</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="n">stride</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">auto</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span>
            <span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span> <span class="o">*</span> <span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
        <span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
        <span class="n">v</span> <span class="o">*=</span> <span class="n">w</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">initalize</span> <span class="n">the</span> <span class="n">FFT</span> <span class="n">inputs</span>
  <span class="n">std</span><span class="p">::</span><span class="n">random_device</span> <span class="n">random_device</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">mt19937</span> <span class="n">rng</span><span class="p">(</span><span class="n">random_device</span><span class="p">());</span>
  <span class="n">std</span><span class="p">::</span><span class="n">uniform_real_distribution</span><span class="o">&lt;</span><span class="n">double</span><span class="o">&gt;</span> <span class="n">distribution</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>

  <span class="n">std</span><span class="p">::</span><span class="n">array</span><span class="o">&lt;</span><span class="nb">complex</span><span class="p">,</span> <span class="mi">64</span><span class="o">&gt;</span> <span class="n">initial</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">generate</span><span class="p">(</span>
      <span class="n">begin</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span> <span class="p">{</span> <span class="k">return</span> <span class="n">distribution</span><span class="p">(</span><span class="n">rng</span><span class="p">);</span> <span class="p">});</span>

  <span class="n">auto</span> <span class="n">recursive</span> <span class="o">=</span> <span class="n">initial</span><span class="p">;</span>
  <span class="n">auto</span> <span class="n">iterative</span> <span class="o">=</span> <span class="n">initial</span><span class="p">;</span>

  <span class="o">//</span> <span class="n">Preform</span> <span class="n">an</span> <span class="n">FFT</span> <span class="n">on</span> <span class="n">the</span> <span class="n">arrays</span><span class="o">.</span>
  <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">recursive</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">recursive</span><span class="p">));</span>
  <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">iterative</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">iterative</span><span class="p">));</span>

  <span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">arrays</span> <span class="n">are</span> <span class="n">approximately</span> <span class="n">equivalent</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">right</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;idx&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;rec&quot;</span>
            <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;it&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;subtracted&quot;</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">initial</span><span class="o">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">auto</span> <span class="n">rec</span> <span class="o">=</span> <span class="n">recursive</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">iterative</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="nb">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="nb">abs</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
              <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="nb">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span> <span class="o">-</span> <span class="n">std</span><span class="p">::</span><span class="nb">abs</span><span class="p">(</span><span class="n">it</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">Data.Complex</span>
<span class="kn">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="n">partition</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">Data.Map</span> <span class="p">((</span><span class="err">!</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">qualified</span> <span class="n">Data</span><span class="o">.</span><span class="n">Map</span> <span class="k">as</span> <span class="n">M</span>
<span class="kn">import</span> <span class="nn">Data.Ratio</span>

<span class="n">dft</span> <span class="p">::</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span>
<span class="n">dft</span> <span class="n">x</span> <span class="o">=</span> <span class="n">matMult</span> <span class="n">dftMat</span> <span class="n">x</span>
  <span class="n">where</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span> <span class="n">x</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">exp</span> <span class="err">$</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span> <span class="p">:</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">fromIntegral</span> <span class="n">n</span>
    <span class="n">dftMat</span> <span class="o">=</span> <span class="p">[[</span><span class="n">w</span> <span class="o">^</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="o">|</span> <span class="n">j</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">|</span> <span class="n">k</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">matMult</span> <span class="n">m</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">(</span><span class="nb">sum</span> <span class="o">.</span> <span class="n">zipWith</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">x</span><span class="p">)</span> <span class="n">m</span>

<span class="n">fft</span> <span class="p">::</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">Complex</span> <span class="n">Double</span><span class="p">]</span>
<span class="n">fft</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fft</span><span class="s1">&#39; x</span>
  <span class="n">where</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">length</span> <span class="n">x</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="n">exp</span> <span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span> <span class="p">:</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">fromIntegral</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[(</span><span class="n">k</span> <span class="o">%</span> <span class="n">n</span><span class="p">,</span> <span class="n">w0</span> <span class="o">^</span> <span class="n">k</span><span class="p">)</span> <span class="o">|</span> <span class="n">k</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">fft</span><span class="s1">&#39; [x] = [x]</span>
    <span class="n">fft</span><span class="s1">&#39; x =</span>
      <span class="n">let</span> <span class="p">(</span><span class="n">evens</span><span class="p">,</span> <span class="n">odds</span><span class="p">)</span> <span class="o">=</span> <span class="n">partition</span> <span class="p">(</span><span class="n">even</span> <span class="o">.</span> <span class="n">fst</span><span class="p">)</span> <span class="err">$</span> <span class="nb">zip</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span><span class="p">]</span> <span class="n">x</span>
          <span class="n">e</span> <span class="o">=</span> <span class="n">fft</span><span class="s1">&#39; $ map snd evens</span>
          <span class="n">o</span> <span class="o">=</span> <span class="n">fft</span><span class="s1">&#39; $ map snd odds</span>
          <span class="n">x1</span> <span class="o">=</span> <span class="n">zipWith3</span> <span class="p">(</span>\<span class="n">e</span> <span class="n">o</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="n">e</span> <span class="o">+</span> <span class="n">o</span> <span class="o">*</span> <span class="n">w</span> <span class="err">!</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span><span class="n">n</span><span class="p">))</span> <span class="n">e</span> <span class="n">o</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span><span class="p">]</span>
          <span class="n">x2</span> <span class="o">=</span> <span class="n">zipWith3</span> <span class="p">(</span>\<span class="n">e</span> <span class="n">o</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="n">e</span> <span class="o">-</span> <span class="n">o</span> <span class="o">*</span> <span class="n">w</span> <span class="err">!</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span><span class="n">n</span><span class="p">))</span> <span class="n">e</span> <span class="n">o</span> <span class="p">[</span><span class="mi">0</span> <span class="o">..</span><span class="p">]</span>
       <span class="ow">in</span> <span class="n">x1</span> <span class="o">++</span> <span class="n">x2</span>

<span class="n">main</span> <span class="o">=</span> <span class="n">do</span>
  <span class="nb">print</span> <span class="err">$</span> <span class="n">dft</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
  <span class="nb">print</span> <span class="err">$</span> <span class="n">fft</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">cmath</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log2</span>

<span class="k">def</span> <span class="nf">dft</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">N</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temp</span>

<span class="k">def</span> <span class="nf">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
	<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">X</span>
	<span class="n">even</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
	<span class="n">odd</span> <span class="o">=</span>  <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
		<span class="n">temp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">even</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">odd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
		<span class="n">temp</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">even</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">odd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">temp</span>

<span class="k">def</span> <span class="nf">bitReverse</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
	<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
		<span class="n">b</span> <span class="o">=</span>  <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span> <span class="k">if</span> <span class="n">k</span><span class="o">&gt;&gt;</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">temp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
		<span class="n">temp</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">temp</span>

<span class="k">def</span> <span class="nf">iterative_cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
	<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

	<span class="n">X</span> <span class="o">=</span> <span class="n">bitReverse</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">stride</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span>
		<span class="n">w</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">stride</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
			<span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stride</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
				<span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span><span class="o">//</span><span class="mi">2</span><span class="p">];</span>
				<span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">stride</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
				<span class="n">v</span> <span class="o">*=</span> <span class="n">w</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">X</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
	<span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="p">())</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">dft</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">([</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">)][</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">([</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">)][</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">)))</span>
</pre></div>

</div></p>
</div><div class="scratch">
<p>Some rather impressive scratch code was submitted by Jie and can be found here: https://scratch.mit.edu/projects/37759604/#editor</p>
</div><div class="asm-x64">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">.</span><span class="n">intel_syntax</span> <span class="n">noprefix</span>

<span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">rodata</span>
  <span class="n">two</span><span class="p">:</span>           <span class="o">.</span><span class="n">double</span> <span class="mf">2.0</span>
  <span class="n">one</span><span class="p">:</span>           <span class="o">.</span><span class="n">double</span> <span class="mf">1.0</span>
  <span class="n">two_pi</span><span class="p">:</span>        <span class="o">.</span><span class="n">double</span> <span class="o">-</span><span class="mf">6.28318530718</span>
  <span class="n">rand_max</span><span class="p">:</span>      <span class="o">.</span><span class="n">long</span> <span class="mi">4290772992</span>
                 <span class="o">.</span><span class="n">long</span> <span class="mi">1105199103</span>
  <span class="n">fmt</span><span class="p">:</span>           <span class="o">.</span><span class="n">string</span> <span class="s2">&quot;</span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">text</span>
  <span class="o">.</span><span class="k">global</span> <span class="n">main</span>
  <span class="o">.</span><span class="n">extern</span> <span class="n">printf</span><span class="p">,</span> <span class="n">memset</span><span class="p">,</span> <span class="n">memcpy</span><span class="p">,</span> <span class="n">srand</span><span class="p">,</span> <span class="n">rand</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">cexp</span><span class="p">,</span> <span class="n">__muldc3</span><span class="p">,</span> <span class="n">cabs</span><span class="p">,</span> <span class="n">log2</span>

<span class="c1"># rdi - array ptr</span>
<span class="c1"># rsi - array size</span>
<span class="n">dft</span><span class="p">:</span>
  <span class="n">push</span>   <span class="n">rbx</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">push</span>   <span class="n">r13</span>
  <span class="n">push</span>   <span class="n">r14</span>
  <span class="n">push</span>   <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rdi</span>                    <span class="c1"># Save parameters</span>
  <span class="n">mov</span>    <span class="n">r13</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r13</span>                    <span class="c1"># Make a double complex array</span>
  <span class="n">xor</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">r14</span>                    <span class="c1"># Set index to 0</span>
<span class="n">dft_loop_i</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">r13</span>                    <span class="c1"># Check if index is equal to array size</span>
  <span class="n">je</span>     <span class="n">dft_end_i</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>            <span class="c1"># Set tmp array to zero at r14</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">],</span> <span class="mi">0</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="mi">0</span>
  <span class="n">xor</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r15</span>                    <span class="c1"># Set second index to 0</span>
<span class="n">dft_loop_j</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r13</span>                    <span class="c1"># Check if the index is equal to array size</span>
  <span class="n">je</span>     <span class="n">dft_end_j</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">two_pi</span>                <span class="c1"># Calculate xmm1 = -2pi * i * j / N</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">imul</span>   <span class="n">rax</span><span class="p">,</span> <span class="n">r15</span>
  <span class="n">shr</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">4</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm2</span><span class="p">,</span> <span class="n">rax</span>
  <span class="n">mulsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm2</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">divsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">pxor</span>   <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Set xmm0 to 0</span>
  <span class="n">call</span>   <span class="n">cexp</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r15</span><span class="p">]</span>            <span class="c1"># Calculate X[i] * cexp(-2pi * i * j / N)</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">__muldc3</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>       <span class="c1"># Sum to tmp array</span>
  <span class="n">movsd</span>  <span class="n">xmm7</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">addsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">addsd</span>  <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">],</span> <span class="n">xmm6</span>       <span class="c1"># Save to tmp array</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm7</span>
  <span class="n">add</span>    <span class="n">r15</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">dft_loop_j</span>
<span class="n">dft_end_j</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">dft_loop_i</span>
<span class="n">dft_end_i</span><span class="p">:</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">r12</span>                    <span class="c1"># Move tmp array to array ptr</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="n">rsp</span>
  <span class="n">mov</span>    <span class="n">rdx</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">call</span>   <span class="n">memcpy</span>
  <span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r15</span>
  <span class="n">pop</span>    <span class="n">r14</span>
  <span class="n">pop</span>    <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">pop</span>    <span class="n">rbx</span>
  <span class="n">ret</span>

<span class="c1"># rdi - array ptr</span>
<span class="c1"># rsi - array size</span>
<span class="n">cooley_tukey</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">rsi</span><span class="p">,</span> <span class="mi">16</span>                     <span class="c1"># Check if size if greater then 1</span>
  <span class="n">jle</span>    <span class="n">cooley_tukey_return</span>
  <span class="n">push</span>   <span class="n">rbx</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">push</span>   <span class="n">r13</span>
  <span class="n">push</span>   <span class="n">r14</span>
  <span class="n">push</span>   <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rdi</span>                    <span class="c1"># Save parameters</span>
  <span class="n">mov</span>    <span class="n">r13</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">mov</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">rsi</span>                    <span class="c1"># Save N / 2</span>
  <span class="n">shr</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r14</span>                    <span class="c1"># Make a tmp array</span>
  <span class="n">xor</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">rbx</span><span class="p">,</span> <span class="n">r12</span>
<span class="n">cooley_tukey_spliting</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">je</span>     <span class="n">cooley_tukey_split</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r15</span><span class="p">]</span>        <span class="c1"># Moving all odd entries to the front of the array</span>
  <span class="n">movaps</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">xmm1</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="n">r15</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rbx</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">add</span>    <span class="n">rbx</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">add</span>    <span class="n">r15</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">cooley_tukey_spliting</span>
<span class="n">cooley_tukey_split</span><span class="p">:</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">rsp</span>
  <span class="n">lea</span>    <span class="n">rdi</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r13</span><span class="p">]</span>
<span class="n">cooley_tukey_mov_data</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">rbx</span><span class="p">,</span> <span class="n">rdi</span>
  <span class="n">je</span>     <span class="n">cooley_tukey_moved</span>
  <span class="n">movaps</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rbx</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">add</span>    <span class="n">rbx</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">add</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">cooley_tukey_mov_data</span>
<span class="n">cooley_tukey_moved</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">r12</span>                   <span class="c1"># Makking a recursive call</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">call</span>   <span class="n">cooley_tukey</span>
  <span class="n">lea</span>    <span class="n">rdi</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>           <span class="c1"># Makking a recursive call</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">call</span>   <span class="n">cooley_tukey</span>
  <span class="n">lea</span>    <span class="n">rbx</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>
  <span class="n">mov</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">mov</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r12</span>
<span class="n">cooley_tukey_loop</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">je</span>     <span class="n">cooley_tukey_end</span>
  <span class="n">pxor</span>   <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                 <span class="c1"># Calculate cexp(-2.0 * I * M_PI * i / N)</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">two_pi</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">sub</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm2</span><span class="p">,</span> <span class="n">rax</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm3</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">divsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">mulsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">call</span>   <span class="n">cexp</span>
  <span class="n">movq</span>   <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span><span class="p">]</span>      <span class="c1"># Calculating X[i] - cexp() * X[i + N / 2]</span>
  <span class="n">movq</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">__muldc3</span>
  <span class="n">movq</span>   <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span><span class="p">]</span>
  <span class="n">movq</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">subsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">subsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span><span class="p">],</span> <span class="n">xmm2</span>      <span class="c1"># Save value in X[i + N / 2]</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r14</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm3</span>
  <span class="n">movq</span>   <span class="n">xmm0</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span><span class="p">]</span>      <span class="c1"># Calculating X[i] -= X[i + N / 2] - X[i]</span>
  <span class="n">movq</span>   <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">subsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">subsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">subsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r15</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">add</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">add</span>    <span class="n">r15</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">cooley_tukey_loop</span>
<span class="n">cooley_tukey_end</span><span class="p">:</span>
  <span class="n">pop</span>    <span class="n">r15</span>
  <span class="n">pop</span>    <span class="n">r14</span>
  <span class="n">pop</span>    <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">pop</span>    <span class="n">rbx</span>
<span class="n">cooley_tukey_return</span><span class="p">:</span>
  <span class="n">ret</span>

<span class="c1"># rdi - array ptr</span>
<span class="c1"># rsi - array size</span>
<span class="n">bit_reverse</span><span class="p">:</span>
  <span class="n">push</span>   <span class="n">rbx</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">push</span>   <span class="n">r13</span>
  <span class="n">push</span>   <span class="n">r14</span>
  <span class="n">push</span>   <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rdi</span>                  <span class="c1"># Save parameters</span>
  <span class="n">mov</span>    <span class="n">r13</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">shr</span>    <span class="n">r13</span><span class="p">,</span> <span class="mi">4</span>
  <span class="n">xor</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">r14</span>                  <span class="c1"># Loop through all entries</span>
<span class="n">bit_reverse_entries</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">je</span>     <span class="n">bit_reverse_return</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">r13</span>              <span class="c1"># Calculating the number of bit in N</span>
  <span class="n">call</span>   <span class="n">log2</span>
  <span class="n">cvttsd2si</span> <span class="n">rcx</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="mi">1</span>                    <span class="c1"># Calculating (1 &lt;&lt; log2(N)) - 1</span>
  <span class="n">sal</span>    <span class="n">edi</span><span class="p">,</span> <span class="n">cl</span>
  <span class="n">sub</span>    <span class="n">edi</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">sub</span>    <span class="n">ecx</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">mov</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r14</span>
<span class="n">bit_reverse_loop</span><span class="p">:</span>
  <span class="n">sar</span>    <span class="n">r15</span>                       <span class="c1"># Check if r15 is 0</span>
  <span class="n">je</span>     <span class="n">bit_reverse_reversed</span>
  <span class="n">sal</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">1</span>                    <span class="c1"># Calculating (rax &lt;&lt; 1) | (r15 &amp; 1)</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="n">r15</span>
  <span class="ow">and</span>    <span class="n">rsi</span><span class="p">,</span> <span class="mi">1</span>
  <span class="ow">or</span>     <span class="n">rax</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">sub</span>    <span class="n">ecx</span><span class="p">,</span> <span class="mi">1</span>                    <span class="c1"># Decrement bit count</span>
  <span class="n">jmp</span>    <span class="n">bit_reverse_loop</span>
<span class="n">bit_reverse_reversed</span><span class="p">:</span>
  <span class="n">sal</span>    <span class="n">eax</span><span class="p">,</span> <span class="n">cl</span>                   <span class="c1"># Calculate (rax &lt;&lt; rcx) &amp; (1 &lt;&lt; bit count)</span>
  <span class="ow">and</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">rdi</span>
  <span class="nb">cmp</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">r14</span>                  <span class="c1"># Check if rax is greater then r14</span>
  <span class="n">jle</span>    <span class="n">bit_reverse_no_swap</span>       <span class="c1"># If so then swap entries</span>
  <span class="n">shl</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">4</span>                    <span class="c1"># Times index by 16 to get bytes to entry</span>
  <span class="n">shl</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">4</span>
  <span class="n">movaps</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">rax</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">xmm1</span><span class="p">,</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r14</span><span class="p">]</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">rax</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">movaps</span> <span class="n">XMMWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r14</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">shr</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">bit_reverse_no_swap</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">jmp</span>    <span class="n">bit_reverse_entries</span>
<span class="n">bit_reverse_return</span><span class="p">:</span>
  <span class="n">pop</span>    <span class="n">r15</span>
  <span class="n">pop</span>    <span class="n">r14</span>
  <span class="n">pop</span>    <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">pop</span>    <span class="n">rbx</span>
  <span class="n">ret</span>

<span class="c1"># rdi - array ptr</span>
<span class="c1"># rsi - array size</span>
<span class="n">iterative_cooley_tukey</span><span class="p">:</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">push</span>   <span class="n">r13</span>
  <span class="n">push</span>   <span class="n">r14</span>
  <span class="n">push</span>   <span class="n">r15</span>
  <span class="n">push</span>   <span class="n">rbx</span>
  <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="mi">48</span>
  <span class="n">mov</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rdi</span>
  <span class="n">mov</span>    <span class="n">r13</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">call</span>   <span class="n">bit_reverse</span>              <span class="c1"># Bit reversing array</span>
  <span class="n">sar</span>    <span class="n">r13</span><span class="p">,</span> <span class="mi">4</span>                   <span class="c1"># Calculate log2(N)</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">r13</span>
  <span class="n">call</span>   <span class="n">log2</span>
  <span class="n">cvttsd2si</span> <span class="n">rax</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="p">],</span> <span class="n">rax</span>     <span class="c1"># Save it to the stack</span>
  <span class="n">mov</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">iter_ct_loop_i</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">rax</span>                 <span class="c1"># Check if r14 is greater then log2(N)</span>
  <span class="n">jg</span>     <span class="n">iter_ct_end_i</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">two</span>                <span class="c1"># Calculate stride = 2^(r14)</span>
  <span class="n">cvtsi2sdq</span> <span class="n">xmm1</span><span class="p">,</span> <span class="n">r14</span>
  <span class="n">call</span>   <span class="nb">pow</span>
  <span class="n">cvttsd2si</span> <span class="n">r10</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">40</span><span class="p">],</span> <span class="n">r10</span><span class="c1"># move stride to stack</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">two_pi</span>             <span class="c1"># Calculating cexp(-2pi * I / stride)</span>
  <span class="n">divsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">pxor</span>   <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">call</span>   <span class="n">cexp</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm0</span>  <span class="c1"># Save it to stack</span>
  <span class="n">movq</span>   <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">16</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">xor</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r15</span>
<span class="n">iter_ct_loop_j</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">r13</span>                 <span class="c1"># Check if r15 is less then array size</span>
  <span class="n">je</span>     <span class="n">iter_ct_end_j</span>
  <span class="n">movsd</span>  <span class="n">xmm4</span><span class="p">,</span> <span class="n">one</span>                <span class="c1"># Save 1 + 0i to stack</span>
  <span class="n">pxor</span>   <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm5</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">24</span><span class="p">],</span> <span class="n">xmm4</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">32</span><span class="p">],</span> <span class="n">xmm5</span>
  <span class="n">xor</span>    <span class="n">rbx</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">40</span><span class="p">]</span><span class="c1"># Calculate stride / 2</span>
  <span class="n">sar</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">iter_ct_loop_k</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">rbx</span><span class="p">,</span> <span class="n">rax</span>                 <span class="c1"># Check if rbx is less then stride / 2</span>
  <span class="n">je</span>     <span class="n">iter_ct_end_k</span>
  <span class="n">mov</span>    <span class="n">r8</span><span class="p">,</span> <span class="n">r15</span>                  <span class="c1"># Saving pointers to X[k + j + stride / 2] and X[k + j]</span>
  <span class="n">add</span>    <span class="n">r8</span><span class="p">,</span> <span class="n">rbx</span>
  <span class="n">sal</span>    <span class="n">r8</span><span class="p">,</span> <span class="mi">4</span>
  <span class="n">mov</span>    <span class="n">r9</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">40</span><span class="p">]</span>
  <span class="n">sal</span>    <span class="n">r9</span><span class="p">,</span> <span class="mi">3</span>
  <span class="n">add</span>    <span class="n">r9</span><span class="p">,</span> <span class="n">r8</span>
  <span class="n">lea</span>    <span class="n">r9</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r9</span><span class="p">]</span>
  <span class="n">lea</span>    <span class="n">r8</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="n">r8</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r9</span><span class="p">]</span>     <span class="c1"># Calculate X[k + j] - v * X[k + j + stride / 2]</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r9</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">32</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">__muldc3</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r8</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r8</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">subsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">subsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r9</span><span class="p">],</span> <span class="n">xmm2</span>     <span class="c1"># Saving answer</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r9</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm3</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r8</span><span class="p">]</span>     <span class="c1"># Calculating X[k + j] - (X[k + j + stride / 2] - X[k + j])</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r8</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">subsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">xmm0</span>
  <span class="n">subsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">subsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r8</span><span class="p">],</span> <span class="n">xmm0</span>     <span class="c1"># Saving answer</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r8</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span> <span class="c1"># Calculating v * w</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">32</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">__muldc3</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">24</span><span class="p">],</span> <span class="n">xmm0</span> <span class="c1"># Saving answer</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">32</span><span class="p">],</span> <span class="n">xmm1</span>
  <span class="n">add</span>    <span class="n">rbx</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">40</span><span class="p">]</span>
  <span class="n">sar</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">jmp</span>    <span class="n">iter_ct_loop_k</span>
<span class="n">iter_ct_end_k</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">r15</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">40</span><span class="p">]</span>
  <span class="n">jmp</span>    <span class="n">iter_ct_loop_j</span>
<span class="n">iter_ct_end_j</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">r14</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="p">]</span>
  <span class="n">jmp</span>    <span class="n">iter_ct_loop_i</span>
<span class="n">iter_ct_end_i</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span> <span class="mi">48</span>
  <span class="n">pop</span>    <span class="n">rbx</span>
  <span class="n">pop</span>    <span class="n">r15</span>
  <span class="n">pop</span>    <span class="n">r14</span>
  <span class="n">pop</span>    <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">ret</span>

<span class="c1"># rdi - array a ptr</span>
<span class="c1"># rsi - array b ptr</span>
<span class="c1"># rdx - array size</span>
<span class="n">approx</span><span class="p">:</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">push</span>   <span class="n">r13</span>
  <span class="n">push</span>   <span class="n">r14</span>
  <span class="n">push</span>   <span class="n">r15</span>
  <span class="n">mov</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rdi</span>
  <span class="n">mov</span>    <span class="n">r13</span><span class="p">,</span> <span class="n">rsi</span>
  <span class="n">mov</span>    <span class="n">r14</span><span class="p">,</span> <span class="n">rdx</span>
  <span class="n">lea</span>    <span class="n">r15</span><span class="p">,</span> <span class="p">[</span><span class="n">rdi</span> <span class="o">+</span> <span class="n">rdx</span><span class="p">]</span>
  <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="mi">8</span>
<span class="n">approx_loop</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">r15</span>
  <span class="n">je</span>     <span class="n">approx_return</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span><span class="p">[</span><span class="n">r13</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span><span class="p">[</span><span class="n">r13</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">cabs</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span><span class="p">[</span><span class="n">r12</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span><span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
  <span class="n">call</span>   <span class="n">cabs</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="p">]</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">OFFSET</span> <span class="n">fmt</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">call</span>   <span class="n">printf</span>
  <span class="n">add</span>    <span class="n">r12</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">add</span>    <span class="n">r13</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">jmp</span>    <span class="n">approx_loop</span>
<span class="n">approx_return</span><span class="p">:</span>
  <span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span> <span class="mi">8</span>
  <span class="n">pop</span>    <span class="n">r15</span>
  <span class="n">pop</span>    <span class="n">r14</span>
  <span class="n">pop</span>    <span class="n">r13</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">ret</span>

<span class="n">main</span><span class="p">:</span>
  <span class="n">push</span>   <span class="n">r12</span>
  <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="mi">2048</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="mi">0</span>
  <span class="n">call</span>   <span class="n">time</span>
  <span class="n">mov</span>    <span class="n">edi</span><span class="p">,</span> <span class="n">eax</span>
  <span class="n">call</span>   <span class="n">srand</span>
  <span class="n">lea</span>    <span class="n">r12</span><span class="p">,</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">]</span>
<span class="n">loop</span><span class="p">:</span>
  <span class="nb">cmp</span>    <span class="n">r12</span><span class="p">,</span> <span class="n">rsp</span>
  <span class="n">je</span>     <span class="n">end_loop</span>
  <span class="n">sub</span>    <span class="n">r12</span><span class="p">,</span> <span class="mi">16</span>
  <span class="n">call</span>   <span class="n">rand</span>
  <span class="n">cvtsi2sd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">rax</span>
  <span class="n">divsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">rand_max</span>
  <span class="n">lea</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">]</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r12</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">movsd</span>  <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="p">],</span> <span class="n">xmm0</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">r12</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="mi">0</span>
  <span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="mi">0</span>
  <span class="n">jmp</span>    <span class="n">loop</span>
<span class="n">end_loop</span><span class="p">:</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">rsp</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="mi">1024</span>
  <span class="n">call</span>   <span class="n">iterative_cooley_tukey</span>
  <span class="n">lea</span>    <span class="n">rdi</span><span class="p">,</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">]</span>
  <span class="n">mov</span>    <span class="n">rsi</span><span class="p">,</span> <span class="mi">1024</span>
  <span class="n">call</span>   <span class="n">cooley_tukey</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">rsp</span>
  <span class="n">lea</span>    <span class="n">rsi</span><span class="p">,</span> <span class="p">[</span><span class="n">rsp</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">]</span>
  <span class="n">mov</span>    <span class="n">rdx</span><span class="p">,</span> <span class="mi">1024</span>
  <span class="n">call</span>   <span class="n">approx</span>
  <span class="n">xor</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">rax</span>
  <span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span> <span class="mi">2048</span>
  <span class="n">pop</span>    <span class="n">r12</span>
  <span class="n">ret</span>
</pre></div>

</div></p>
</div><div class="js">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">Complex</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&quot;complex.js&quot;</span><span class="p">);</span>

<span class="n">function</span> <span class="n">dft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>

  <span class="o">//</span> <span class="n">Initialize</span> <span class="n">an</span> <span class="n">array</span> <span class="k">with</span> <span class="n">N</span> <span class="n">elements</span><span class="p">,</span> <span class="n">filled</span> <span class="k">with</span> <span class="mi">0</span><span class="n">s</span>
  <span class="k">return</span> <span class="n">Array</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="o">.</span><span class="n">map</span><span class="p">((</span><span class="n">temp</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="o">//</span> <span class="n">Reduce</span> <span class="n">x</span> <span class="n">into</span> <span class="n">the</span> <span class="nb">sum</span> <span class="n">of</span> <span class="n">x_k</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()));</span>
      <span class="p">},</span> <span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="o">//</span> <span class="n">Start</span> <span class="n">accumulating</span> <span class="kn">from</span> <span class="mi">0</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">half</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="o">//</span> <span class="n">Extract</span> <span class="n">even</span> <span class="ow">and</span> <span class="n">odd</span> <span class="n">indexed</span> <span class="n">elements</span> <span class="k">with</span> <span class="n">remainder</span> <span class="n">mod</span> <span class="mi">2</span>
  <span class="n">const</span> <span class="n">evens</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="err">!</span><span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)));</span>
  <span class="n">const</span> <span class="n">odds</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">));</span>

  <span class="o">//</span> <span class="n">Fill</span> <span class="n">an</span> <span class="n">array</span> <span class="k">with</span> <span class="n">null</span> <span class="n">values</span>
  <span class="n">let</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">null</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">half</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">odds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">());</span>

    <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">evens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
    <span class="n">temp</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">half</span><span class="p">]</span> <span class="o">=</span> <span class="n">evens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">bit_reverse_idxs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">twice</span> <span class="o">=</span> <span class="n">bit_reverse_idxs</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">twice</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">twice</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">bit_reverse</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">indexes</span> <span class="o">=</span> <span class="n">bit_reverse_idxs</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">N</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">map</span><span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="p">[</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">Assumes</span> <span class="n">log_2</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">integer</span>
<span class="n">function</span> <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">bit_reverse</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">Math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">N</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">half</span> <span class="o">=</span> <span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">w</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span><span class="p">)</span> <span class="o">/</span> <span class="n">stride</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="n">stride</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">half</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">perform</span> <span class="n">butterfly</span> <span class="n">multiplication</span>
        <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">half</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">half</span><span class="p">]));</span>
        <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">half</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">j</span><span class="p">]));</span>
        <span class="o">//</span> <span class="n">accumulate</span> <span class="n">v</span> <span class="k">as</span> <span class="n">powers</span> <span class="n">of</span> <span class="n">w</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">two</span> <span class="n">arrays</span> <span class="n">of</span> <span class="nb">complex</span> <span class="n">numbers</span> <span class="n">are</span> <span class="n">approximately</span> <span class="n">equal</span>
<span class="n">function</span> <span class="n">approx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">diff</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">X</span> <span class="o">=</span> <span class="n">Array</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">new</span> <span class="n">Complex</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">0</span><span class="p">));</span>
<span class="n">const</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
<span class="n">const</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">iterative_cooley_tukey</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
<span class="n">const</span> <span class="n">T</span> <span class="o">=</span> <span class="n">dft</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">calculations</span> <span class="n">are</span> <span class="n">correct</span> <span class="n">within</span> <span class="n">a</span> <span class="n">small</span> <span class="n">tolerance</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Cooley tukey approximation is accurate: &quot;</span><span class="p">,</span> <span class="n">approx</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">T</span><span class="p">));</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Iterative cooley tukey approximation is accurate: &quot;</span><span class="p">,</span> <span class="n">approx</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">T</span><span class="p">));</span>
</pre></div>

</div></p>
</div>
</div>

<script>
MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
</script>

<h2>License</h2>
<h5>Code Examples</h5>
<p>The code examples are licensed under the MIT license (found in <a href="https://github.com/algorithm-archivists/algorithm-archive/blob/master/LICENSE.md">LICENSE.md</a>).</p>
<h5>Text</h5>
<p>The text of this chapter was written by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><p><img  class="center" src="../cc/CC-BY-SA_icon.svg" /></p></a></p>
<h5>Images/Graphics</h5>
<ul>
<li>The image "<a href="res/FT_example.png">FTexample</a>" was created by <a href="https://github.com/leios">James Schloss</a> and is licenced under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image "<a href="res/radix-2screen_positive.jpg">radix2positive</a>" was created by <a href="https://github.com/leios">James Schloss</a> and is licenced under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image "<a href="res/radix-2screen.jpg">radix2</a>" was created by <a href="https://github.com/leios">James Schloss</a> and is licenced under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image "<a href="res/radix-8screen.jpg">radix8</a>" was created by <a href="https://github.com/leios">James Schloss</a> and is licenced under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>The image "<a href="https://en.wikipedia.org/wiki/Butterfly_diagram#/media/File:DIT-FFT-butterfly.png">DIT-FFT-butterfly</a>" was created by Virens and is licenced under the <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.</li>
</ul>
<h5>Pull Requests</h5>
<p>After initial licensing (<a href="https://github.com/algorithm-archivists/algorithm-archive/pull/560">#560</a>), the following pull requests have modified the text or graphics of this chapter:</p>
<ul>
<li>none</li>
</ul>
        <hr>
    </div>
</body>
</html>