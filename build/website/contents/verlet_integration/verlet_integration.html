<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel=stylesheet href="/pygments.css" type="text/css">
    <link rel=stylesheet href="/styles/style.css" type="text/css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <title id="ttl"></title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [['$','$']]}
        });
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        var bjs = {"gitbook": "3.x.x", "plugins": ["fontsettings", "mathjax@https://github.com/algorithm-archivists/plugin-mathjax", "bibtex-cite", "wordcount", "api-language-selector@https://github.com/algorithm-archivists/gitbook-plugin-api-language-selector.git", "include-codeblock", "ga", "bulk-redirect", "prism", "-highlight"], "lunr": {"maxIndexSize": 1000000000}, "pluginsConfig": {"mathjax": {"version": "2.6.1"}, "include-codeblock": {"fixlang": true, "unindent": true}, "bulk-redirect": {"basepath": "/", "redirectsFile": "redirects.json"}, "ga": {"token": "UA-118252470-1"}, "prism": {"lang": {"asm-x64": "nasm"}, "ignore": ["emojicode", "text"], "css": ["prismjs/themes/prism-tomorrow.css"]}, "api-language-selector": {"languages": [{"lang": "jl", "name": "Julia", "default": true}, {"lang": "bash", "name": "Bash"}, {"lang": "cs", "name": "C#"}, {"lang": "cpp", "name": "C++"}, {"lang": "c", "name": "C"}, {"lang": "c8", "name": "chip-8"}, {"lang": "py", "name": "Python"}, {"lang": "js", "name": "JavaScript"}, {"lang": "scratch", "name": "Scratch"}, {"lang": "hs", "name": "Haskell"}, {"lang": "rs", "name": "Rust"}, {"lang": "ml", "name": "OCaml"}, {"lang": "java", "name": "Java"}, {"lang": "clj", "name": "Clojure"}, {"lang": "elm", "name": "Elm"}, {"lang": "LabVIEW", "name": "LabVIEW"}, {"lang": "d", "name": "D"}, {"lang": "go", "name": "Go"}, {"lang": "swift", "name": "Swift"}, {"lang": "racket", "name": "Racket"}, {"lang": "m", "name": "Matlab"}, {"lang": "r", "name": "R"}, {"lang": "ti83b", "name": "TI-83 Basic"}, {"lang": "lua", "name": "Lua"}, {"lang": "crystal", "name": "Crystal"}, {"lang": "php", "name": "PHP"}, {"lang": "lisp", "name": "Common Lisp"}, {"lang": "nim", "name": "Nim"}, {"lang": "asm-x64", "name": "X86-64 Assembly"}, {"lang": "f90", "name": "Fortran90"}, {"lang": "factor", "name": "Factor"}, {"lang": "ws", "name": "Whitespace"}, {"lang": "scala", "name": "Scala"}, {"lang": "emojic", "name": "Emojicode"}, {"lang": "lolcode", "name": "LOLCODE"}, {"lang": "piet", "name": "Piet"}, {"lang": "ss", "name": "Scheme"}, {"lang": "ps1", "name": "PowerShell"}, {"lang": "v", "name": "Vlang"}, {"lang": "coffee", "name": "CoffeeScript"}, {"lang": "kotlin", "name": "Kotlin"}]}}};		    
        var lang = "jl";
        var langs = {};
        var langNames = bjs.pluginsConfig["api-language-selector"].languages;
        var translations = {
            "python": "Python",
            "bf": "Brainfuck",
            "st": "Smalltalk",
            "ruby": "Ruby",
            "kotlin": "Kotlin",
            "bash": "Bash",
            "haskell": "Haskell",
            "matlab": "Matlab",
            "javascript": "JavaScript"
        };
	
        function initLangs () {
            var samples = document.getElementsByClassName("code-section");
            for (var a = 0; a < samples.length; a++) {
                var sample = samples[a];
                var children = sample.children;
                for (var b = 0; b < children.length; b++)  {
                    var element = children[b];
                    langs[element.className] = true;
                };
            };
	    langs = Object.keys(langs);
	    if (langs.length == 1) {
		lang = langs[0];
	    }
            langNames.forEach(function(element) { translations[element.lang] = element.name });
        }
        function reload() {
            var samples = document.getElementsByClassName("code-section");
            for (var a = 0; a < samples.length; a++) {
                var sample = samples[a];
                var children = sample.children;
                for (var b = 0; b < children.length; b++)  {
                    var element = children[b];
                    if (element.className == lang) {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                };
            };
        };
        window.onload = () => {
            initLangs();
            reload();
            document.getElementById("name").innerText = pages[index];
            document.getElementById("ttl").innerText = pages[index];
            initLs();
        };
        var index = 29;
        var pages = [];
	var lsed = false;
				
        function flipLs () {
            var ls = document.getElementById("ls");
            var ls2 = document.getElementById("ls2");
            if (lsed) {
                ls.style.display = 'none';
                ls2.style.display = 'none';
            } else {
                ls.style.display = 'block';
                ls2.style.display = 'block';
            }
            lsed = !lsed
        }

	var funcs = {};
        function initLs () {
            if (langs.length === 0) {
                document.getElementById("flipper").remove();
            } else {
                var h1 = 0;
                var h2 = 0;
                for (var i = 0; i < langs.length; i++) {
                    let language = langs[i];
		    console.log(language);
		    var elem = document.createElement("p");
                    funcs[language] = {}
                    funcs[language] = () => {
                        lang = language;
                        reload();
                    };
                    elem.innerHTML = "<a onclick='funcs[\"" + language + "\"]()' href='#' class=ls-link>" + translations[language] + "</a>";
                    if (i % 2) {
                        h2 += 1
                        document.getElementById("ls2").appendChild(elem);
                    } else {
                        h1 += 1
                        document.getElementById("ls").appendChild(elem);
                    }
                }
                if (h1 > h2) {
                    var elem = document.createElement("p");
                    elem.innerHTML = "&nbsp;";
                    document.getElementById("ls2").appendChild(elem);
                } else if (h2 > h1) {
                    var elem = document.createElement("p");
                    elem.innerHTML = "&nbsp;";
                    document.getElementById("ls").appendChild(elem);
                }
                document.getElementById("ls").style.display = "none";
                document.getElementById("ls2").style.display = "none";
            }
        }
        function toggleSidenav () {
            $("#sidebar").toggleClass("hide");
            $("#content").toggleClass("on-sidebar");
            $("#navbar").toggleClass("no-sidebar");
        }
    </script>
    <div class="sidebar-wrapper" id="sidebar">
        
            <p>
                
                <a name="Algorithm Archive"></a>
                <a href="/index.html#Algorithm Archive">Algorithm Archive</a>
                <script>pages[0] = "Algorithm Archive"</script>
            </p>
        
            <p>
                
                <a name="Introduction"></a>
                <a href="/contents/introduction/introduction.html#Introduction">Introduction</a>
                <script>pages[1] = "Introduction"</script>
            </p>
        
            <p>
                
                <a name="How To Contribute"></a>
                <a href="/contents/how_to_contribute/how_to_contribute.html#How To Contribute">How To Contribute</a>
                <script>pages[2] = "How To Contribute"</script>
            </p>
        
            <p>
                
                <a name="Plotting"></a>
                <a href="/contents/plotting/plotting.html#Plotting">Plotting</a>
                <script>pages[3] = "Plotting"</script>
            </p>
        
            <p>
                
                <a name="Data Structures"></a>
                <a href="/contents/data_structures/data_structures.html#Data Structures">Data Structures</a>
                <script>pages[4] = "Data Structures"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Stacks and Queues"></a>
                <a href="/contents/stacks_and_queues/stacks_and_queues.html#Stacks and Queues">Stacks and Queues</a>
                <script>pages[5] = "Stacks and Queues"</script>
            </p>
        
            <p>
                
                <a name="Mathematical Background"></a>
                <a href="/contents/mathematical_background/mathematical_background.html#Mathematical Background">Mathematical Background</a>
                <script>pages[6] = "Mathematical Background"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Complexity Notation"></a>
                <a href="/contents/notation/notation.html#Complexity Notation">Complexity Notation</a>
                <script>pages[7] = "Complexity Notation"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bit Logic"></a>
                <a href="/contents/bitlogic/bitlogic.html#Bit Logic">Bit Logic</a>
                <script>pages[8] = "Bit Logic"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Taylor Series"></a>
                <a href="/contents/taylor_series_expansion/taylor_series_expansion.html#Taylor Series">Taylor Series</a>
                <script>pages[9] = "Taylor Series"</script>
            </p>
        
            <p>
                
                <a name="Sorting and Searching"></a>
                <a href="/contents/sorting_and_searching/sorting_and_searching.html#Sorting and Searching">Sorting and Searching</a>
                <script>pages[10] = "Sorting and Searching"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bubble Sort"></a>
                <a href="/contents/bubble_sort/bubble_sort.html#Bubble Sort">Bubble Sort</a>
                <script>pages[11] = "Bubble Sort"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Bogo Sort"></a>
                <a href="/contents/bogo_sort/bogo_sort.html#Bogo Sort">Bogo Sort</a>
                <script>pages[12] = "Bogo Sort"</script>
            </p>
        
            <p>
                
                <a name="Tree Traversal"></a>
                <a href="/contents/tree_traversal/tree_traversal.html#Tree Traversal">Tree Traversal</a>
                <script>pages[13] = "Tree Traversal"</script>
            </p>
        
            <p>
                
                <a name="Euclidean Algorithm"></a>
                <a href="/contents/euclidean_algorithm/euclidean_algorithm.html#Euclidean Algorithm">Euclidean Algorithm</a>
                <script>pages[14] = "Euclidean Algorithm"</script>
            </p>
        
            <p>
                
                <a name="Monte Carlo"></a>
                <a href="/contents/monte_carlo_integration/monte_carlo_integration.html#Monte Carlo">Monte Carlo</a>
                <script>pages[15] = "Monte Carlo"</script>
            </p>
        
            <p>
                
                <a name="Matrix Methods"></a>
                <a href="/contents/matrix_methods/matrix_methods.html#Matrix Methods">Matrix Methods</a>
                <script>pages[16] = "Matrix Methods"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Gaussian Elimination"></a>
                <a href="/contents/gaussian_elimination/gaussian_elimination.html#Gaussian Elimination">Gaussian Elimination</a>
                <script>pages[17] = "Gaussian Elimination"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Thomas Algorithm"></a>
                <a href="/contents/thomas_algorithm/thomas_algorithm.html#Thomas Algorithm">Thomas Algorithm</a>
                <script>pages[18] = "Thomas Algorithm"</script>
            </p>
        
            <p>
                
                <a name="Computational Geometry"></a>
                <a href="/contents/computational_geometry/computational_geometry.html#Computational Geometry">Computational Geometry</a>
                <script>pages[19] = "Computational Geometry"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Gift Wrapping"></a>
                <a href="/contents/gift_wrapping/gift_wrapping.html#Gift Wrapping">Gift Wrapping</a>
                <script>pages[20] = "Gift Wrapping"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Jarvis March"></a>
                <a href="/contents/jarvis_march/jarvis_march.html#Jarvis March">Jarvis March</a>
                <script>pages[21] = "Jarvis March"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Graham Scan"></a>
                <a href="/contents/graham_scan/graham_scan.html#Graham Scan">Graham Scan</a>
                <script>pages[22] = "Graham Scan"</script>
            </p>
        
            <p>
                
                <a name="FFT"></a>
                <a href="/contents/cooley_tukey/cooley_tukey.html#FFT">FFT</a>
                <script>pages[23] = "FFT"</script>
            </p>
        
            <p>
                
                <a name="Decision Problems"></a>
                <a href="/contents/decision_problems/decision_problems.html#Decision Problems">Decision Problems</a>
                <script>pages[24] = "Decision Problems"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Stable Marriage Problem"></a>
                <a href="/contents/stable_marriage_problem/stable_marriage_problem.html#Stable Marriage Problem">Stable Marriage Problem</a>
                <script>pages[25] = "Stable Marriage Problem"</script>
            </p>
        
            <p>
                
                <a name="Differential Equation Solvers"></a>
                <a href="/contents/differential_equations/differential_equations.html#Differential Equation Solvers">Differential Equation Solvers</a>
                <script>pages[26] = "Differential Equation Solvers"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Forward Euler Method"></a>
                <a href="/contents/forward_euler_method/forward_euler_method.html#Forward Euler Method">Forward Euler Method</a>
                <script>pages[27] = "Forward Euler Method"</script>
            </p>
        
            <p>
                
                <a name="Physics Solvers"></a>
                <a href="/contents/physics_solvers/physics_solvers.html#Physics Solvers">Physics Solvers</a>
                <script>pages[28] = "Physics Solvers"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Verlet Integration"></a>
                <a href="/contents/verlet_integration/verlet_integration.html#Verlet Integration">Verlet Integration</a>
                <script>pages[29] = "Verlet Integration"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Quantum Systems"></a>
                <a href="/contents/quantum_systems/quantum_systems.html#Quantum Systems">Quantum Systems</a>
                <script>pages[30] = "Quantum Systems"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                    &nbsp;
                
                <a name="Split-Operator Method"></a>
                <a href="/contents/split-operator_method/split-operator_method.html#Split-Operator Method">Split-Operator Method</a>
                <script>pages[31] = "Split-Operator Method"</script>
            </p>
        
            <p>
                
                <a name="Data Compression"></a>
                <a href="/contents/data_compression/data_compression.html#Data Compression">Data Compression</a>
                <script>pages[32] = "Data Compression"</script>
            </p>
        
            <p>
                
                    &nbsp;
                
                <a name="Huffman Encoding"></a>
                <a href="/contents/huffman_encoding/huffman_encoding.html#Huffman Encoding">Huffman Encoding</a>
                <script>pages[33] = "Huffman Encoding"</script>
            </p>
        
            <p>
                
                <a name="Quantum Information"></a>
                <a href="/contents/quantum_information/quantum_information.html#Quantum Information">Quantum Information</a>
                <script>pages[34] = "Quantum Information"</script>
            </p>
        
        <hr>
    </div>
    <nav class="navbarrio" id=navbar>
        <ul class="navbarro">
            <li>
                <span onclick="toggleSidenav()">
                    <i class="fas fa-align-left"></i>
                </button>
            </li>
            <li>
                <span onclick="flipLs()" id=flipper>
                    <i class="fas fa-code"></i>
                    <div class=ls id=ls></div>
                    <div class=ls2 id=ls2></div>
                </span>
            </li>
            <li>
                <span id=name></span>
            </li>
        </ul>
    </nav>
    <div class="container-fluid on-sidebar" id="content">
        <h1>Verlet Integration</h1>
<p>Verlet integration is essentially a solution to the kinematic equation for the motion of any object,</p>
<p><script type='math/tex'>
x = x_0 + v_0t + \frac{1}{2}at^2 + \frac{1}{6}bt^3 + \cdots
</script></p>
<p>where <script type='math/tex'>x</script> is the position, <script type='math/tex'>v</script> is the velocity, <script type='math/tex'>a</script> is the acceleration, <script type='math/tex'>b</script> is the often forgotten jerk term, and <script type='math/tex'>t</script> is time. This equation is a central equation to almost every Newtonian physics solver and brings up a class of algorithms known as <em>force integrators</em>. One of the first force integrators to work with is <em>Verlet Integration</em>.</p>
<p>So, let's say we want to solve for the next timestep in <script type='math/tex'>x</script>. To a close approximation (actually performing a Taylor Series Expansion about <script type='math/tex'>x(t\pm \Delta t)</script>), that might look like this:</p>
<p><script type='math/tex'>
x(t+\Delta t) = x(t) + v(t)\Delta t + \frac{1}{2}a(t)\Delta t^2 + \frac{1}{6}b(t) \Delta t^3 + \mathcal{O}(\Delta t^4)
</script></p>
<p>This means that if we need to find the next <script type='math/tex'>x</script>, we need the current <script type='math/tex'>x</script>, <script type='math/tex'>v</script>, <script type='math/tex'>a</script>, etc. However, because few people calculate the jerk term, our error is typically <script type='math/tex'>\mathcal{O}(\Delta t^3)</script>. That said, we can calculate <script type='math/tex'>x</script> with less knowledge and higher accuracy if we play a trick! Let's say we want to calculate <script type='math/tex'>x</script> of the <em>previous</em> timestep. Again, to a close approximation, that might look like this:</p>
<p><script type='math/tex'>
x(t-\Delta t) = x(t) - v(t)\Delta t + \frac{1}{2}a(t)\Delta t^2 - \frac{1}{6}b(t) \Delta t^3 + \mathcal{O}(\Delta t^4)
</script></p>
<p>Now, we have two equations to solve for two different timesteps in x, one of which we already have. If we add the two equations together and solve for <script type='math/tex'>x(t+\Delta t)</script>, we find that</p>
<p><script type='math/tex'>
x(t+ \Delta t) = 2x(t) - x(t-\Delta t) + a(t)\Delta t^2 + \mathcal{O}(\Delta t^4)
</script></p>
<p>So, this means we can find our next <script type='math/tex'>x</script> simply by knowing our current <script type='math/tex'>x</script>, the <script type='math/tex'>x</script> before that, and the acceleration! No velocity necessary! In addition, this drops the error to <script type='math/tex'>\mathcal{O}(\Delta t^4)</script>, which is great!
Here is what it looks like in code:</p>
<div class=code-section>
<div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">double</span> <span class="n">verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">double</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">double</span> <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">next_pos</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">verlet</span><span class="p">(</span><span class="n">double</span> <span class="o">*</span><span class="n">time</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="o">*</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="java">
<p><div class="codehilite">
<div class="highlight"><pre><span></span>    <span class="n">static</span> <span class="n">double</span> <span class="n">verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

      <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">we</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">temp</span> <span class="n">variable</span> <span class="k">for</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">position</span>
      <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">;</span>
      <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
      <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">next_pos</span>

    <span class="k">return</span> <span class="n">time</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">Method</span> <span class="o">=</span> <span class="n">Model</span> <span class="o">-&gt;</span> <span class="n">Time</span> <span class="o">-&gt;</span> <span class="n">Particle</span> <span class="o">-&gt;</span> <span class="n">Particle</span> <span class="o">-&gt;</span> <span class="n">Particle</span>

<span class="n">verlet</span> <span class="p">::</span> <span class="n">Method</span>
<span class="n">verlet</span> <span class="n">acc</span> <span class="n">dt</span> <span class="p">(</span><span class="n">xOld</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">a</span><span class="s1">&#39;, t + dt)</span>
  <span class="n">where</span>
    <span class="n">x</span><span class="s1">&#39; = 2 * x - xOld + a * dt ^ 2</span>
    <span class="n">v</span><span class="s1">&#39; = 0</span>
    <span class="n">a</span><span class="s1">&#39; = acc (x&#39;</span><span class="p">,</span> <span class="n">v</span><span class="s1">&#39;, a, t + dt)</span>
</pre></div>

</div></p>
</div><div class="scratch">
<p>Unfortunately, this has not yet been implemented in scratch, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="matlab">
<p>Unfortunately, this has not yet been implemented in matlab, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="LabVIEW">
<p>Unfortunately, this has not yet been implemented in LabVIEW, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="javascript">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">tempPos</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="rs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fn</span> <span class="n">verlet</span><span class="p">(</span><span class="n">mut</span> <span class="n">pos</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">f64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">f64</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">let</span> <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">time</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="swift">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">Double</span>
    <span class="n">var</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">time</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="f90">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">SUBROUTINE</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> 
    <span class="n">IMPLICIT</span> <span class="n">NONE</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                <span class="p">::</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">next_pos</span>


    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>

    <span class="n">DO</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="n">d0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">time</span>     <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span><span class="n">d0</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="n">pos</span>      <span class="o">=</span> <span class="n">next_pos</span>
        <span class="n">ELSE</span>
            <span class="n">EXIT</span>
        <span class="n">END</span> <span class="n">IF</span>
    <span class="n">END</span> <span class="n">DO</span>
<span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">verlet</span>
</pre></div>

</div></p>
</div><div class="ruby">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="k">end</span>

   <span class="k">return</span> <span class="n">time</span>

<span class="k">end</span>
</pre></div>

</div></p>
</div><div class="go">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span> <span class="n">float64</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span> <span class="n">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">prevPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span>
	<span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>

	<span class="k">for</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
		<span class="n">nextPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dt</span>
		<span class="n">prevPos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">nextPos</span>
	<span class="p">}</span>

	<span class="k">return</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="asm-x64">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1"># xmm0 - pos</span>
<span class="c1"># xmm1 - acc</span>
<span class="c1"># xmm2 - dt</span>
<span class="c1"># RET xmm0 - time</span>
<span class="n">verlet</span><span class="p">:</span>
  <span class="n">pxor</span>   <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Holds 0 for comparisons</span>
  <span class="n">pxor</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Holds time value</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if pos is greater then 0.0</span>
  <span class="n">jbe</span>    <span class="n">verlet_return</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm1</span>                  <span class="c1"># xmm6 = acc * dt * dt</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Holds previous position</span>
<span class="n">verlet_loop</span><span class="p">:</span>
  <span class="n">addsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Adding dt to time</span>
  <span class="n">movsd</span>  <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Hold old value of posistion</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Calculating new position</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm5</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm6</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm4</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if position is greater then 0.0</span>
  <span class="n">ja</span>     <span class="n">verlet_loop</span>
<span class="n">verlet_return</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Saving time value</span>
  <span class="n">ret</span>
</pre></div>

</div></p>
</div><div class="kotlin">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">verlet</span><span class="p">(</span><span class="n">_pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">):</span> <span class="n">Double</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">_pos</span>  <span class="o">//</span> <span class="n">Since</span> <span class="n">function</span> <span class="n">parameter</span> <span class="n">are</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">can</span><span class="s1">&#39;t be modified</span>
    <span class="n">var</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">val</span> <span class="n">nextPos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">nextPos</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">time</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="nim">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">proc</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span> <span class="nb">float</span> <span class="o">=</span>
  <span class="n">var</span>
    <span class="n">pos</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">pos_in</span>
    <span class="n">prevPos</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tempPos</span><span class="p">:</span> <span class="nb">float</span>

  <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span>

  <span class="k">return</span> <span class="n">time</span>
</pre></div>

</div></p>
</div><div class="lisp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defun</span> <span class="n">verlet</span> <span class="p">(</span><span class="n">pos</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">)</span>
  <span class="s2">&quot;Integrates Newton&#39;s equation for motion while pos &gt; 0 using Verlet integration.&quot;</span>
  <span class="p">(</span><span class="n">loop</span>
    <span class="k">with</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="k">for</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">time</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">&gt;</span> <span class="n">pos</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">;;</span> <span class="n">The</span> <span class="n">starting</span> <span class="n">speed</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="n">to</span> <span class="n">be</span> <span class="n">zero</span><span class="o">.</span>
    <span class="n">do</span> <span class="p">(</span><span class="n">psetf</span>
         <span class="n">pos</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="n">pos</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="o">-</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span> <span class="n">dt</span><span class="p">))</span>
         <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="n">pos</span><span class="p">)</span>
    <span class="k">finally</span> <span class="p">(</span><span class="k">return</span> <span class="n">time</span><span class="p">)))</span>
</pre></div>

</div></p>
</div>
</div>

<p>Now, obviously this poses a problem; what if we want to calculate a term that requires velocity, like the kinetic energy, <script type='math/tex'>\frac{1}{2}mv^2</script>? In this case, we certainly cannot get rid of the velocity! Well, we can find the velocity to <script type='math/tex'>\mathcal{O}(\Delta t^2)</script> accuracy by using the Stormer-Verlet method, which is the same as before, but we calculate velocity like so</p>
<p><script type='math/tex'>
v(t) = \frac{x(t+\Delta t) - x(t-\Delta t)}{2\Delta t} + \mathcal{O}(\Delta t^2)
</script></p>
<p>Note that the 2 in the denominator appears because we are going over 2 timesteps. It's essentially solving <script type='math/tex'>v=\frac{\Delta x}{\Delta t}</script>. In addition, we can calculate the velocity of the next timestep like so</p>
<p><script type='math/tex'>
v(t+\Delta t) = \frac{x(t+\Delta t) - x(t)}{\Delta t} + \mathcal{O}(\Delta t)
</script></p>
<p>However, the error for this is <script type='math/tex'>\mathcal{O}(\Delta t)</script>, which is quite poor, but it gets the job done in a pinch.  Here's what it looks like in code:</p>
<div class=code-section>
<div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>

        <span class="c1"># Because acceleration is constant, velocity is straightforward</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">timestep</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">double</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">double</span> <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">next_pos</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">The</span> <span class="n">acceleration</span> <span class="ow">is</span> <span class="n">constant</span><span class="p">,</span> <span class="n">so</span> <span class="n">the</span> <span class="n">velocity</span> <span class="ow">is</span>
    <span class="o">//</span> <span class="n">straightforward</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">timestep</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">double</span> <span class="o">*</span><span class="n">time</span><span class="p">,</span> <span class="n">double</span> <span class="o">*</span><span class="n">vel</span><span class="p">,</span>
                    <span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="o">*</span><span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="o">*</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>

        <span class="o">*</span><span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="java">
<p><div class="codehilite">
<div class="highlight"><pre><span></span>    <span class="n">static</span> <span class="n">VerletValues</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

        <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">we</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">temp</span> <span class="n">variable</span> <span class="k">for</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">position</span>
        <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>

            <span class="o">//</span> <span class="n">The</span> <span class="n">acceleration</span> <span class="ow">is</span> <span class="n">constant</span><span class="p">,</span> <span class="n">so</span> <span class="n">the</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="n">straightforward</span>
             <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
        <span class="p">}</span>
      
       <span class="k">return</span> <span class="n">new</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">next_pos</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">stormerVerlet</span> <span class="p">::</span> <span class="n">Method</span>
<span class="n">stormerVerlet</span> <span class="n">acc</span> <span class="n">dt</span> <span class="p">(</span><span class="n">xOld</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">a</span><span class="s1">&#39;, t + dt)</span>
  <span class="n">where</span>
    <span class="n">x</span><span class="s1">&#39; = 2 * x - xOld + a * dt ^ 2</span>
    <span class="n">v</span><span class="s1">&#39; = (x&#39;</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span>
    <span class="n">a</span><span class="s1">&#39; = acc (x&#39;</span><span class="p">,</span> <span class="n">v</span><span class="s1">&#39;, a, t + dt)</span>
</pre></div>

</div></p>
</div><div class="scratch">
<p>Unfortunately, this has not yet been implemented in scratch, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>

        <span class="c1"># Because acceleration is constant, velocity is straightforward</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="matlab">
<p>Unfortunately, this has not yet been implemented in matlab, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>

        <span class="c1"># Because acceleration is constant, velocity is straightforward</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="LabVIEW">
<p>Unfortunately, this has not yet been implemented in LabVIEW, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>

        <span class="c1"># Because acceleration is constant, velocity is straightforward</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="javascript">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">tempPos</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span><span class="p">;</span>

    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="rs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fn</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">mut</span> <span class="n">pos</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">f64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">f64</span><span class="p">,</span> <span class="n">f64</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">let</span> <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>

        <span class="o">//</span> <span class="n">Because</span> <span class="n">acceleration</span> <span class="ow">is</span> <span class="n">constant</span><span class="p">,</span> <span class="n">velocity</span> <span class="ow">is</span>
        <span class="o">//</span> <span class="n">straightforward</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="swift">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span> <span class="n">Double</span>
    <span class="n">var</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
        
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span><span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="f90">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">SUBROUTINE</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span> 
    <span class="n">IMPLICIT</span> <span class="n">NONE</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                <span class="p">::</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">next_pos</span>

    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span> 
    <span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>
    <span class="n">vel</span>      <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>

    <span class="n">DO</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="n">d0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">time</span>     <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="n">pos</span>      <span class="o">=</span> <span class="n">next_pos</span>
            <span class="n">vel</span>      <span class="o">=</span> <span class="n">vel</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">ELSE</span>
            <span class="n">EXIT</span>
        <span class="n">END</span> <span class="n">IF</span>
    <span class="n">END</span> <span class="n">DO</span>
<span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">stormer_verlet</span> 
</pre></div>

</div></p>
</div><div class="ruby">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>

        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="k">end</span>

   <span class="k">return</span> <span class="n">time</span>

<span class="k">end</span>
</pre></div>

</div></p>
</div><div class="go">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span> <span class="n">float64</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="n">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">prevPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span>
	<span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

	<span class="k">for</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
		<span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
		<span class="n">nextPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dt</span>
		<span class="n">prevPos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">nextPos</span>
	<span class="p">}</span>

	<span class="k">return</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="asm-x64">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1"># xmm0 - pos</span>
<span class="c1"># xmm1 - acc</span>
<span class="c1"># xmm2 - dt</span>
<span class="c1"># RET xmm0 - time</span>
<span class="c1"># RET xmm1 - velocity</span>
<span class="n">stormer_verlet</span><span class="p">:</span>
  <span class="n">pxor</span>   <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Holds 0 for comparisons</span>
  <span class="n">pxor</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Holds time value</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if pos is greater then 0.0</span>
  <span class="n">jbe</span>    <span class="n">stormer_verlet_return</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm1</span>                  <span class="c1"># xmm6 = acc * dt * dt</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Holds previous position</span>
<span class="n">stormer_verlet_loop</span><span class="p">:</span>
  <span class="n">addsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Adding dt to time</span>
  <span class="n">movsd</span>  <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Hold old value of posistion</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Calculating new position</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm5</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm6</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm4</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if position is greater then 0.0</span>
  <span class="n">ja</span>     <span class="n">stormer_verlet_loop</span>
<span class="n">stormer_verlet_return</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Saving time and velocity</span>
  <span class="n">mulsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">ret</span>
</pre></div>

</div></p>
</div><div class="kotlin">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">_pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">):</span> <span class="n">VerletValues</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">_pos</span>
    <span class="n">var</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">var</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">val</span> <span class="n">nextPos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">nextPos</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="nim">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">proc</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">var</span>
    <span class="n">pos</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">pos_in</span>
    <span class="n">prevPos</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tempPos</span><span class="p">:</span> <span class="nb">float</span>

  <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span>

    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
</pre></div>

</div></p>
</div><div class="lisp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defun</span> <span class="n">stormer</span><span class="o">-</span><span class="n">verlet</span> <span class="p">(</span><span class="n">pos</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">)</span>
  <span class="s2">&quot;Integrates Newton&#39;s equation for motion while pos &gt; 0 using the Stormer-Verlet method.&quot;</span>
  <span class="p">(</span><span class="n">loop</span>
    <span class="k">with</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="k">for</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">time</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">vel</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">))</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">&gt;</span> <span class="n">pos</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">;;</span> <span class="n">Variables</span> <span class="n">are</span> <span class="n">changed</span> <span class="n">simultaneously</span> <span class="n">by</span> <span class="s1">&#39;psetf&#39;</span><span class="p">,</span> <span class="n">so</span> <span class="n">there</span><span class="s1">&#39;s no need for a temporary variable.</span>
    <span class="n">do</span> <span class="p">(</span><span class="n">psetf</span>
         <span class="n">pos</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="n">pos</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="o">-</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span> <span class="n">dt</span><span class="p">))</span>
         <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="n">pos</span><span class="p">)</span>
    <span class="k">finally</span> <span class="p">(</span><span class="k">return</span> <span class="p">(</span><span class="nb">list</span> <span class="n">time</span> <span class="n">vel</span><span class="p">))))</span>
</pre></div>

</div></p>
</div>
</div>

<p>Now, let's say we actually need the velocity to calculate out next timestep. Well, in this case, we simply cannot use the above approximation and instead need to use the <em>Velocity Verlet</em> algorithm.</p>
<h1>Velocity Verlet</h1>
<p>In some ways, this algorithm is even simpler than above. We can calculate everything like</p>
<p><script type='math/tex'>
\begin{align}
x(t+\Delta t) &=x(t) + v(t)\Delta t + \frac{1}{2}a(t)\Delta t^2 \\
a(t+\Delta t) &= f(x(t+\Delta t)) \\
v(t+\Delta t) &= v(t) + \frac{1}{2}(a(t) + a(t+\Delta t))\Delta t
\end{align}
</script></p>
<p>which is literally the kinematic equation above, solving for <script type='math/tex'>x</script>, <script type='math/tex'>v</script>, and <script type='math/tex'>a</script> every timestep. You can also split up the equations like so</p>
<p><script type='math/tex'>
\begin{align}
v(t+\frac{1}{2}\Delta t) &= v(t) + \frac{1}{2}a(t)\Delta t \\
x(t+\Delta t) &=x(t) + v(t+\frac{1}{2}\Delta t)\Delta t \\
a(t+\Delta t) &= f(x(t+\Delta t)) \\
v(t+\Delta t) &= v(t+\frac{1}{2}\Delta t) + \frac{1}{2}a(t+\Delta t)\Delta t
\end{align}
</script></p>
<p>Here is the velocity Verlet method in code:</p>
<div class=code-section>
<div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">timestep</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">double</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">timestep</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">double</span> <span class="o">*</span><span class="n">time</span><span class="p">,</span> <span class="n">double</span> <span class="o">*</span><span class="n">vel</span><span class="p">,</span>
                     <span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="o">*</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="o">*</span><span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="java">
<p><div class="codehilite">
<div class="highlight"><pre><span></span>    <span class="n">static</span> <span class="n">VerletValues</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

        <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">we</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">temp</span> <span class="n">variable</span> <span class="k">for</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">position</span>
        <span class="n">double</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">velocityVerlet</span> <span class="p">::</span> <span class="n">Method</span>
<span class="n">velocityVerlet</span> <span class="n">acc</span> <span class="n">dt</span> <span class="p">(</span><span class="n">xOld</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">aOld</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">a</span><span class="s1">&#39;, t + dt)</span>
  <span class="n">where</span>
    <span class="n">x</span><span class="s1">&#39; = 2 * x - xOld + a * dt ^ 2</span>
    <span class="n">v</span><span class="s1">&#39; = v + 0.5 * (aOld + a) * dt</span>
    <span class="n">a</span><span class="s1">&#39; = acc (x&#39;</span><span class="p">,</span> <span class="n">v</span><span class="s1">&#39;, a, t + dt)</span>
</pre></div>

</div></p>
</div><div class="scratch">
<p>Unfortunately, this has not yet been implemented in scratch, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="matlab">
<p>Unfortunately, this has not yet been implemented in matlab, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="LabVIEW">
<p>Unfortunately, this has not yet been implemented in LabVIEW, so here's Julia code:
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>
</pre></div>

</div></p>
</div><div class="javascript">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="rs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fn</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">mut</span> <span class="n">pos</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">f64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">f64</span><span class="p">,</span> <span class="n">f64</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="swift">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">:</span> <span class="n">Double</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span><span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="f90">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">SUBROUTINE</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span> 
    <span class="n">IMPLICIT</span> <span class="n">NONE</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>

    <span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>
    <span class="n">vel</span>      <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>

    <span class="n">DO</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="n">d0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="n">pos</span>  <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="n">d0</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span> 
            <span class="n">vel</span>  <span class="o">=</span> <span class="n">vel</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">ELSE</span>
            <span class="n">EXIT</span>
        <span class="n">END</span> <span class="n">IF</span>
    <span class="n">END</span> <span class="n">DO</span>
<span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">velocity_verlet</span> 
</pre></div>

</div></p>
</div><div class="ruby">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="k">end</span>

   <span class="k">return</span> <span class="n">time</span>

<span class="k">end</span>
</pre></div>

</div></p>
</div><div class="go">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span> <span class="n">float64</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="n">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

	<span class="k">for</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dt</span>
		<span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
	<span class="p">}</span>

	<span class="k">return</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="asm-x64">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1"># xmm0 - pos</span>
<span class="c1"># xmm1 - acc</span>
<span class="c1"># xmm2 - dt</span>
<span class="c1"># RET xmm0 - time</span>
<span class="c1"># RET xmm1 - velocity</span>
<span class="n">velocity_verlet</span><span class="p">:</span>
  <span class="n">pxor</span>   <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Holds 0 for comparisons</span>
  <span class="n">pxor</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Holds the velocity value</span>
  <span class="n">pxor</span>   <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm4</span>                  <span class="c1"># Holds the time value</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if pos is greater then 0.0</span>
  <span class="n">jbe</span>    <span class="n">velocity_verlet_return</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">half</span>                  <span class="c1"># xmm5 = 0.5 * dt * dt * acc</span>
  <span class="n">mulsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm1</span>
<span class="n">velocity_verlet_loop</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Move velocity into register</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Calculate new position</span>
  <span class="n">addsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm5</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm6</span>
  <span class="n">addsd</span>  <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Incrementing time</span>
  <span class="n">movsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm4</span>                  <span class="c1"># Updating velocity</span>
  <span class="n">mulsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>
  <span class="n">ja</span>     <span class="n">velocity_verlet_loop</span>
<span class="n">velocity_verlet_return</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm4</span>                  <span class="c1"># Saving time and velocity</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">ret</span>
</pre></div>

</div></p>
</div><div class="kotlin">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fun</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">_pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">):</span> <span class="n">VerletValues</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">_pos</span>
    <span class="n">var</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">var</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="nim">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">proc</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">var</span>
    <span class="n">pos</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">pos_in</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

  <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
    <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
</pre></div>

</div></p>
</div><div class="lisp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defun</span> <span class="n">velocity</span><span class="o">-</span><span class="n">verlet</span> <span class="p">(</span><span class="n">pos</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">)</span>
  <span class="s2">&quot;Integrates Newton&#39;s equation for motion while pos &gt; 0 using the velocity in calculations.&quot;</span>
  <span class="p">(</span><span class="n">loop</span>
    <span class="k">for</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">time</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">vel</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pos</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">p</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="n">vel</span> <span class="n">dt</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="mf">0.5</span> <span class="n">acc</span> <span class="n">dt</span> <span class="n">dt</span><span class="p">)))</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">&gt;</span> <span class="n">p</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">finally</span> <span class="p">(</span><span class="k">return</span> <span class="p">(</span><span class="nb">list</span> <span class="n">time</span> <span class="n">vel</span><span class="p">))))</span>
</pre></div>

</div></p>
</div>
</div>

<p>Even though this method is more widely used than the simple Verlet method mentioned above, it unforunately has an error term of <script type='math/tex'>\mathcal{O}(\Delta t^2)</script>, which is two orders of magnitude worse. That said, if you want to have a simulaton with many objects that depend on one another --- like a gravity simulation --- the Velocity Verlet algorithm is a handy choice; however, you may have to play further tricks to allow everything to scale appropriately. These types of simulatons are sometimes called <em>n-body</em> simulations and one such trick is the Barnes-Hut algorithm, which cuts the complexity of n-body simulations from <script type='math/tex'>\sim \mathcal{O}(n^2)</script> to <script type='math/tex'>\sim \mathcal{O}(n\log(n))</script>.</p>
<h2>Video Explanation</h2>
<p>Here is a video describing Verlet integration:</p>
<div style="text-align:center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/g55QvpAev0I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<h2>Example Code</h2>
<p>Both of these methods work simply by iterating timestep-by-timestep and can be written straightforwardly in any language. For reference, here are snippets of code that use both the classic and velocity Verlet methods to find the time it takes for a ball to hit the ground after being dropped from a given height.</p>
<div class=code-section>
<div class="jl">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>

        <span class="c1"># Because acceleration is constant, velocity is straightforward</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">acc</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">dt</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">main</span><span class="p">()</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for Verlet integration is: $(time)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for Stormer Verlet integration is: $(time)&quot;</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Velocity for Stormer Verlet integration is: $(vel)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for velocity Verlet integration is: $(time)&quot;</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Velocity for velocity Verlet integration is: $(vel)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">end</span>

<span class="n">main</span><span class="p">()</span>
</pre></div>

</div></p>
</div><div class="cpp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1">#include &lt;iomanip&gt;</span>
<span class="c1">#include &lt;iostream&gt;</span>

<span class="n">struct</span> <span class="n">timestep</span> <span class="p">{</span>
  <span class="n">double</span> <span class="n">time</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">vel</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">double</span> <span class="n">verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">double</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">double</span> <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">next_pos</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">timestep</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">double</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">double</span> <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">next_pos</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">The</span> <span class="n">acceleration</span> <span class="ow">is</span> <span class="n">constant</span><span class="p">,</span> <span class="n">so</span> <span class="n">the</span> <span class="n">velocity</span> <span class="ow">is</span>
    <span class="o">//</span> <span class="n">straightforward</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">timestep</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>

<span class="n">timestep</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">double</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">timestep</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">fixed</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

  <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">depending</span> <span class="n">on</span> <span class="n">the</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">you</span> <span class="n">might</span> <span class="n">want</span> <span class="n">to</span> <span class="n">have</span> <span class="n">the</span>
  <span class="o">//</span> <span class="n">Verlet</span> <span class="n">loop</span> <span class="n">outside</span><span class="o">.</span>

  <span class="o">//</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="k">if</span> <span class="n">your</span> <span class="n">acceleration</span> <span class="n">chages</span> <span class="k">as</span> <span class="n">a</span> <span class="n">function</span> <span class="n">of</span> <span class="n">time</span><span class="p">,</span>
  <span class="o">//</span> <span class="n">you</span> <span class="n">might</span> <span class="n">need</span> <span class="n">to</span> <span class="n">also</span> <span class="n">change</span> <span class="n">the</span> <span class="n">acceleration</span> <span class="n">to</span> <span class="n">be</span> <span class="n">read</span> <span class="n">into</span>
  <span class="o">//</span> <span class="n">each</span> <span class="n">of</span> <span class="n">these</span> <span class="n">functions</span><span class="o">.</span>

  <span class="n">double</span> <span class="n">time</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Time for Verlet integration is: &quot;</span> \
            <span class="o">&lt;&lt;</span> <span class="n">time</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="n">timestep</span> <span class="n">timestep_sv</span> <span class="o">=</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Time for Stormer Verlet integration is: &quot;</span> \
            <span class="o">&lt;&lt;</span> <span class="n">timestep_sv</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Velocity for Stormer Verlet integration is: &quot;</span> \
            <span class="o">&lt;&lt;</span> <span class="n">timestep_sv</span><span class="o">.</span><span class="n">vel</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="n">timestep</span> <span class="n">timestep_vv</span> <span class="o">=</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Time for velocity Verlet integration is: &quot;</span> \
            <span class="o">&lt;&lt;</span> <span class="n">timestep_vv</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Velocity for velocity Verlet integration is: &quot;</span> \
            <span class="o">&lt;&lt;</span> <span class="n">timestep_vv</span><span class="o">.</span><span class="n">vel</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="c">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>

<span class="n">void</span> <span class="n">verlet</span><span class="p">(</span><span class="n">double</span> <span class="o">*</span><span class="n">time</span><span class="p">,</span> <span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="o">*</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">double</span> <span class="o">*</span><span class="n">time</span><span class="p">,</span> <span class="n">double</span> <span class="o">*</span><span class="n">vel</span><span class="p">,</span>
                    <span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="o">*</span><span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="o">*</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>

        <span class="o">*</span><span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">double</span> <span class="o">*</span><span class="n">time</span><span class="p">,</span> <span class="n">double</span> <span class="o">*</span><span class="n">vel</span><span class="p">,</span>
                     <span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="o">*</span><span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="p">(</span><span class="o">*</span><span class="n">vel</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="o">*</span><span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">double</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">;</span>

    <span class="n">verlet</span><span class="p">(</span><span class="o">&amp;</span><span class="n">time</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Time for Verlet integration is: </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
           <span class="n">time</span><span class="p">);</span>

    <span class="n">stormer_verlet</span><span class="p">(</span><span class="o">&amp;</span><span class="n">time</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vel</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Time and velocity for Stormer Verlet integration is: </span><span class="si">%lf</span><span class="s2">, </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
           <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">);</span>

    <span class="n">velocity_verlet</span><span class="p">(</span><span class="o">&amp;</span><span class="n">time</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vel</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Time and velocity for velocity Verlet integration is: </span><span class="si">%lf</span><span class="s2">, </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
           <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="java">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">VerletValues</span> <span class="p">{</span>
	<span class="n">public</span> <span class="n">double</span> <span class="n">time</span><span class="p">;</span>
	<span class="n">public</span> <span class="n">double</span> <span class="n">vel</span><span class="p">;</span>

	<span class="n">public</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">double</span> <span class="n">time</span><span class="p">,</span> <span class="n">double</span> <span class="n">vel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">;</span>
        <span class="n">this</span><span class="o">.</span><span class="n">vel</span> <span class="o">=</span> <span class="n">vel</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div>
<div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">Verlet</span> <span class="p">{</span>
    <span class="n">static</span> <span class="n">double</span> <span class="n">verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

      <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">we</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">temp</span> <span class="n">variable</span> <span class="k">for</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">position</span>
      <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">;</span>
      <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
      <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="n">static</span> <span class="n">VerletValues</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

        <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">we</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">temp</span> <span class="n">variable</span> <span class="k">for</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">position</span>
        <span class="n">double</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>

            <span class="o">//</span> <span class="n">The</span> <span class="n">acceleration</span> <span class="ow">is</span> <span class="n">constant</span><span class="p">,</span> <span class="n">so</span> <span class="n">the</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="n">straightforward</span>
             <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
        <span class="p">}</span>
      
       <span class="k">return</span> <span class="n">new</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">static</span> <span class="n">VerletValues</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">double</span> <span class="n">pos</span><span class="p">,</span> <span class="n">double</span> <span class="n">acc</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>

        <span class="o">//</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">we</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">temp</span> <span class="n">variable</span> <span class="k">for</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">position</span>
        <span class="n">double</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
            <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">double</span> <span class="n">verletTime</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for Verlet integration is: &quot;</span> <span class="o">+</span> <span class="n">verletTime</span><span class="p">);</span>
      
        <span class="n">VerletValues</span> <span class="n">stormerVerlet</span> <span class="o">=</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for Stormer Verlet integration is: &quot;</span> <span class="o">+</span> <span class="n">stormerVerlet</span><span class="o">.</span><span class="n">time</span><span class="p">);</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Velocity for Stormer Verlet integration is: &quot;</span> <span class="o">+</span> <span class="n">stormerVerlet</span><span class="o">.</span><span class="n">vel</span><span class="p">);</span>
        
        <span class="n">VerletValues</span> <span class="n">velocityVerlet</span> <span class="o">=</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for velocity Verlet integration is: &quot;</span> <span class="o">+</span> <span class="n">velocityVerlet</span><span class="o">.</span><span class="n">time</span><span class="p">);</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Velocity for velocity Verlet integration is: &quot;</span> <span class="o">+</span> <span class="n">velocityVerlet</span><span class="o">.</span><span class="n">vel</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="py">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">next_pos</span>

    <span class="k">return</span> <span class="n">time</span>

<span class="k">def</span> <span class="nf">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">next_pos</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>

<span class="k">def</span> <span class="nf">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verlet&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time: </span><span class="si">{:.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stormer-Verlet&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time: </span><span class="si">{:.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Velocity: </span><span class="si">{:.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Velocity Verlet&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time: </span><span class="si">{:.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Velocity: </span><span class="si">{:.10f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

</div></p>
</div><div class="hs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">submitted</span> <span class="n">by</span> <span class="n">Jie</span>
<span class="nb">type</span> <span class="n">Time</span> <span class="o">=</span> <span class="n">Double</span>

<span class="nb">type</span> <span class="n">Position</span> <span class="o">=</span> <span class="n">Double</span>

<span class="nb">type</span> <span class="n">Speed</span> <span class="o">=</span> <span class="n">Double</span>

<span class="nb">type</span> <span class="n">Acceleration</span> <span class="o">=</span> <span class="n">Double</span>

<span class="nb">type</span> <span class="n">Particle</span> <span class="o">=</span> <span class="p">(</span><span class="n">Position</span><span class="p">,</span> <span class="n">Speed</span><span class="p">,</span> <span class="n">Acceleration</span><span class="p">,</span> <span class="n">Time</span><span class="p">)</span>

<span class="nb">type</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">Particle</span> <span class="o">-&gt;</span> <span class="n">Acceleration</span>

<span class="nb">type</span> <span class="n">Method</span> <span class="o">=</span> <span class="n">Model</span> <span class="o">-&gt;</span> <span class="n">Time</span> <span class="o">-&gt;</span> <span class="n">Particle</span> <span class="o">-&gt;</span> <span class="n">Particle</span> <span class="o">-&gt;</span> <span class="n">Particle</span>

<span class="n">verlet</span> <span class="p">::</span> <span class="n">Method</span>
<span class="n">verlet</span> <span class="n">acc</span> <span class="n">dt</span> <span class="p">(</span><span class="n">xOld</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">a</span><span class="s1">&#39;, t + dt)</span>
  <span class="n">where</span>
    <span class="n">x</span><span class="s1">&#39; = 2 * x - xOld + a * dt ^ 2</span>
    <span class="n">v</span><span class="s1">&#39; = 0</span>
    <span class="n">a</span><span class="s1">&#39; = acc (x&#39;</span><span class="p">,</span> <span class="n">v</span><span class="s1">&#39;, a, t + dt)</span>

<span class="n">stormerVerlet</span> <span class="p">::</span> <span class="n">Method</span>
<span class="n">stormerVerlet</span> <span class="n">acc</span> <span class="n">dt</span> <span class="p">(</span><span class="n">xOld</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">a</span><span class="s1">&#39;, t + dt)</span>
  <span class="n">where</span>
    <span class="n">x</span><span class="s1">&#39; = 2 * x - xOld + a * dt ^ 2</span>
    <span class="n">v</span><span class="s1">&#39; = (x&#39;</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span>
    <span class="n">a</span><span class="s1">&#39; = acc (x&#39;</span><span class="p">,</span> <span class="n">v</span><span class="s1">&#39;, a, t + dt)</span>

<span class="n">velocityVerlet</span> <span class="p">::</span> <span class="n">Method</span>
<span class="n">velocityVerlet</span> <span class="n">acc</span> <span class="n">dt</span> <span class="p">(</span><span class="n">xOld</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">aOld</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">a</span><span class="s1">&#39;, t + dt)</span>
  <span class="n">where</span>
    <span class="n">x</span><span class="s1">&#39; = 2 * x - xOld + a * dt ^ 2</span>
    <span class="n">v</span><span class="s1">&#39; = v + 0.5 * (aOld + a) * dt</span>
    <span class="n">a</span><span class="s1">&#39; = acc (x&#39;</span><span class="p">,</span> <span class="n">v</span><span class="s1">&#39;, a, t + dt)</span>

<span class="n">trajectory</span> <span class="p">::</span> <span class="n">Method</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="o">-&gt;</span> <span class="n">Time</span> <span class="o">-&gt;</span> <span class="n">Particle</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">Particle</span><span class="p">]</span>
<span class="n">trajectory</span> <span class="n">method</span> <span class="n">acc</span> <span class="n">dt</span> <span class="n">p0</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t0</span><span class="p">)</span> <span class="o">=</span> <span class="n">traj</span>
  <span class="n">where</span>
    <span class="n">traj</span> <span class="o">=</span> <span class="n">p0</span> <span class="p">:</span> <span class="n">p1</span> <span class="p">:</span> <span class="n">zipWith</span> <span class="p">(</span><span class="n">method</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">)</span> <span class="n">traj</span> <span class="p">(</span><span class="n">tail</span> <span class="n">traj</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">acc</span> <span class="p">(</span><span class="n">x</span><span class="s1">&#39;, v&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">),</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">x</span><span class="s1">&#39; = x + v * dt + 0.5 * a * dt ^ 2</span>
    <span class="n">v</span><span class="s1">&#39; = v + a * dt</span>

<span class="n">main</span> <span class="p">::</span> <span class="n">IO</span> <span class="p">()</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">do</span>
  <span class="n">let</span> <span class="n">p0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
      <span class="n">freefall</span> <span class="n">_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
      <span class="n">aboveGround</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="n">integrate</span> <span class="n">m</span> <span class="o">=</span> <span class="n">last</span> <span class="err">$</span> <span class="n">takeWhile</span> <span class="n">aboveGround</span> <span class="err">$</span> <span class="n">trajectory</span> <span class="n">m</span> <span class="n">freefall</span> <span class="n">dt</span> <span class="n">p0</span>
  <span class="nb">print</span> <span class="err">$</span> <span class="n">integrate</span> <span class="n">verlet</span>
  <span class="nb">print</span> <span class="err">$</span> <span class="n">integrate</span> <span class="n">stormerVerlet</span>
  <span class="nb">print</span> <span class="err">$</span> <span class="n">integrate</span> <span class="n">velocityVerlet</span>
</pre></div>

</div></p>
</div><div class="scratch">
<p>Submitted by Jie
<p>
    <img  class="center" src="code/scratch/verlet_scratch.png" />
</p>
Link: <a href="https://scratch.mit.edu/projects/173039394/">https://scratch.mit.edu/projects/173039394/</a></p>
</div><div class="matlab">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Submitted</span> <span class="n">by</span> <span class="n">P</span><span class="o">.</span> <span class="n">Mekhail</span>
<span class="o">%</span> <span class="n">Parameters</span> <span class="n">to</span> <span class="n">change</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>        <span class="o">%</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">steps</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>         <span class="o">%</span> <span class="n">Ball</span> <span class="n">starting</span> <span class="n">height</span><span class="p">(</span><span class="ow">in</span> <span class="n">metres</span><span class="p">)</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>         <span class="o">%</span> <span class="n">Ball</span> <span class="n">starting</span> <span class="n">velocity</span> <span class="p">(</span><span class="o">+</span><span class="n">ive</span> <span class="ow">is</span> <span class="n">up</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>      <span class="o">%</span> <span class="n">Time</span> <span class="n">step</span> <span class="p">(</span><span class="ow">in</span> <span class="n">seconds</span><span class="p">)</span>
<span class="n">eff</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>      <span class="o">%</span> <span class="n">Ball</span> <span class="n">efficency</span> <span class="n">when</span> <span class="n">bouncing</span>
<span class="n">A</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span><span class="mi">10</span><span class="p">;</span>   <span class="o">%</span> <span class="n">Acceleration</span> <span class="k">as</span> <span class="n">a</span> <span class="n">function</span> <span class="n">of</span> <span class="n">position</span>
<span class="n">bounce</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="o">%</span> <span class="n">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">the</span> <span class="n">ball</span> <span class="n">to</span> <span class="n">bounce</span><span class="err">?</span>

<span class="o">%</span> <span class="n">Making</span> <span class="n">position</span> <span class="ow">and</span> <span class="n">time</span> <span class="n">vectors</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">dt</span><span class="p">:</span><span class="n">n</span><span class="o">*</span><span class="n">dt</span><span class="o">-</span><span class="n">dt</span><span class="p">;</span>

<span class="o">%</span> <span class="n">Setting</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">conditions</span>
<span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x0</span><span class="p">;</span>
<span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">v0</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">A</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>

<span class="o">%</span> <span class="n">Runnin</span> <span class="n">Verlet</span> <span class="n">Integration</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">A</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">dt</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">bounce</span>
        <span class="k">if</span> <span class="n">xnew</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="o">%</span> <span class="n">If</span> <span class="n">you</span> <span class="n">haven</span><span class="s1">&#39;t hit the ground keep going</span>
            <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="o">%</span> <span class="n">If</span> <span class="n">you</span> <span class="n">have</span> <span class="n">calculated</span> <span class="n">velocity</span> <span class="ow">and</span> <span class="n">invert</span> <span class="n">its</span> <span class="n">sign</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">eff</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">xnew</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">);</span>
            <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">A</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">dt</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">end</span>
    <span class="k">else</span>
        <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">;</span>
    <span class="n">end</span>
<span class="n">end</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ball&#39;&#39;s Trajectory&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Height (m)&#39;</span><span class="p">);</span>
</pre></div>

</div></p>
</div><div class="LabVIEW">
<p>Submitted by P. Mekhail
<p>
    <img  class="center" src="code/labview/verlet_labview.png" />
</p></p>
</div><div class="javascript">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">tempPos</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">tempPos</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span><span class="p">;</span>

    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">};</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">time</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Time</span> <span class="k">for</span> <span class="n">Verlet</span> <span class="n">integration</span> <span class="ow">is</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">time</span><span class="p">}</span>\<span class="n">n</span><span class="err">`</span><span class="p">);</span>

<span class="n">const</span> <span class="n">stormer</span> <span class="o">=</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Time</span> <span class="k">for</span> <span class="n">Stormer</span> <span class="n">Verlet</span> <span class="n">integration</span> <span class="ow">is</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">stormer</span><span class="o">.</span><span class="n">time</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Velocity</span> <span class="k">for</span> <span class="n">Stormer</span> <span class="n">Verlet</span> <span class="n">integration</span> <span class="ow">is</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">stormer</span><span class="o">.</span><span class="n">vel</span><span class="p">}</span>\<span class="n">n</span><span class="err">`</span><span class="p">);</span>

<span class="n">const</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Time</span> <span class="k">for</span> <span class="n">Velocity</span> <span class="n">Verlet</span> <span class="n">integration</span> <span class="ow">is</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">velocity</span><span class="o">.</span><span class="n">time</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Velocity</span> <span class="k">for</span> <span class="n">Velocity</span> <span class="n">Verlet</span> <span class="n">integration</span> <span class="ow">is</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">velocity</span><span class="o">.</span><span class="n">vel</span><span class="p">}</span>\<span class="n">n</span><span class="err">`</span><span class="p">);</span>
</pre></div>

</div></p>
</div><div class="rs">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">fn</span> <span class="n">verlet</span><span class="p">(</span><span class="n">mut</span> <span class="n">pos</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">f64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">f64</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">let</span> <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">time</span>
<span class="p">}</span>

<span class="n">fn</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">mut</span> <span class="n">pos</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">f64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">f64</span><span class="p">,</span> <span class="n">f64</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">let</span> <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span><span class="p">;</span>

        <span class="o">//</span> <span class="n">Because</span> <span class="n">acceleration</span> <span class="ow">is</span> <span class="n">constant</span><span class="p">,</span> <span class="n">velocity</span> <span class="ow">is</span>
        <span class="o">//</span> <span class="n">straightforward</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">fn</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">mut</span> <span class="n">pos</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">f64</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">f64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">f64</span><span class="p">,</span> <span class="n">f64</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="n">let</span> <span class="n">mut</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">fn</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">time_v</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">let</span> <span class="p">(</span><span class="n">time_sv</span><span class="p">,</span> <span class="n">vel_sv</span><span class="p">)</span> <span class="o">=</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="n">let</span> <span class="p">(</span><span class="n">time_vv</span><span class="p">,</span> <span class="n">vel_vv</span><span class="p">)</span> <span class="o">=</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>

    <span class="n">println</span><span class="err">!</span><span class="p">(</span><span class="s2">&quot;Time for original Verlet integration: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">time_v</span><span class="p">);</span>
    <span class="n">println</span><span class="err">!</span><span class="p">(</span>
        <span class="s2">&quot;Time and velocity for Stormer Verlet integration: </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">time_sv</span><span class="p">,</span> <span class="n">vel_sv</span>
    <span class="p">);</span>
    <span class="n">println</span><span class="err">!</span><span class="p">(</span>
        <span class="s2">&quot;Time and velocity for velocity Verlet integration: </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">time_vv</span><span class="p">,</span> <span class="n">vel_vv</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="swift">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Double</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">Double</span>
    <span class="n">var</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">time</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">temp_pos</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span> <span class="n">Double</span>
    <span class="n">var</span> <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
        
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span><span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">:</span> <span class="n">Double</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">:</span><span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">verletTime</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time for Verlet integration is: \(verletTime)&quot;</span><span class="p">)</span>
    
    <span class="n">let</span> <span class="n">stormer</span> <span class="o">=</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">);</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time for Stormer Verlet integration is: \(stormer.time)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Velocity for Stormer Verlet integration is: \(stormer.vel)&quot;</span><span class="p">)</span>
    
    <span class="n">let</span> <span class="n">velVerlet</span> <span class="o">=</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time for velocity Verlet integration is: \(velVerlet.time)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Velocity for velocity Verlet integration is: \(velVerlet.vel)&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">main</span><span class="p">()</span>
</pre></div>

</div></p>
</div><div class="f90">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">SUBROUTINE</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> 
    <span class="n">IMPLICIT</span> <span class="n">NONE</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                <span class="p">::</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">next_pos</span>


    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>

    <span class="n">DO</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="n">d0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">time</span>     <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span><span class="n">d0</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="n">pos</span>      <span class="o">=</span> <span class="n">next_pos</span>
        <span class="n">ELSE</span>
            <span class="n">EXIT</span>
        <span class="n">END</span> <span class="n">IF</span>
    <span class="n">END</span> <span class="n">DO</span>
<span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">verlet</span>

<span class="n">SUBROUTINE</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span> 
    <span class="n">IMPLICIT</span> <span class="n">NONE</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                <span class="p">::</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">next_pos</span>

    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span> 
    <span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>
    <span class="n">vel</span>      <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>

    <span class="n">DO</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="n">d0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">time</span>     <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="n">next_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="n">pos</span>      <span class="o">=</span> <span class="n">next_pos</span>
            <span class="n">vel</span>      <span class="o">=</span> <span class="n">vel</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">ELSE</span>
            <span class="n">EXIT</span>
        <span class="n">END</span> <span class="n">IF</span>
    <span class="n">END</span> <span class="n">DO</span>
<span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">stormer_verlet</span> 

<span class="n">SUBROUTINE</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span> 
    <span class="n">IMPLICIT</span> <span class="n">NONE</span>
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>

    <span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>
    <span class="n">vel</span>      <span class="o">=</span> <span class="mi">0</span><span class="n">d0</span>

    <span class="n">DO</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="n">d0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="n">pos</span>  <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="n">d0</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span> 
            <span class="n">vel</span>  <span class="o">=</span> <span class="n">vel</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">ELSE</span>
            <span class="n">EXIT</span>
        <span class="n">END</span> <span class="n">IF</span>
    <span class="n">END</span> <span class="n">DO</span>
<span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">velocity_verlet</span> 

<span class="n">PROGRAM</span> <span class="n">verlet_integration</span>

    <span class="n">IMPLICIT</span> <span class="n">NONE</span> 
    <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
    
    <span class="n">INTERFACE</span>
        <span class="n">SUBROUTINE</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span>
        <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                <span class="p">::</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">next_pos</span>
        <span class="n">END</span> <span class="n">SUBROUTINE</span>
    <span class="n">END</span> <span class="n">INTERFACE</span> 
    
    <span class="n">INTERFACE</span> 
        <span class="n">SUBROUTINE</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span> 
            <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
            <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                <span class="p">::</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">next_pos</span>
        <span class="n">END</span> <span class="n">SUBROUTINE</span> 
    <span class="n">END</span> <span class="n">INTERFACE</span> 
    
    <span class="n">INTERFACE</span> 
        <span class="n">SUBROUTINE</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span> 
            <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="p">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span>
            <span class="n">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                <span class="p">::</span> <span class="n">prev_pos</span><span class="p">,</span> <span class="n">next_pos</span> 
        <span class="n">END</span> <span class="n">SUBROUTINE</span> 
    <span class="n">END</span> <span class="n">INTERFACE</span> 
    
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">5</span><span class="n">d0</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="n">d0</span>
    <span class="n">dt</span>  <span class="o">=</span> <span class="mf">0.01</span><span class="n">d0</span>
    <span class="err">!</span> <span class="n">Verlet</span> 
    <span class="n">CALL</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
    
    <span class="n">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Time for Verlet integration: &#39;</span><span class="p">,</span> <span class="n">time</span> 
    
    <span class="err">!</span> <span class="n">stormer</span> <span class="n">Verlet</span> 
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">5</span><span class="n">d0</span>
    <span class="n">CALL</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
    
    <span class="n">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Time for Stormer-Verlet integration: &#39;</span><span class="p">,</span> <span class="n">time</span> 
    
    <span class="err">!</span> <span class="n">Velocity</span> <span class="n">Verlet</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">5</span><span class="n">d0</span>
    <span class="n">CALL</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
    
    <span class="n">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Time for Velocity-Verlet integration: &#39;</span><span class="p">,</span> <span class="n">time</span> 
    
<span class="n">END</span> <span class="n">PROGRAM</span> <span class="n">verlet_integration</span>
</pre></div>

</div></p>
</div><div class="ruby">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="k">end</span>

   <span class="k">return</span> <span class="n">time</span>

<span class="k">end</span>

<span class="k">def</span> <span class="nf">stormer_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prev_pos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">temp_pos</span>

        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="k">end</span>

   <span class="k">return</span> <span class="n">time</span>

<span class="k">end</span>

<span class="k">def</span> <span class="nf">velocity_verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span>
    <span class="k">end</span>

   <span class="k">return</span> <span class="n">time</span>

<span class="k">end</span>

<span class="nb">p</span> <span class="n">verlet</span><span class="p">(</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">stormer_verlet</span><span class="p">(</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">velocity_verlet</span><span class="p">(</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
</pre></div>

</div></p>
</div><div class="go">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">verlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span> <span class="n">float64</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span> <span class="n">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">prevPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span>
	<span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>

	<span class="k">for</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
		<span class="n">nextPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dt</span>
		<span class="n">prevPos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">nextPos</span>
	<span class="p">}</span>

	<span class="k">return</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span> <span class="n">float64</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="n">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">prevPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span>
	<span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

	<span class="k">for</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
		<span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
		<span class="n">nextPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">pos</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dt</span>
		<span class="n">prevPos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">nextPos</span>
	<span class="p">}</span>

	<span class="k">return</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span> <span class="n">float64</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="n">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

	<span class="k">for</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">acc</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dt</span>
		<span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
	<span class="p">}</span>

	<span class="k">return</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">time</span> <span class="p">:</span><span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mf">5.</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Verlet&quot;</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Time:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">()</span>

	<span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="p">:</span><span class="o">=</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="mf">5.</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Stormer-Verlet&quot;</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Time:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Velocity:&quot;</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">()</span>

	<span class="n">time</span><span class="p">,</span> <span class="n">vel</span> <span class="o">=</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="mf">5.</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Velocity Verlet&quot;</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Time:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Velocity:&quot;</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="asm-x64">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="o">.</span><span class="n">intel_syntax</span> <span class="n">noprefix</span>

<span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">rodata</span>
  <span class="n">zero</span><span class="p">:</span>          <span class="o">.</span><span class="n">double</span> <span class="mf">0.0</span>
  <span class="n">two</span><span class="p">:</span>           <span class="o">.</span><span class="n">double</span> <span class="mf">2.0</span>
  <span class="n">half</span><span class="p">:</span>          <span class="o">.</span><span class="n">double</span> <span class="mf">0.5</span>
  <span class="n">verlet_fmt</span><span class="p">:</span>    <span class="o">.</span><span class="n">string</span> <span class="s2">&quot;Time for Verlet integration is: </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">stormer_fmt</span><span class="p">:</span>   <span class="o">.</span><span class="n">string</span> <span class="s2">&quot;Time and Velocity for Stormer Verlet Integration is: </span><span class="si">%lf</span><span class="s2">, </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">velocity_fmt</span><span class="p">:</span>  <span class="o">.</span><span class="n">string</span> <span class="s2">&quot;Time and Velocity for Velocity Verlet Integration is: </span><span class="si">%lf</span><span class="s2">, </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">pos</span><span class="p">:</span>           <span class="o">.</span><span class="n">double</span> <span class="mf">5.0</span>
  <span class="n">acc</span><span class="p">:</span>           <span class="o">.</span><span class="n">double</span> <span class="o">-</span><span class="mf">10.0</span>
  <span class="n">dt</span><span class="p">:</span>            <span class="o">.</span><span class="n">double</span> <span class="mf">0.01</span>

<span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">text</span>
  <span class="o">.</span><span class="k">global</span> <span class="n">main</span>
  <span class="o">.</span><span class="n">extern</span> <span class="n">printf</span>

<span class="c1"># xmm0 - pos</span>
<span class="c1"># xmm1 - acc</span>
<span class="c1"># xmm2 - dt</span>
<span class="c1"># RET xmm0 - time</span>
<span class="n">verlet</span><span class="p">:</span>
  <span class="n">pxor</span>   <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Holds 0 for comparisons</span>
  <span class="n">pxor</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Holds time value</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if pos is greater then 0.0</span>
  <span class="n">jbe</span>    <span class="n">verlet_return</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm1</span>                  <span class="c1"># xmm6 = acc * dt * dt</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Holds previous position</span>
<span class="n">verlet_loop</span><span class="p">:</span>
  <span class="n">addsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Adding dt to time</span>
  <span class="n">movsd</span>  <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Hold old value of posistion</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Calculating new position</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm5</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm6</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm4</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if position is greater then 0.0</span>
  <span class="n">ja</span>     <span class="n">verlet_loop</span>
<span class="n">verlet_return</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Saving time value</span>
  <span class="n">ret</span>

<span class="c1"># xmm0 - pos</span>
<span class="c1"># xmm1 - acc</span>
<span class="c1"># xmm2 - dt</span>
<span class="c1"># RET xmm0 - time</span>
<span class="c1"># RET xmm1 - velocity</span>
<span class="n">stormer_verlet</span><span class="p">:</span>
  <span class="n">pxor</span>   <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Holds 0 for comparisons</span>
  <span class="n">pxor</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Holds time value</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if pos is greater then 0.0</span>
  <span class="n">jbe</span>    <span class="n">stormer_verlet_return</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm1</span>                  <span class="c1"># xmm6 = acc * dt * dt</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Holds previous position</span>
<span class="n">stormer_verlet_loop</span><span class="p">:</span>
  <span class="n">addsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Adding dt to time</span>
  <span class="n">movsd</span>  <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Hold old value of posistion</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm0</span>                  <span class="c1"># Calculating new position</span>
  <span class="n">subsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm5</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm6</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm4</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if position is greater then 0.0</span>
  <span class="n">ja</span>     <span class="n">stormer_verlet_loop</span>
<span class="n">stormer_verlet_return</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Saving time and velocity</span>
  <span class="n">mulsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">ret</span>

<span class="c1"># xmm0 - pos</span>
<span class="c1"># xmm1 - acc</span>
<span class="c1"># xmm2 - dt</span>
<span class="c1"># RET xmm0 - time</span>
<span class="c1"># RET xmm1 - velocity</span>
<span class="n">velocity_verlet</span><span class="p">:</span>
  <span class="n">pxor</span>   <span class="n">xmm7</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Holds 0 for comparisons</span>
  <span class="n">pxor</span>   <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Holds the velocity value</span>
  <span class="n">pxor</span>   <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm4</span>                  <span class="c1"># Holds the time value</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>                  <span class="c1"># Check if pos is greater then 0.0</span>
  <span class="n">jbe</span>    <span class="n">velocity_verlet_return</span>
  <span class="n">movsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">half</span>                  <span class="c1"># xmm5 = 0.5 * dt * dt * acc</span>
  <span class="n">mulsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm2</span>
  <span class="n">mulsd</span>  <span class="n">xmm5</span><span class="p">,</span> <span class="n">xmm1</span>
<span class="n">velocity_verlet_loop</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm3</span>                  <span class="c1"># Move velocity into register</span>
  <span class="n">mulsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Calculate new position</span>
  <span class="n">addsd</span>  <span class="n">xmm6</span><span class="p">,</span> <span class="n">xmm5</span>
  <span class="n">addsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm6</span>
  <span class="n">addsd</span>  <span class="n">xmm4</span><span class="p">,</span> <span class="n">xmm2</span>                  <span class="c1"># Incrementing time</span>
  <span class="n">movsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm4</span>                  <span class="c1"># Updating velocity</span>
  <span class="n">mulsd</span>  <span class="n">xmm3</span><span class="p">,</span> <span class="n">xmm1</span>
  <span class="n">comisd</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm7</span>
  <span class="n">ja</span>     <span class="n">velocity_verlet_loop</span>
<span class="n">velocity_verlet_return</span><span class="p">:</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm4</span>                  <span class="c1"># Saving time and velocity</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">xmm3</span>
  <span class="n">ret</span>

<span class="n">main</span><span class="p">:</span>
  <span class="n">push</span>   <span class="n">rbp</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">pos</span>                   <span class="c1"># Calling verlet</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">acc</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">dt</span>
  <span class="n">call</span>   <span class="n">verlet</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">OFFSET</span> <span class="n">verlet_fmt</span>      <span class="c1"># Print output</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">call</span>   <span class="n">printf</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">pos</span>                   <span class="c1"># Calling stormer_verlet</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">acc</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">dt</span>
  <span class="n">call</span>   <span class="n">stormer_verlet</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">OFFSET</span> <span class="n">stormer_fmt</span>     <span class="c1"># Print output</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">call</span>   <span class="n">printf</span>
  <span class="n">movsd</span>  <span class="n">xmm0</span><span class="p">,</span> <span class="n">pos</span>                   <span class="c1"># Calling velocity_verlet</span>
  <span class="n">movsd</span>  <span class="n">xmm1</span><span class="p">,</span> <span class="n">acc</span>
  <span class="n">movsd</span>  <span class="n">xmm2</span><span class="p">,</span> <span class="n">dt</span>
  <span class="n">call</span>   <span class="n">velocity_verlet</span>
  <span class="n">mov</span>    <span class="n">rdi</span><span class="p">,</span> <span class="n">OFFSET</span> <span class="n">velocity_fmt</span>    <span class="c1"># Print output</span>
  <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">call</span>   <span class="n">printf</span>
  <span class="n">pop</span>    <span class="n">rbp</span>
  <span class="n">ret</span>
</pre></div>

</div></p>
</div><div class="kotlin">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="k">class</span> <span class="nc">VerletValues</span><span class="p">(</span><span class="n">val</span> <span class="n">time</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">val</span> <span class="n">vel</span><span class="p">:</span> <span class="n">Double</span><span class="p">)</span>

<span class="n">fun</span> <span class="n">verlet</span><span class="p">(</span><span class="n">_pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">):</span> <span class="n">Double</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">_pos</span>  <span class="o">//</span> <span class="n">Since</span> <span class="n">function</span> <span class="n">parameter</span> <span class="n">are</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">can</span><span class="s1">&#39;t be modified</span>
    <span class="n">var</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">val</span> <span class="n">nextPos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">nextPos</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">time</span>
<span class="p">}</span>

<span class="n">fun</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="n">_pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">):</span> <span class="n">VerletValues</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">_pos</span>
    <span class="n">var</span> <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">var</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">var</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">val</span> <span class="n">nextPos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">prevPos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">nextPos</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">fun</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="n">_pos</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="n">Double</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Double</span><span class="p">):</span> <span class="n">VerletValues</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">_pos</span>
    <span class="n">var</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">var</span> <span class="n">vel</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">VerletValues</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">fun</span> <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">verletTime</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for Verlet integration is: $verletTime&quot;</span><span class="p">)</span>

    <span class="n">val</span> <span class="n">stormerVerlet</span> <span class="o">=</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for Stormer Verlet integration is: $stormerVerlet.time&quot;</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Velocity for Stormer Verlet integration is: $stormerVerlet.vel&quot;</span><span class="p">)</span>

    <span class="n">val</span> <span class="n">velocityVerlet</span> <span class="o">=</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Time for Velocity Verlet integration is: $velocityVerlet.time&quot;</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;Velocity for Velocity Verlet integration is: $velocityVerlet.vel&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div></p>
</div><div class="nim">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="k">proc </span><span class="nf">verlet</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="kt">float</span><span class="p">):</span> <span class="kt">float</span> <span class="o">=</span>
  <span class="kd">var</span>
    <span class="n">pos</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="n">pos_in</span>
    <span class="n">prevPos</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tempPos</span><span class="p">:</span> <span class="kt">float</span>

  <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span>

  <span class="k">return</span> <span class="n">time</span>

<span class="k">proc </span><span class="nf">stormerVerlet</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="kt">float</span><span class="p">):</span> <span class="p">(</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">)</span> <span class="o">=</span>
  <span class="kd">var</span>
    <span class="n">pos</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="n">pos_in</span>
    <span class="n">prevPos</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">time</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tempPos</span><span class="p">:</span> <span class="kt">float</span>

  <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
    <span class="n">tempPos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">prevPos</span> <span class="o">+</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">prevPos</span> <span class="o">=</span> <span class="n">tempPos</span>

    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>

<span class="k">proc </span><span class="nf">velocityVerlet</span><span class="p">(</span><span class="n">pos_in</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="kt">float</span><span class="p">):</span> <span class="p">(</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">)</span> <span class="o">=</span>
  <span class="kd">var</span>
    <span class="n">pos</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="n">pos_in</span>
    <span class="n">time</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vel</span><span class="p">:</span> <span class="kt">float</span> <span class="o">=</span> <span class="mf">0.0</span>

  <span class="k">while</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
    <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
    <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">vel</span> <span class="o">+=</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">dt</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>

<span class="k">let</span> <span class="n">timeV</span> <span class="o">=</span> <span class="n">verlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">echo</span> <span class="s">&quot;Time for Verlet integration is: &quot;</span><span class="p">,</span> <span class="n">timeV</span>

<span class="k">let</span> <span class="p">(</span><span class="n">timeSV</span><span class="p">,</span> <span class="n">velSV</span><span class="p">)</span> <span class="o">=</span> <span class="n">stormerVerlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">echo</span> <span class="s">&quot;Time for Stormer Verlet integration is: &quot;</span><span class="p">,</span> <span class="n">timeSV</span>
<span class="n">echo</span> <span class="s">&quot;Velocity for Stormer Verlet integration is: &quot;</span><span class="p">,</span> <span class="n">velSV</span>

<span class="k">let</span> <span class="p">(</span><span class="n">timeVV</span><span class="p">,</span> <span class="n">velVV</span><span class="p">)</span> <span class="o">=</span> <span class="n">velocityVerlet</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">echo</span> <span class="s">&quot;Time for velocity Verlet integration is: &quot;</span><span class="p">,</span> <span class="n">timeVV</span>
<span class="n">echo</span> <span class="s">&quot;Velocity for velocity Verlet integration is: &quot;</span><span class="p">,</span> <span class="n">velVV</span>
</pre></div>

</div></p>
</div><div class="lisp">
<p><div class="codehilite">
<div class="highlight"><pre><span></span><span class="p">;;;;</span> <span class="n">Verlet</span> <span class="n">integration</span> <span class="n">implementation</span> <span class="ow">in</span> <span class="n">Common</span> <span class="n">Lisp</span>

<span class="p">(</span><span class="n">defun</span> <span class="n">verlet</span> <span class="p">(</span><span class="n">pos</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">)</span>
  <span class="s2">&quot;Integrates Newton&#39;s equation for motion while pos &gt; 0 using Verlet integration.&quot;</span>
  <span class="p">(</span><span class="n">loop</span>
    <span class="k">with</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="k">for</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">time</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">&gt;</span> <span class="n">pos</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">;;</span> <span class="n">The</span> <span class="n">starting</span> <span class="n">speed</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="n">to</span> <span class="n">be</span> <span class="n">zero</span><span class="o">.</span>
    <span class="n">do</span> <span class="p">(</span><span class="n">psetf</span>
         <span class="n">pos</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="n">pos</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="o">-</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span> <span class="n">dt</span><span class="p">))</span>
         <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="n">pos</span><span class="p">)</span>
    <span class="k">finally</span> <span class="p">(</span><span class="k">return</span> <span class="n">time</span><span class="p">)))</span>

<span class="p">(</span><span class="n">defun</span> <span class="n">stormer</span><span class="o">-</span><span class="n">verlet</span> <span class="p">(</span><span class="n">pos</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">)</span>
  <span class="s2">&quot;Integrates Newton&#39;s equation for motion while pos &gt; 0 using the Stormer-Verlet method.&quot;</span>
  <span class="p">(</span><span class="n">loop</span>
    <span class="k">with</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="k">for</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">time</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">vel</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">))</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">&gt;</span> <span class="n">pos</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">;;</span> <span class="n">Variables</span> <span class="n">are</span> <span class="n">changed</span> <span class="n">simultaneously</span> <span class="n">by</span> <span class="s1">&#39;psetf&#39;</span><span class="p">,</span> <span class="n">so</span> <span class="n">there</span><span class="s1">&#39;s no need for a temporary variable.</span>
    <span class="n">do</span> <span class="p">(</span><span class="n">psetf</span>
         <span class="n">pos</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="n">pos</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="o">-</span> <span class="n">prev</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span> <span class="n">dt</span><span class="p">))</span>
         <span class="n">prev</span><span class="o">-</span><span class="n">pos</span> <span class="n">pos</span><span class="p">)</span>
    <span class="k">finally</span> <span class="p">(</span><span class="k">return</span> <span class="p">(</span><span class="nb">list</span> <span class="n">time</span> <span class="n">vel</span><span class="p">))))</span>

<span class="p">(</span><span class="n">defun</span> <span class="n">velocity</span><span class="o">-</span><span class="n">verlet</span> <span class="p">(</span><span class="n">pos</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">)</span>
  <span class="s2">&quot;Integrates Newton&#39;s equation for motion while pos &gt; 0 using the velocity in calculations.&quot;</span>
  <span class="p">(</span><span class="n">loop</span>
    <span class="k">for</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">time</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vel</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">vel</span> <span class="p">(</span><span class="o">*</span> <span class="n">acc</span> <span class="n">dt</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pos</span> <span class="n">then</span> <span class="p">(</span><span class="n">incf</span> <span class="n">p</span> <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="n">vel</span> <span class="n">dt</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="mf">0.5</span> <span class="n">acc</span> <span class="n">dt</span> <span class="n">dt</span><span class="p">)))</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">&gt;</span> <span class="n">p</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">finally</span> <span class="p">(</span><span class="k">return</span> <span class="p">(</span><span class="nb">list</span> <span class="n">time</span> <span class="n">vel</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">format</span> <span class="n">T</span> <span class="s2">&quot;Time for Verlet integration: ~d~%&quot;</span> <span class="p">(</span><span class="n">verlet</span> <span class="mi">5</span> <span class="o">-</span><span class="mi">10</span> <span class="mf">0.01</span><span class="p">))</span>

<span class="p">(</span><span class="n">defvar</span> <span class="n">stormer</span><span class="o">-</span><span class="n">verlet</span><span class="o">-</span><span class="n">result</span> <span class="p">(</span><span class="n">stormer</span><span class="o">-</span><span class="n">verlet</span> <span class="mi">5</span> <span class="o">-</span><span class="mi">10</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="n">T</span> <span class="s2">&quot;Time for Stormer Verlet integration is: ~d~%&quot;</span> <span class="p">(</span><span class="n">first</span> <span class="n">stormer</span><span class="o">-</span><span class="n">verlet</span><span class="o">-</span><span class="n">result</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="n">T</span> <span class="s2">&quot;Velocity for Stormer Verlet integration is: ~d~%&quot;</span> <span class="p">(</span><span class="n">second</span> <span class="n">stormer</span><span class="o">-</span><span class="n">verlet</span><span class="o">-</span><span class="n">result</span><span class="p">))</span>

<span class="p">(</span><span class="n">defvar</span> <span class="n">velocity</span><span class="o">-</span><span class="n">verlet</span><span class="o">-</span><span class="n">result</span> <span class="p">(</span><span class="n">velocity</span><span class="o">-</span><span class="n">verlet</span> <span class="mi">5</span> <span class="o">-</span><span class="mi">10</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="n">T</span> <span class="s2">&quot;Time for velocity Verlet integration is: ~d~%&quot;</span> <span class="p">(</span><span class="n">first</span> <span class="n">velocity</span><span class="o">-</span><span class="n">verlet</span><span class="o">-</span><span class="n">result</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="n">T</span> <span class="s2">&quot;Velocity for velocity Verlet integration is: ~d~%&quot;</span> <span class="p">(</span><span class="n">second</span> <span class="n">velocity</span><span class="o">-</span><span class="n">verlet</span><span class="o">-</span><span class="n">result</span><span class="p">))</span>
</pre></div>

</div></p>
</div>
</div>

<script>
MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
</script>

<h2>License</h2>
<h5>Code Examples</h5>
<p>The code examples are licensed under the MIT license (found in <a href="https://github.com/algorithm-archivists/algorithm-archive/blob/master/LICENSE.md">LICENSE.md</a>).</p>
<h5>Text</h5>
<p>The text of this chapter was written by <a href="https://github.com/leios">James Schloss</a> and is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><p><img  class="center" src="../cc/CC-BY-SA_icon.svg" /></p></a></p>
<h5>Pull Requests</h5>
<p>After initial licensing (<a href="https://github.com/algorithm-archivists/algorithm-archive/pull/560">#560</a>), the following pull requests have modified the text or graphics of this chapter:
- none</p>
        <hr>
    </div>
</body>
</html>